var Prototype={Version:"1.6.0.3",Browser:{IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement("div")["__proto__"]&&document.createElement("div")["__proto__"]!==document.createElement("form")["__proto__"]},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Class={create:function(){var E=null,D=$A(arguments);if(Object.isFunction(D[0])){E=D.shift()}function A(){this.initialize.apply(this,arguments)}Object.extend(A,Class.Methods);A.superclass=E;A.subclasses=[];if(E){var B=function(){};B.prototype=E.prototype;A.prototype=new B;E.subclasses.push(A)}for(var C=0;C<D.length;C++){A.addMethods(D[C])}if(!A.prototype.initialize){A.prototype.initialize=Prototype.emptyFunction}A.prototype.constructor=A;return A}};Class.Methods={addMethods:function(G){var C=this.superclass&&this.superclass.prototype;var B=Object.keys(G);if(!Object.keys({toString:true}).length){B.push("toString","valueOf")}for(var A=0,D=B.length;A<D;A++){var F=B[A],E=G[F];if(C&&Object.isFunction(E)&&E.argumentNames().first()=="$super"){var H=E;E=(function(I){return function(){return C[I].apply(this,arguments)}})(F).wrap(H);E.valueOf=H.valueOf.bind(H);E.toString=H.toString.bind(H)}this.prototype[F]=E}return this}};var Abstract={};Object.extend=function(A,C){for(var B in C){A[B]=C[B]}return A};Object.extend(Object,{inspect:function(A){try{if(Object.isUndefined(A)){return"undefined"}if(A===null){return"null"}return A.inspect?A.inspect():String(A)}catch(B){if(B instanceof RangeError){return"..."}throw B}},toJSON:function(A){var C=typeof A;switch(C){case"undefined":case"function":case"unknown":return ;case"boolean":return A.toString()}if(A===null){return"null"}if(A.toJSON){return A.toJSON()}if(Object.isElement(A)){return }var B=[];for(var E in A){var D=Object.toJSON(A[E]);if(!Object.isUndefined(D)){B.push(E.toJSON()+": "+D)}}return"{"+B.join(", ")+"}"},toQueryString:function(A){return $H(A).toQueryString()},toHTML:function(A){return A&&A.toHTML?A.toHTML():String.interpret(A)},keys:function(A){var B=[];for(var C in A){B.push(C)}return B},values:function(B){var A=[];for(var C in B){A.push(B[C])}return A},clone:function(A){return Object.extend({},A)},isElement:function(A){return !!(A&&A.nodeType==1)},isArray:function(A){return A!=null&&typeof A=="object"&&"splice" in A&&"join" in A},isHash:function(A){return A instanceof Hash},isFunction:function(A){return typeof A=="function"},isString:function(A){return typeof A=="string"},isNumber:function(A){return typeof A=="number"},isUndefined:function(A){return typeof A=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var A=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return A.length==1&&!A[0]?[]:A},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var A=this,C=$A(arguments),B=C.shift();return function(){return A.apply(B,C.concat($A(arguments)))}},bindAsEventListener:function(){var A=this,C=$A(arguments),B=C.shift();return function(D){return A.apply(B,[D||window.event].concat(C))}},curry:function(){if(!arguments.length){return this}var A=this,B=$A(arguments);return function(){return A.apply(this,B.concat($A(arguments)))}},delay:function(){var A=this,B=$A(arguments),C=B.shift()*1000;return window.setTimeout(function(){return A.apply(A,B)},C)},defer:function(){var A=[0.01].concat($A(arguments));return this.delay.apply(this,A)},wrap:function(B){var A=this;return function(){return B.apply(this,[A.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var A=this;return this._methodized=function(){return A.apply(null,[this].concat($A(arguments)))}}});Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};var Try={these:function(){var C;for(var B=0,D=arguments.length;B<D;B++){var A=arguments[B];try{C=A();break}catch(E){}}return C}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(A){return String(A).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(B,A){this.callback=B;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return }clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}finally{this.currentlyExecuting=false}}}});Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(E,C){var A="",D=this,B;C=arguments.callee.prepareReplacement(C);while(D.length>0){if(B=D.match(E)){A+=D.slice(0,B.index);A+=String.interpret(C(B));D=D.slice(B.index+B[0].length)}else{A+=D,D=""}}return A},sub:function(C,A,B){A=this.gsub.prepareReplacement(A);B=Object.isUndefined(B)?1:B;return this.gsub(C,function(D){if(--B<0){return D[0]}return A(D)})},scan:function(B,A){this.gsub(B,A);return String(this)},truncate:function(B,A){B=B||30;A=Object.isUndefined(A)?"...":A;return this.length>B?this.slice(0,B-A.length)+A:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var B=new RegExp(Prototype.ScriptFragment,"img");var A=new RegExp(Prototype.ScriptFragment,"im");return(this.match(B)||[]).map(function(C){return(C.match(A)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var A=arguments.callee;A.text.data=this;return A.div.innerHTML},unescapeHTML:function(){var A=new Element("div");A.innerHTML=this.stripTags();return A.childNodes[0]?(A.childNodes.length>1?$A(A.childNodes).inject("",function(B,C){return B+C.nodeValue}):A.childNodes[0].nodeValue):""},toQueryParams:function(B){var A=this.strip().match(/([^?#]*)(#.*)?$/);if(!A){return{}}return A[1].split(B||"&").inject({},function(E,F){if((F=F.split("="))[0]){var C=decodeURIComponent(F.shift());var D=F.length>1?F.join("="):F[0];if(D!=undefined){D=decodeURIComponent(D)}if(C in E){if(!Object.isArray(E[C])){E[C]=[E[C]]}E[C].push(D)}else{E[C]=D}}return E})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(A){return A<1?"":new Array(A+1).join(this)},camelize:function(){var D=this.split("-"),A=D.length;if(A==1){return D[0]}var C=this.charAt(0)=="-"?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var B=1;B<A;B++){C+=D[B].charAt(0).toUpperCase()+D[B].substring(1)}return C},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(B){var A=this.gsub(/[\x00-\x1f\\]/,function(C){var D=String.specialChar[C[0]];return D?D:"\\u00"+C[0].charCodeAt().toPaddedString(2,16)});if(B){return'"'+A.replace(/"/g,'\\"')+'"'}return"'"+A.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(A){return this.sub(A||Prototype.JSONFilter,"#{1}")},isJSON:function(){var A=this;if(A.blank()){return false}A=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(A)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(A){return this.indexOf(A)>-1},startsWith:function(A){return this.indexOf(A)===0},endsWith:function(A){var B=this.length-A.length;return B>=0&&this.lastIndexOf(A)===B},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(A,B){return new Template(this,B).evaluate(A)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(B){if(Object.isFunction(B)){return B}var A=new Template(B);return function(C){return A.evaluate(C)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);var Template=Class.create({initialize:function(A,B){this.template=A.toString();this.pattern=B||Template.Pattern},evaluate:function(A){if(Object.isFunction(A.toTemplateReplacements)){A=A.toTemplateReplacements()}return this.template.gsub(this.pattern,function(D){if(A==null){return""}var F=D[1]||"";if(F=="\\"){return D[2]}var B=A,G=D[3];var E=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;D=E.exec(G);if(D==null){return F}while(D!=null){var C=D[1].startsWith("[")?D[2].gsub("\\\\]","]"):D[1];B=B[C];if(null==B||""==D[3]){break}G=G.substring("["==D[3]?D[1].length:D[0].length);D=E.exec(G)}return F+String.interpret(B)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(C,B){var A=0;try{this._each(function(E){C.call(B,E,A++)})}catch(D){if(D!=$break){throw D}}return this},eachSlice:function(D,C,B){var A=-D,E=[],F=this.toArray();if(D<1){return F}while((A+=D)<F.length){E.push(F.slice(A,A+D))}return E.collect(C,B)},all:function(C,B){C=C||Prototype.K;var A=true;this.each(function(E,D){A=A&&!!C.call(B,E,D);if(!A){throw $break}});return A},any:function(C,B){C=C||Prototype.K;var A=false;this.each(function(E,D){if(A=!!C.call(B,E,D)){throw $break}});return A},collect:function(C,B){C=C||Prototype.K;var A=[];this.each(function(E,D){A.push(C.call(B,E,D))});return A},detect:function(C,B){var A;this.each(function(E,D){if(C.call(B,E,D)){A=E;throw $break}});return A},findAll:function(C,B){var A=[];this.each(function(E,D){if(C.call(B,E,D)){A.push(E)}});return A},grep:function(D,C,B){C=C||Prototype.K;var A=[];if(Object.isString(D)){D=new RegExp(D)}this.each(function(F,E){if(D.match(F)){A.push(C.call(B,F,E))}});return A},include:function(A){if(Object.isFunction(this.indexOf)){if(this.indexOf(A)!=-1){return true}}var B=false;this.each(function(C){if(C==A){B=true;throw $break}});return B},inGroupsOf:function(B,A){A=Object.isUndefined(A)?null:A;return this.eachSlice(B,function(C){while(C.length<B){C.push(A)}return C})},inject:function(A,C,B){this.each(function(E,D){A=C.call(B,A,E,D)});return A},invoke:function(B){var A=$A(arguments).slice(1);return this.map(function(C){return C[B].apply(C,A)})},max:function(C,B){C=C||Prototype.K;var A;this.each(function(E,D){E=C.call(B,E,D);if(A==null||E>=A){A=E}});return A},min:function(C,B){C=C||Prototype.K;var A;this.each(function(E,D){E=C.call(B,E,D);if(A==null||E<A){A=E}});return A},partition:function(D,B){D=D||Prototype.K;var C=[],A=[];this.each(function(F,E){(D.call(B,F,E)?C:A).push(F)});return[C,A]},pluck:function(B){var A=[];this.each(function(C){A.push(C[B])});return A},reject:function(C,B){var A=[];this.each(function(E,D){if(!C.call(B,E,D)){A.push(E)}});return A},sortBy:function(B,A){return this.map(function(D,C){return{value:D,criteria:B.call(A,D,C)}}).sort(function(F,E){var D=F.criteria,C=E.criteria;return D<C?-1:D>C?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var B=Prototype.K,A=$A(arguments);if(Object.isFunction(A.last())){B=A.pop()}var C=[this].concat(A).map($A);return this.map(function(E,D){return B(C.pluck(D))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(C){if(!C){return[]}if(C.toArray){return C.toArray()}var B=C.length||0,A=new Array(B);while(B--){A[B]=C[B]}return A}if(Prototype.Browser.WebKit){$A=function(C){if(!C){return[]}if(!(typeof C==="function"&&typeof C.length==="number"&&typeof C.item==="function")&&C.toArray){return C.toArray()}var B=C.length||0,A=new Array(B);while(B--){A[B]=C[B]}return A}}Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(B){for(var A=0,C=this.length;A<C;A++){B(this[A])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(A){return A!=null})},flatten:function(){return this.inject([],function(B,A){return B.concat(Object.isArray(A)?A.flatten():[A])})},without:function(){var A=$A(arguments);return this.select(function(B){return !A.include(B)})},reverse:function(A){return(A!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(A){return this.inject([],function(D,C,B){if(0==B||(A?D.last()!=C:!D.include(C))){D.push(C)}return D})},intersect:function(A){return this.uniq().findAll(function(B){return A.detect(function(C){return B===C})})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var A=[];this.each(function(B){var C=Object.toJSON(B);if(!Object.isUndefined(C)){A.push(C)}});return"["+A.join(", ")+"]"}});if(Object.isFunction(Array.prototype.forEach)){Array.prototype._each=Array.prototype.forEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(C,A){A||(A=0);var B=this.length;if(A<0){A=B+A}for(;A<B;A++){if(this[A]===C){return A}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(B,A){A=isNaN(A)?this.length:(A<0?this.length+A:A)+1;var C=this.slice(0,A).reverse().indexOf(B);return(C<0)?C:A-C-1}}Array.prototype.toArray=Array.prototype.clone;function $w(A){if(!Object.isString(A)){return[]}A=A.strip();return A?A.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var E=[];for(var B=0,C=this.length;B<C;B++){E.push(this[B])}for(var B=0,C=arguments.length;B<C;B++){if(Object.isArray(arguments[B])){for(var A=0,D=arguments[B].length;A<D;A++){E.push(arguments[B][A])}}else{E.push(arguments[B])}}return E}}Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(B,A){$R(0,this,true).each(B,A);return this},toPaddedString:function(C,B){var A=this.toString(B||10);return"0".times(C-A.length)+A},toJSON:function(){return isFinite(this)?this.toString():"null"}});$w("abs round ceil floor").each(function(A){Number.prototype[A]=Math[A].methodize()});function $H(A){return new Hash(A)}var Hash=Class.create(Enumerable,(function(){function A(B,C){if(Object.isUndefined(C)){return B}return B+"="+encodeURIComponent(String.interpret(C))}return{initialize:function(B){this._object=Object.isHash(B)?B.toObject():Object.clone(B)},_each:function(C){for(var B in this._object){var D=this._object[B],E=[B,D];E.key=B;E.value=D;C(E)}},set:function(B,C){return this._object[B]=C},get:function(B){if(this._object[B]!==Object.prototype[B]){return this._object[B]}},unset:function(B){var C=this._object[B];delete this._object[B];return C},toObject:function(){return Object.clone(this._object)},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(C){var B=this.detect(function(D){return D.value===C});return B&&B.key},merge:function(B){return this.clone().update(B)},update:function(B){return new Hash(B).inject(this,function(C,D){C.set(D.key,D.value);return C})},toQueryString:function(){return this.inject([],function(D,E){var C=encodeURIComponent(E.key),B=E.value;if(B&&typeof B=="object"){if(Object.isArray(B)){return D.concat(B.map(A.curry(C)))}}else{D.push(A(C,B))}return D}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(B){return B.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}})());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject;Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(C,A,B){this.start=C;this.end=A;this.exclusive=B},_each:function(A){var B=this.start;while(this.include(B)){A(B);B=B.succ()}},include:function(A){if(A<this.start){return false}if(this.exclusive){return A<this.end}return A<=this.end}});var $R=function(C,A,B){return new ObjectRange(C,A,B)};function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]))}return D}if(Object.isString(B)){B=document.getElementById(B)}return Element.extend(B)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(Element.extend(E.snapshotItem(B)))}return C}}if(!window.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(){var A=this.Element;this.Element=function(D,C){C=C||{};D=D.toLowerCase();var B=Element.cache;if(Prototype.Browser.IE&&C.name){D="<"+D+' name="'+C.name+'">';delete C.name;return Element.writeAttribute(document.createElement(D),C)}if(!B[D]){B[D]=Element.extend(document.createElement(D))}return Element.writeAttribute(B[D].cloneNode(false),C)};Object.extend(this.Element,A||{});if(A){this.Element.prototype=A.prototype}}).call(window);Element.cache={};Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){A=$(A);A.style.display="none";return A},show:function(A){A=$(A);A.style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:function(A,B){A=$(A);if(B&&B.toElement){B=B.toElement()}if(Object.isElement(B)){return A.update().insert(B)}B=Object.toHTML(B);A.innerHTML=B.stripScripts();B.evalScripts.bind(B).defer();return A},replace:function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}else{if(!Object.isElement(C)){C=Object.toHTML(C);var A=B.ownerDocument.createRange();A.selectNode(B);C.evalScripts.bind(C).defer();C=A.createContextualFragment(C.stripScripts())}}B.parentNode.replaceChild(C,B);return B},insert:function(C,F,D){C=$(C);if(Object.isString(F)||Object.isNumber(F)||Object.isElement(F)||(F&&(F.toElement||F.toHTML))){F={bottom:F}}var E,G,B,H;for(var A in F){E=F[A];A=A.toLowerCase();G=Element._insertionTranslations[A];if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){G(C,E);continue}E=Object.toHTML(E);B=((A=="before"||A=="after")?C.parentNode:C).tagName.toUpperCase();H=Element._getContentFromAnonymousElement(B,E.stripScripts());if(A=="top"||A=="after"){H.reverse()}H.each(G.curry(C));if(D){E.evalScripts.bind(E).defer()}}return C},wrap:function(B,C,A){B=$(B);if(Object.isElement(C)){$(C).writeAttribute(A||{})}else{if(Object.isString(C)){C=new Element(C,A)}else{C=new Element("div",C)}}if(B.parentNode){B.parentNode.replaceChild(C,B)}C.appendChild(B);return C},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({"id":"id","className":"class"}).each(function(F){var E=F.first(),C=F.last();var D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true)}});return A+">"},recursivelyCollect:function(A,C){A=$(A);var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A))}}return B},ancestors:function(A){return $(A).recursivelyCollect("parentNode")},descendants:function(A){return $(A).select("*")},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[]}while(A&&A.nodeType!=1){A=A.nextSibling}if(A){return[A].concat($(A).nextSiblings())}return[]},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling")},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling")},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings())},match:function(B,A){if(Object.isString(A)){A=new Selector(A)}return A.match($(B))},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode)}var C=B.ancestors();return Object.isNumber(D)?C[D]:Selector.findElement(C,D,A)},down:function(B,C,A){B=$(B);if(arguments.length==1){return B.firstDescendant()}return Object.isNumber(C)?B.descendants()[C]:Element.select(B,C)[A||0]},previous:function(B,D,A){B=$(B);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(B))}var C=B.previousSiblings();return Object.isNumber(D)?C[D]:Selector.findElement(C,D,A)},next:function(C,D,B){C=$(C);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(C))}var A=C.nextSiblings();return Object.isNumber(D)?A[D]:Selector.findElement(A,D,B)},select:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B,A)},adjacent:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B.parentNode,A).without(B)},identify:function(B){B=$(B);var C=B.readAttribute("id"),A=arguments.callee;if(C){return C}do{C="anonymous_element_"+A.counter++}while($(C));B.writeAttribute("id",C);return C},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){var B=Element._attributeTranslations.read;if(B.values[A]){return B.values[A](C,A)}if(B.names[A]){A=B.names[A]}if(A.include(":")){return(!C.attributes||!C.attributes[A])?null:C.attributes[A].value}}return C.getAttribute(A)},writeAttribute:function(E,C,F){E=$(E);var B={},D=Element._attributeTranslations.write;if(typeof C=="object"){B=C}else{B[C]=Object.isUndefined(F)?true:F}for(var A in B){C=D.names[A]||A;F=B[A];if(D.values[A]){C=D.values[A](E,F)}if(F===false||F===null){E.removeAttribute(C)}else{if(F===true){E.setAttribute(C,C)}else{E.setAttribute(C,F)}}}return E},getHeight:function(A){return $(A).getDimensions().height},getWidth:function(A){return $(A).getDimensions().width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,B){if(!(A=$(A))){return }var C=A.className;return(C.length>0&&(C==B||new RegExp("(^|\\s)"+B+"(\\s|$)").test(C)))},addClassName:function(A,B){if(!(A=$(A))){return }if(!A.hasClassName(B)){A.className+=(A.className?" ":"")+B}return A},removeClassName:function(A,B){if(!(A=$(A))){return }A.className=A.className.replace(new RegExp("(^|\\s+)"+B+"(\\s+|$)")," ").strip();return A},toggleClassName:function(A,B){if(!(A=$(A))){return }return A[A.hasClassName(B)?"removeClassName":"addClassName"](B)},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C)}C=A}return B},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(B,A){B=$(B),A=$(A);if(B.compareDocumentPosition){return(B.compareDocumentPosition(A)&8)===8}if(A.contains){return A.contains(B)&&A!==B}while(B=B.parentNode){if(B==A){return true}}return false},scrollTo:function(A){A=$(A);var B=A.cumulativeOffset();window.scrollTo(B[0],B[1]);return A},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D||D=="auto"){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null}if(C=="opacity"){return D?parseFloat(D):1}return D=="auto"?null:D},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(B,C){B=$(B);var E=B.style,A;if(Object.isString(C)){B.style.cssText+=";"+C;return C.include("opacity")?B.setOpacity(C.match(/opacity:\s*(\d?\.?\d*)/)[1]):B}for(var D in C){if(D=="opacity"){B.setOpacity(C[D])}else{E[(D=="float"||D=="cssFloat")?(Object.isUndefined(E.styleFloat)?"cssFloat":"styleFloat"):D]=C[D]}}return B},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A},getDimensions:function(C){C=$(C);var G=C.getStyle("display");if(G!="none"&&G!=null){return{width:C.offsetWidth,height:C.offsetHeight}}var B=C.style;var F=B.visibility;var D=B.position;var A=B.display;B.visibility="hidden";B.position="absolute";B.display="block";var H=C.clientWidth;var E=C.clientHeight;B.display=A;B.position=D;B.visibility=F;return{width:H,height:E}},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(Prototype.Browser.Opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A},cumulativeOffset:function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;B=B.offsetParent}while(B);return Element._returnOffset(C,A)},positionedOffset:function(B){var A=0,D=0;do{A+=B.offsetTop||0;D+=B.offsetLeft||0;B=B.offsetParent;if(B){if(B.tagName.toUpperCase()=="BODY"){break}var C=Element.getStyle(B,"position");if(C!=="static"){break}}}while(B);return Element._returnOffset(D,A)},absolutize:function(B){B=$(B);if(B.getStyle("position")=="absolute"){return B}var D=B.positionedOffset();var F=D[1];var E=D[0];var C=B.clientWidth;var A=B.clientHeight;B._originalLeft=E-parseFloat(B.style.left||0);B._originalTop=F-parseFloat(B.style.top||0);B._originalWidth=B.style.width;B._originalHeight=B.style.height;B.style.position="absolute";B.style.top=F+"px";B.style.left=E+"px";B.style.width=C+"px";B.style.height=A+"px";return B},relativize:function(A){A=$(A);if(A.getStyle("position")=="relative"){return A}A.style.position="relative";var C=parseFloat(A.style.top||0)-(A._originalTop||0);var B=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=C+"px";A.style.left=B+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth;return A},cumulativeScrollOffset:function(B){var A=0,C=0;do{A+=B.scrollTop||0;C+=B.scrollLeft||0;B=B.parentNode}while(B);return Element._returnOffset(C,A)},getOffsetParent:function(A){if(A.offsetParent){return $(A.offsetParent)}if(A==document.body){return $(A)}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return $(A)}}return $(document.body)},viewportOffset:function(D){var A=0,C=0;var B=D;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body&&Element.getStyle(B,"position")=="absolute"){break}}while(B=B.offsetParent);B=D;do{if(!Prototype.Browser.Opera||(B.tagName&&(B.tagName.toUpperCase()=="BODY"))){A-=B.scrollTop||0;C-=B.scrollLeft||0}}while(B=B.parentNode);return Element._returnOffset(C,A)},clonePosition:function(B,D){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});D=$(D);var E=D.viewportOffset();B=$(B);var F=[0,0];var C=null;if(Element.getStyle(B,"position")=="absolute"){C=B.getOffsetParent();F=C.viewportOffset()}if(C==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop}if(A.setLeft){B.style.left=(E[0]-F[0]+A.offsetLeft)+"px"}if(A.setTop){B.style.top=(E[1]-F[1]+A.offsetTop)+"px"}if(A.setWidth){B.style.width=D.offsetWidth+"px"}if(A.setHeight){B.style.height=D.offsetHeight+"px"}return B}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(D,B,C){switch(C){case"left":case"top":case"right":case"bottom":if(D(B,"position")==="static"){return null}case"height":case"width":if(!Element.visible(B)){return null}var E=parseInt(D(B,C),10);if(E!==B["offset"+C.capitalize()]){return E+"px"}var A;if(C==="height"){A=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{A=["border-left-width","padding-left","padding-right","border-right-width"]}return A.inject(E,function(F,G){var H=D(B,G);return H===null?F:F-parseInt(H,10)})+"px";default:return D(B,C)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(C,A,B){if(B==="title"){return A.title}return C(A,B)})}else{if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(C,B){B=$(B);try{B.offsetParent}catch(E){return $(document.body)}var A=B.getStyle("position");if(A!=="static"){return C(B)}B.setStyle({position:"relative"});var D=C(B);B.setStyle({position:A});return D});$w("positionedOffset viewportOffset").each(function(A){Element.Methods[A]=Element.Methods[A].wrap(function(E,C){C=$(C);try{C.offsetParent}catch(G){return Element._returnOffset(0,0)}var B=C.getStyle("position");if(B!=="static"){return E(C)}var D=C.getOffsetParent();if(D&&D.getStyle("position")==="fixed"){D.setStyle({zoom:1})}C.setStyle({position:"relative"});var F=E(C);C.setStyle({position:B});return F})});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(B,A){try{A.offsetParent}catch(C){return Element._returnOffset(0,0)}return B(A)});Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B]}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100}}return 1}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px"}return null}return C};Element.Methods.setOpacity=function(B,E){function F(G){return G.replace(/alpha\([^\)]*\)/gi,"")}B=$(B);var A=B.currentStyle;if((A&&!A.hasLayout)||(!A&&B.style.zoom=="normal")){B.style.zoom=1}var D=B.getStyle("filter"),C=B.style;if(E==1||E===""){(D=F(D))?C.filter=D:C.removeAttribute("filter");return B}else{if(E<0.00001){E=0}}C.filter=F(D)+"alpha(opacity="+(E*100)+")";return B};Element._attributeTranslations={read:{names:{"class":"className","for":"htmlFor"},values:{_getAttr:function(A,B){return A.getAttribute(B,2)},_getAttrNode:function(A,C){var B=A.getAttributeNode(C);return B?B.value:""},_getEv:function(A,B){B=A.getAttribute(B);return B?B.toString().slice(23,-2):null},_flag:function(A,B){return $(A).hasAttribute(B)?B:null},style:function(A){return A.style.cssText.toLowerCase()},title:function(A){return A.title}}}};Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(A,B){A.checked=!!B},style:function(A,B){A.style.cssText=B?B:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A});(function(A){Object.extend(A,{href:A._getAttr,src:A._getAttr,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv})})(Element._attributeTranslations.read.values)}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;if(B==1){if(A.tagName.toUpperCase()=="IMG"&&A.width){A.width++;A.width--}else{try{var D=document.createTextNode(" ");A.appendChild(D);A.removeChild(D)}catch(C){}}}return A};Element.Methods.cumulativeOffset=function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break}}B=B.offsetParent}while(B);return Element._returnOffset(C,A)}}}}}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}if(Object.isElement(C)){return B.update().insert(C)}C=Object.toHTML(C);var A=B.tagName.toUpperCase();if(A in Element._insertionTranslations.tags){$A(B.childNodes).each(function(D){B.removeChild(D)});Element._getContentFromAnonymousElement(A,C.stripScripts()).each(function(D){B.appendChild(D)})}else{B.innerHTML=C.stripScripts()}C.evalScripts.bind(C).defer();return B}}if("outerHTML" in document.createElement("div")){Element.Methods.replace=function(C,E){C=$(C);if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){C.parentNode.replaceChild(E,C);return C}E=Object.toHTML(E);var D=C.parentNode,B=D.tagName.toUpperCase();if(Element._insertionTranslations.tags[B]){var F=C.next();var A=Element._getContentFromAnonymousElement(B,E.stripScripts());D.removeChild(C);if(F){A.each(function(G){D.insertBefore(G,F)})}else{A.each(function(G){D.appendChild(G)})}}else{C.outerHTML=E.stripScripts()}E.evalScripts.bind(E).defer();return C}}Element._returnOffset=function(B,C){var A=[B,C];A.left=B;A.top=C;return A};Element._getContentFromAnonymousElement=function(C,B){var D=new Element("div"),A=Element._insertionTranslations.tags[C];if(A){D.innerHTML=A[0]+B+A[1];A[2].times(function(){D=D.firstChild})}else{D.innerHTML=B}return $A(D.childNodes)};Element._insertionTranslations={before:function(A,B){A.parentNode.insertBefore(B,A)},top:function(A,B){A.insertBefore(B,A.firstChild)},bottom:function(A,B){A.appendChild(B)},after:function(A,B){A.parentNode.insertBefore(B,A.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(A,C){C=Element._attributeTranslations.has[C]||C;var B=$(A).getAttributeNode(C);return !!(B&&B.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div")["__proto__"]){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div")["__proto__"];Prototype.BrowserFeatures.ElementExtensions=true}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions){return Prototype.K}var A={},B=Element.Methods.ByTag;var C=Object.extend(function(F){if(!F||F._extendedByPrototype||F.nodeType!=1||F==window){return F}var D=Object.clone(A),E=F.tagName.toUpperCase(),H,G;if(B[E]){Object.extend(D,B[E])}for(H in D){G=D[H];if(Object.isFunction(G)&&!(H in F)){F[H]=G.methodize()}}F._extendedByPrototype=Prototype.emptyFunction;return F},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated)}}});C.refresh();return C})();Element.hasAttribute=function(A,B){if(A.hasAttribute){return A.hasAttribute(B)}return Element.Methods.Simulated.hasAttribute(A,B)};Element.addMethods=function(C){var I=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)})}if(arguments.length==2){var B=C;C=arguments[1]}if(!B){Object.extend(Element.Methods,C||{})}else{if(Object.isArray(B)){B.each(H)}else{H(B)}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],C)}function A(L,K,F){F=F||false;for(var N in L){var M=L[N];if(!Object.isFunction(M)){continue}if(!F||!(N in K)){K[N]=M.methodize()}}}function E(L){var F;var K={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(K[L]){F="HTML"+K[L]+"Element"}if(window[F]){return window[F]}F="HTML"+L+"Element";if(window[F]){return window[F]}F="HTML"+L.capitalize()+"Element";if(window[F]){return window[F]}window[F]={};window[F].prototype=document.createElement(L)["__proto__"];return window[F]}if(I.ElementExtensions){A(Element.Methods,HTMLElement.prototype);A(Element.Methods.Simulated,HTMLElement.prototype,true)}if(I.SpecificElementExtensions){for(var J in Element.Methods.ByTag){var G=E(J);if(Object.isUndefined(G)){continue}A(D[J],G.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){var A={},C=Prototype.Browser;$w("width height").each(function(E){var B=E.capitalize();if(C.WebKit&&!document.evaluate){A[E]=self["inner"+B]}else{if(C.Opera&&parseFloat(window.opera.version())<9.5){A[E]=document.body["client"+B]}else{A[E]=document.documentElement["client"+B]}}});return A},getWidth:function(){return this.getDimensions().width},getHeight:function(){return this.getDimensions().height},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};var Selector=Class.create({initialize:function(A){this.expression=A.strip();if(this.shouldUseSelectorsAPI()){this.mode="selectorsAPI"}else{if(this.shouldUseXPath()){this.mode="xpath";this.compileXPathMatcher()}else{this.mode="normal";this.compileMatcher()}}},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath){return false}var A=this.expression;if(Prototype.Browser.WebKit&&(A.include("-of-type")||A.include(":empty"))){return false}if((/(\[[\w-]*?:|:checked)/).test(A)){return false}return true},shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI){return false}if(!Selector._div){Selector._div=new Element("div")}try{Selector._div.querySelector(this.expression)}catch(A){return false}return true},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return }this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var E=this.expression,F=Selector.patterns,B=Selector.xpath,D,A;if(Selector._cache[E]){this.xpath=Selector._cache[E];return }this.matcher=[".//*"];while(E&&D!=E&&(/\S/).test(E)){D=E;for(var C in F){if(A=E.match(F[C])){this.matcher.push(Object.isFunction(B[C])?B[C](A):new Template(B[C]).evaluate(A));E=E.replace(A[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(A){A=A||document;var C=this.expression,B;switch(this.mode){case"selectorsAPI":if(A!==document){var D=A.id,E=$(A).identify();C="#"+E+" "+C}B=$A(A.querySelectorAll(C)).map(Element.extend);A.id=D;return B;case"xpath":return document._getElementsByXPath(this.xpath,A);default:return this.matcher(A)}},match:function(H){this.tokens=[];var L=this.expression,A=Selector.patterns,E=Selector.assertions;var B,D,F;while(L&&B!==L&&(/\S/).test(L)){B=L;for(var I in A){D=A[I];if(F=L.match(D)){if(E[I]){this.tokens.push([I,Object.clone(F)]);L=L.replace(F[0],"")}else{return this.findElements(document).include(H)}}}}var K=true,C,J;for(var I=0,G;G=this.tokens[I];I++){C=G[0],J=G[1];if(!Selector.assertions[C](H,J)){K=false;break}}return K},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return""}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(A){A[1]=A[1].toLowerCase();return new Template("[@#{1}]").evaluate(A)},attr:function(A){A[1]=A[1].toLowerCase();A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A)},pseudo:function(A){var B=Selector.xpath.pseudos[A[1]];if(!B){return""}if(Object.isFunction(B)){return B(A)}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]","empty":"[count(*) = 0 and (count(text()) = 0)]","checked":"[@checked]","disabled":"[(@disabled) and (@type!='hidden')]","enabled":"[not(@disabled) and (@type!='hidden')]","not":function(B){var H=B[6],G=Selector.patterns,A=Selector.xpath,E,C;var F=[];while(H&&E!=H&&(/\S/).test(H)){E=H;for(var D in G){if(B=H.match(G[D])){C=Object.isFunction(A[D])?A[D](B):new Template(A[D]).evaluate(B);F.push("("+C.substring(1,C.length-1)+")");H=H.replace(B[0],"");break}}}return"[not("+F.join(" and ")+")]"},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A)},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A)},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A)},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A)},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A)},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A)},"only-of-type":function(A){var B=Selector.xpath.pseudos;return B["first-of-type"](A)+B["last-of-type"](A)},nth:function(E,C){var F,G=C[6],B;if(G=="even"){G="2n+0"}if(G=="odd"){G="2n+1"}if(F=G.match(/^(\d+)$/)){return"["+E+"= "+F[1]+"]"}if(F=G.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1}var D=F[1]?Number(F[1]):1;var A=F[2]?Number(F[2]):0;B="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(B).evaluate({fragment:E,a:D,b:A})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(A)},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,attrPresence:/^\[((?:[\w]+:)?[\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(A,B){return B[1].toUpperCase()==A.tagName.toUpperCase()},className:function(A,B){return Element.hasClassName(A,B[1])},id:function(A,B){return A.id===B[1]},attrPresence:function(A,B){return Element.hasAttribute(A,B[1])},attr:function(B,C){var A=Element.readAttribute(B,C[1]);return A&&Selector.operators[C[2]](A,C[5]||C[6])}},handlers:{concat:function(B,A){for(var C=0,D;D=A[C];C++){B.push(D)}return B},mark:function(A){var D=Prototype.emptyFunction;for(var B=0,C;C=A[B];B++){C._countedByPrototype=D}return A},unmark:function(A){for(var B=0,C;C=A[B];B++){C._countedByPrototype=undefined}return A},index:function(A,D,G){A._countedByPrototype=Prototype.emptyFunction;if(D){for(var B=A.childNodes,E=B.length-1,C=1;E>=0;E--){var F=B[E];if(F.nodeType==1&&(!G||F._countedByPrototype)){F.nodeIndex=C++}}}else{for(var E=0,C=1,B=A.childNodes;F=B[E];E++){if(F.nodeType==1&&(!G||F._countedByPrototype)){F.nodeIndex=C++}}}},unique:function(B){if(B.length==0){return B}var D=[],E;for(var C=0,A=B.length;C<A;C++){if(!(E=B[C])._countedByPrototype){E._countedByPrototype=Prototype.emptyFunction;D.push(Element.extend(E))}}return Selector.handlers.unmark(D)},descendant:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,E.getElementsByTagName("*"))}return B},child:function(A){var E=Selector.handlers;for(var D=0,C=[],F;F=A[D];D++){for(var B=0,G;G=F.childNodes[B];B++){if(G.nodeType==1&&G.tagName!="!"){C.push(G)}}}return C},adjacent:function(A){for(var C=0,B=[],E;E=A[C];C++){var D=this.nextElementSibling(E);if(D){B.push(D)}}return B},laterSibling:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,Element.nextSiblings(E))}return B},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A}}return null},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A}}return null},tagName:function(A,H,C,B){var I=C.toUpperCase();var E=[],G=Selector.handlers;if(A){if(B){if(B=="descendant"){for(var F=0,D;D=A[F];F++){G.concat(E,D.getElementsByTagName(C))}return E}else{A=this[B](A)}if(C=="*"){return A}}for(var F=0,D;D=A[F];F++){if(D.tagName.toUpperCase()===I){E.push(D)}}return E}else{return H.getElementsByTagName(C)}},id:function(B,A,H,F){var G=$(H),D=Selector.handlers;if(!G){return[]}if(!B&&A==document){return[G]}if(B){if(F){if(F=="child"){for(var C=0,E;E=B[C];C++){if(G.parentNode==E){return[G]}}}else{if(F=="descendant"){for(var C=0,E;E=B[C];C++){if(Element.descendantOf(G,E)){return[G]}}}else{if(F=="adjacent"){for(var C=0,E;E=B[C];C++){if(Selector.handlers.previousElementSibling(G)==E){return[G]}}}else{B=D[F](B)}}}}for(var C=0,E;E=B[C];C++){if(E==G){return[G]}}return[]}return(G&&Element.descendantOf(G,A))?[G]:[]},className:function(B,A,C,D){if(B&&D){B=this[D](B)}return Selector.handlers.byClassName(B,A,C)},byClassName:function(C,B,F){if(!C){C=Selector.handlers.descendant([B])}var H=" "+F+" ";for(var E=0,D=[],G,A;G=C[E];E++){A=G.className;if(A.length==0){continue}if(A==F||(" "+A+" ").include(H)){D.push(G)}}return D},attrPresence:function(C,B,A,G){if(!C){C=B.getElementsByTagName("*")}if(C&&G){C=this[G](C)}var E=[];for(var D=0,F;F=C[D];D++){if(Element.hasAttribute(F,A)){E.push(F)}}return E},attr:function(A,I,H,J,C,B){if(!A){A=I.getElementsByTagName("*")}if(A&&B){A=this[B](A)}var K=Selector.operators[C],F=[];for(var E=0,D;D=A[E];E++){var G=Element.readAttribute(D,H);if(G===null){continue}if(K(G,J)){F.push(D)}}return F},pseudo:function(B,C,E,A,D){if(B&&D){B=this[D](B)}if(!B){B=A.getElementsByTagName("*")}return Selector.pseudos[C](B,E,A)}},pseudos:{"first-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.previousElementSibling(E)){continue}C.push(E)}return C},"last-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.nextElementSibling(E)){continue}C.push(E)}return C},"only-child":function(B,G,A){var E=Selector.handlers;for(var D=0,C=[],F;F=B[D];D++){if(!E.previousElementSibling(F)&&!E.nextElementSibling(F)){C.push(F)}}return C},"nth-child":function(B,C,A){return Selector.pseudos.nth(B,C,A)},"nth-last-child":function(B,C,A){return Selector.pseudos.nth(B,C,A,true)},"nth-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,false,true)},"nth-last-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,true,true)},"first-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,false,true)},"last-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,true,true)},"only-of-type":function(B,D,A){var C=Selector.pseudos;return C["last-of-type"](C["first-of-type"](B,D,A),D,A)},getIndices:function(B,A,C){if(B==0){return A>0?[A]:[]}return $R(1,C).inject([],function(D,E){if(0==(E-A)%B&&(E-A)/B>=0){D.push(E)}return D})},nth:function(A,L,N,K,C){if(A.length==0){return[]}if(L=="even"){L="2n+0"}if(L=="odd"){L="2n+1"}var J=Selector.handlers,I=[],B=[],E;J.mark(A);for(var H=0,D;D=A[H];H++){if(!D.parentNode._countedByPrototype){J.index(D.parentNode,K,C);B.push(D.parentNode)}}if(L.match(/^\d+$/)){L=Number(L);for(var H=0,D;D=A[H];H++){if(D.nodeIndex==L){I.push(D)}}}else{if(E=L.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(E[1]=="-"){E[1]=-1}var O=E[1]?Number(E[1]):1;var M=E[2]?Number(E[2]):0;var P=Selector.pseudos.getIndices(O,M,A.length);for(var H=0,D,F=P.length;D=A[H];H++){for(var G=0;G<F;G++){if(D.nodeIndex==P[G]){I.push(D)}}}}}J.unmark(A);J.unmark(B);return I},"empty":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.tagName=="!"||E.firstChild){continue}C.push(E)}return C},"not":function(A,D,I){var G=Selector.handlers,J,C;var H=new Selector(D).findElements(I);G.mark(H);for(var F=0,E=[],B;B=A[F];F++){if(!B._countedByPrototype){E.push(B)}}G.unmark(H);return E},"enabled":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(!E.disabled&&(!E.type||E.type!=="hidden")){C.push(E)}}return C},"disabled":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.disabled){C.push(E)}}return C},"checked":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.checked){C.push(E)}}return C}},operators:{"=":function(B,A){return B==A},"!=":function(B,A){return B!=A},"^=":function(B,A){return B==A||B&&B.startsWith(A)},"$=":function(B,A){return B==A||B&&B.endsWith(A)},"*=":function(B,A){return B==A||B&&B.include(A)},"$=":function(B,A){return B.endsWith(A)},"*=":function(B,A){return B.include(A)},"~=":function(B,A){return(" "+B+" ").include(" "+A+" ")},"|=":function(B,A){return("-"+(B||"").toUpperCase()+"-").include("-"+(A||"").toUpperCase()+"-")}},split:function(B){var A=[];B.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(C){A.push(C[1].strip())});return A},matchElements:function(F,G){var E=$$(G),D=Selector.handlers;D.mark(E);for(var C=0,B=[],A;A=F[C];C++){if(A._countedByPrototype){B.push(A)}}D.unmark(E);return B},findElement:function(B,C,A){if(Object.isNumber(C)){A=C;C=false}return Selector.matchElements(B,C||"*")[A||0]},findChildElements:function(E,G){G=Selector.split(G.join(","));var D=[],F=Selector.handlers;for(var C=0,B=G.length,A;C<B;C++){A=new Selector(G[C].strip());F.concat(D,A.findElements(E))}return(B>1)?F.unique(D):D}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(B,A){for(var C=0,D;D=A[C];C++){if(D.tagName!=="!"){B.push(D)}}return B},unmark:function(A){for(var B=0,C;C=A[B];B++){C.removeAttribute("_countedByPrototype")}return A}})}function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(A){$(A).reset();return A},serializeElements:function(G,B){if(typeof B!="object"){B={hash:!!B}}else{if(Object.isUndefined(B.hash)){B.hash=true}}var C,F,A=false,E=B.submit;var D=G.inject({},function(H,I){if(!I.disabled&&I.name){C=I.name;F=$(I).getValue();if(F!=null&&I.type!="file"&&(I.type!="submit"||(!A&&E!==false&&(!E||C==E)&&(A=true)))){if(C in H){if(!Object.isArray(H[C])){H[C]=[H[C]]}H[C].push(F)}else{H[C]=F}}}return H});return B.hash?D:Object.toQueryString(D)}};Form.Methods={serialize:function(B,A){return Form.serializeElements(Form.getElements(B),A)},getElements:function(A){return $A($(A).getElementsByTagName("*")).inject([],function(B,C){if(Form.Element.Serializers[C.tagName.toLowerCase()]){B.push(Element.extend(C))}return B})},getInputs:function(G,C,D){G=$(G);var A=G.getElementsByTagName("input");if(!C&&!D){return $A(A).map(Element.extend)}for(var E=0,H=[],F=A.length;E<F;E++){var B=A[E];if((C&&B.type!=C)||(D&&B.name!=D)){continue}H.push(Element.extend(B))}return H},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(B){var C=$(B).getElements().findAll(function(D){return"hidden"!=D.type&&!D.disabled});var A=C.findAll(function(D){return D.hasAttribute("tabIndex")&&D.tabIndex>=0}).sortBy(function(D){return D.tabIndex}).first();return A?A:C.find(function(D){return["input","select","textarea"].include(D.tagName.toLowerCase())})},focusFirstElement:function(A){A=$(A);A.findFirstElement().activate();return A},request:function(B,A){B=$(B),A=Object.clone(A||{});var D=A.parameters,C=B.readAttribute("action")||"";if(C.blank()){C=window.location.href}A.parameters=B.serialize(true);if(D){if(Object.isString(D)){D=D.toQueryParams()}Object.extend(A.parameters,D)}if(B.hasAttribute("method")&&!A.method){A.method=B.method}return new Ajax.Request(C,A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var B=A.getValue();if(B!=undefined){var C={};C[A.name]=B;return Object.toQueryString(C)}}return""},getValue:function(A){A=$(A);var B=A.tagName.toLowerCase();return Form.Element.Serializers[B](A)},setValue:function(A,B){A=$(A);var C=A.tagName.toLowerCase();Form.Element.Serializers[C](A,B);return A},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(A.type))){A.select()}}catch(B){}return A},disable:function(A){A=$(A);A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(A,B){switch(A.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(A,B);default:return Form.Element.Serializers.textarea(A,B)}},inputSelector:function(A,B){if(Object.isUndefined(B)){return A.checked?A.value:null}else{A.checked=!!B}},textarea:function(A,B){if(Object.isUndefined(B)){return A.value}else{A.value=B}},select:function(C,F){if(Object.isUndefined(F)){return this[C.type=="select-one"?"selectOne":"selectMany"](C)}else{var B,D,G=!Object.isArray(F);for(var A=0,E=C.length;A<E;A++){B=C.options[A];D=this.optionValue(B);if(G){if(D==F){B.selected=true;return }}else{B.selected=F.include(D)}}}},selectOne:function(B){var A=B.selectedIndex;return A>=0?this.optionValue(B.options[A]):null},selectMany:function(D){var A,E=D.length;if(!E){return null}for(var C=0,A=[];C<E;C++){var B=D.options[C];if(B.selected){A.push(this.optionValue(B))}}return A},optionValue:function(A){return Element.extend(A).hasAttribute("value")?A.value:A.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,A,B,C){$super(C,B);this.element=$(A);this.lastValue=this.getValue()},execute:function(){var A=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(A)?this.lastValue!=A:String(this.lastValue)!=String(A)){this.callback(this.element,A);this.lastValue=A}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(A,B){this.element=$(A);this.callback=B;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event={}}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(B){var A;switch(B.type){case"mouseover":A=B.fromElement;break;case"mouseout":A=B.toElement;break;default:return null}return Element.extend(A)}});Event.Methods=(function(){var A;if(Prototype.Browser.IE){var B={0:1,1:4,2:2};A=function(D,C){return D.button==B[C]}}else{if(Prototype.Browser.WebKit){A=function(D,C){switch(C){case 0:return D.which==1&&!D.metaKey;case 1:return D.which==1&&D.metaKey;default:return false}}}else{A=function(D,C){return D.which?(D.which===C+1):(D.button===C)}}}return{isLeftClick:function(C){return A(C,0)},isMiddleClick:function(C){return A(C,1)},isRightClick:function(C){return A(C,2)},element:function(E){E=Event.extend(E);var D=E.target,C=E.type,F=E.currentTarget;if(F&&F.tagName){if(C==="load"||C==="error"||(C==="click"&&F.tagName.toLowerCase()==="input"&&F.type==="radio")){D=F}}if(D.nodeType==Node.TEXT_NODE){D=D.parentNode}return Element.extend(D)},findElement:function(D,F){var C=Event.element(D);if(!F){return C}var E=[C].concat(C.ancestors());return Selector.findElement(E,F,0)},pointer:function(E){var D=document.documentElement,C=document.body||{scrollLeft:0,scrollTop:0};return{x:E.pageX||(E.clientX+(D.scrollLeft||C.scrollLeft)-(D.clientLeft||0)),y:E.pageY||(E.clientY+(D.scrollTop||C.scrollTop)-(D.clientTop||0))}},pointerX:function(C){return Event.pointer(C).x},pointerY:function(C){return Event.pointer(C).y},stop:function(C){Event.extend(C);C.preventDefault();C.stopPropagation();C.stopped=true}}})();Event.extend=(function(){var A=Object.keys(Event.Methods).inject({},function(B,C){B[C]=Event.Methods[C].methodize();return B});if(Prototype.Browser.IE){Object.extend(A,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});return function(B){if(!B){return false}if(B._extendedByPrototype){return B}B._extendedByPrototype=Prototype.emptyFunction;var C=Event.pointer(B);Object.extend(B,{target:B.srcElement,relatedTarget:Event.relatedTarget(B),pageX:C.x,pageY:C.y});return Object.extend(B,A)}}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents")["__proto__"];Object.extend(Event.prototype,A);return Prototype.K}})();Object.extend(Event,(function(){var B=Event.cache;function C(J){if(J._prototypeEventID){return J._prototypeEventID[0]}arguments.callee.id=arguments.callee.id||1;return J._prototypeEventID=[++arguments.callee.id]}function G(J){if(J&&J.include(":")){return"dataavailable"}if(!Prototype.Browser.IE){J={mouseenter:"mouseover",mouseleave:"mouseout"}[J]||J}return J}function A(J){return B[J]=B[J]||{}}function F(L,J){var K=A(L);return K[J]=K[J]||[]}function H(K,J,L){var O=C(K);var N=F(O,J);if(N.pluck("handler").include(L)){return false}var M=function(P){if(!Event||!Event.extend||(P.eventName&&P.eventName!=J)){return false}Event.extend(P);L.call(K,P)};if(!(Prototype.Browser.IE)&&["mouseenter","mouseleave"].include(J)){M=M.wrap(function(R,Q){var P=Q.relatedTarget,T=Q.currentTarget;try{if(P&&P.nodeType==Node.TEXT_NODE){P=P.parentNode}if(P&&P!=T&&!P.descendantOf(T)){return R(Q)}}catch(S){return R(Q)}})}M.handler=L;N.push(M);return M}function I(M,J,K){var L=F(M,J);return L.find(function(N){return N.handler==K})}function D(M,J,K){var L=A(M);if(!L[J]){return false}L[J]=L[J].without(I(M,J,K))}function E(){for(var K in B){for(var J in B[K]){B[K][J]=null}}}if(window.attachEvent){window.attachEvent("onunload",E)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}return{observe:function(L,J,M){L=$(L);var K=G(J);var N=H(L,J,M);if(!N){return L}if(L.addEventListener){L.addEventListener(K,N,false)}else{L.attachEvent("on"+K,N)}return L},stopObserving:function(L,J,M){L=$(L);var O=C(L),K=G(J);if(!M&&J){F(O,J).each(function(P){L.stopObserving(J,P.handler)});return L}else{if(!J){Object.keys(A(O)).each(function(P){L.stopObserving(P)});return L}}var N=I(O,J,M);if(!N){return L}if(L.removeEventListener){L.removeEventListener(K,N,false)}else{L.detachEvent("on"+K,N)}D(O,J,M);return L},fire:function(L,K,J){L=$(L);if(L==document&&document.createEvent&&!L.dispatchEvent){L=document.documentElement}var M;if(document.createEvent){M=document.createEvent("HTMLEvents");M.initEvent("dataavailable",true,true)}else{M=document.createEventObject();M.eventType="ondataavailable"}M.eventName=K;M.memo=J||{};if(document.createEvent){L.dispatchEvent(M)}else{L.fireEvent(M.eventType,M)}return Event.extend(M)}}})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize(),loaded:false});Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B})},Top:function(A,B){return Element.insert(A,{top:B})},Bottom:function(A,B){return Element.insert(A,{bottom:B})},After:function(A,B){return Element.insert(A,{after:B})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C)}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth)},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth)},overlap:function(B,A){if(!B){return 0}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A)},relativize:function(A){Position.prepare();return Element.relativize(A)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]"}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[]}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ")})))){G.push(Element.extend(J))}}return G};return function(D,C){return $(C||document.body).getElementsByClassName(D)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return }this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return }this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart()}while(++B<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase()}}if(this.length==7){A=this.toLowerCase()}}}return(A.length==7?A:(arguments[0]||this))};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""))}).flatten().join("")};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return A};Element.getInlineOpacity=function(A){return $(A).style.opacity||""};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C)}catch(B){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5},reverse:function(A){return 1-A},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return A>1?1:A},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5},pulse:function(B,A){A=A||5;return(((B%(1/A))*A).round()==0?((B*A*2)-(B*A*2).floor()):1-((B*A*2)-(B*A*2).floor()))},spring:function(A){return 1-(Math.cos(A*4.5*Math.PI)*Math.exp(-A*6))},none:function(A){return 0},full:function(A){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(A){var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1"}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(new Element("span",{style:B}).update(D==" "?String.fromCharCode(160):D),C)});Element.remove(C)}})},multiple:function(B,C){var E;if(((typeof B=="object")||Object.isFunction(B))&&(B.length)){E=B}else{E=$(B).childNodes}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}))})},PAIRS:{"slide":["SlideDown","SlideUp"],"blind":["BlindDown","BlindUp"],"appear":["Appear","Fade"]},toggle:function(B,C){B=$(B);C=(C||"appear").toLowerCase();var A=Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},arguments[2]||{});Effect[B.visible()?Effect.PAIRS[C][1]:Effect.PAIRS[C][0]](B,A)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(A){this.effects._each(A)},add:function(B){var C=new Date().getTime();var A=Object.isString(B.options.queue)?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle"}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C)}}});Effect.Queues={instances:$H(),get:function(A){if(!Object.isString(A)){return A}return this.instances.get(A)||this.instances.set(A,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""))}if(options&&options.transition===false){options.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return }var B=(C-this.startOn)/this.totalTime,A=(B*this.totalFrames).round();if(A>this.currentFrame){this.render(B);this.currentFrame=A}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this)}if(this.options[A]){this.options[A](this)}},inspect:function(){var A=$H();for(property in this){if(!Object.isFunction(this[property])){A.set(property,this[property])}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Opacity=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A)},update:function(A){this.element.setOpacity(A)}});Effect.Fade=function(C){C=$(C);var A=C.getInlineOpacity();var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(D){if(D.options.to!=0){return }D.element.hide().setStyle({opacity:A})}},arguments[1]||{});return new Effect.Opacity(C,B)};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering()},beforeSetup:function(C){C.element.setOpacity(C.options.from).show()}},arguments[1]||{});return new Effect.Opacity(B,A)};Effect.FadeReplace=function(A){A=$(A);return new Effect.Fade(A,Object.extend({afterFinishInternal:function(B){B.element.innerHTML=B.options.innerHTML;new Effect.Appear(B.element,{duration:B.options.duration})}},arguments[1]||{}))};Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var B,A=$H();if(Prototype.Browser.WebKit){B=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';B=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(C){if(B[C]){A.set(C,B[C])}});if(Prototype.Browser.IE&&this.include("opacity")){A.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return A};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(B){var A=document.defaultView.getComputedStyle($(B),null);return Element.CSS_PROPERTIES.inject({},function(C,D){C[D]=A[D];return C})}}else{Element.getStyles=function(B){B=$(B);var A=B.currentStyle,C;C=Element.CSS_PROPERTIES.inject({},function(D,E){D[E]=A[E];return D});if(!C.opacity){C.opacity=B.getOpacity()}return C}}Effect.Methods={visualEffect:function(C,E,B){C=$(C);var D=E.dasherize().camelize(),A=D.charAt(0).toUpperCase()+D.substring(1);new Effect[A](C,B);return C}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(A){Effect.Methods[A]=function(C,B){C=$(C);Effect[A.charAt(0).toUpperCase()+A.substring(1)](C,B);return C}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(A){Effect.Methods[A]=Element[A]});Element.addMethods(Effect.Methods);var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(A){return binb2hex(core_sha1(str2binb(A),A.length*chrsz))}function b64_sha1(A){return binb2b64(core_sha1(str2binb(A),A.length*chrsz))}function str_sha1(A){return binb2str(core_sha1(str2binb(A),A.length*chrsz))}function hex_hmac_sha1(A,B){return binb2hex(core_hmac_sha1(A,B))}function b64_hmac_sha1(A,B){return binb2b64(core_hmac_sha1(A,B))}function str_hmac_sha1(A,B){return binb2str(core_hmac_sha1(A,B))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(N,H){N[H>>5]|=128<<(24-H%32);N[((H+64>>9)<<4)+15]=H;var O=Array(80);var M=1732584193;var L=-271733879;var K=-1732584194;var J=271733878;var I=-1009589776;for(var E=0;E<N.length;E+=16){var G=M;var F=L;var D=K;var C=J;var A=I;for(var B=0;B<80;B++){if(B<16){O[B]=N[E+B]}else{O[B]=rol(O[B-3]^O[B-8]^O[B-14]^O[B-16],1)}var P=safe_add(safe_add(rol(M,5),sha1_ft(B,L,K,J)),safe_add(safe_add(I,O[B]),sha1_kt(B)));I=J;J=K;K=rol(L,30);L=M;M=P}M=safe_add(M,G);L=safe_add(L,F);K=safe_add(K,D);J=safe_add(J,C);I=safe_add(I,A)}return Array(M,L,K,J,I)}function sha1_ft(B,A,D,C){if(B<20){return(A&D)|((~A)&C)}if(B<40){return A^D^C}if(B<60){return(A&D)|(A&C)|(D&C)}return A^D^C}function sha1_kt(A){return(A<20)?1518500249:(A<40)?1859775393:(A<60)?-1894007588:-899497514}function core_hmac_sha1(C,F){var E=str2binb(C);if(E.length>16){E=core_sha1(E,C.length*chrsz)}var A=Array(16),D=Array(16);for(var B=0;B<16;B++){A[B]=E[B]^909522486;D[B]=E[B]^1549556828}var G=core_sha1(A.concat(str2binb(F)),512+F.length*chrsz);return core_sha1(D.concat(G),512+160)}function safe_add(A,D){var C=(A&65535)+(D&65535);var B=(A>>16)+(D>>16)+(C>>16);return(B<<16)|(C&65535)}function rol(A,B){return(A<<B)|(A>>>(32-B))}function str2binb(D){var C=Array();var A=(1<<chrsz)-1;for(var B=0;B<D.length*chrsz;B+=chrsz){C[B>>5]|=(D.charCodeAt(B/chrsz)&A)<<(32-chrsz-B%32)}return C}function binb2str(C){var D="";var A=(1<<chrsz)-1;for(var B=0;B<C.length*32;B+=chrsz){D+=String.fromCharCode((C[B>>5]>>>(32-chrsz-B%32))&A)}return D}function binb2hex(C){var B=hexcase?"0123456789ABCDEF":"0123456789abcdef";var D="";for(var A=0;A<C.length*4;A++){D+=B.charAt((C[A>>2]>>((3-A%4)*8+4))&15)+B.charAt((C[A>>2]>>((3-A%4)*8))&15)}return D}function binb2b64(D){var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var F="";for(var B=0;B<D.length*4;B+=3){var E=(((D[B>>2]>>8*(3-B%4))&255)<<16)|(((D[B+1>>2]>>8*(3-(B+1)%4))&255)<<8)|((D[B+2>>2]>>8*(3-(B+2)%4))&255);for(var A=0;A<4;A++){if(B*8+A*6>D.length*32){F+=b64pad}else{F+=C.charAt((E>>6*(3-A))&63)}}}return F}Redsea={callbacks:{process:function(){},reset:function(){},eof:function(){},statuschanged:function(){},changemode:function(){}},channelcount:0,channels:{},frameref:null,protocol:"http",host:null,hostid:null,mode:"stream",frameloadtimeout:2000,initialpingtimeout:2000,pingtimeout:7000,reconnecttimeout:10,pingtimer:null,port:80,status:0,register:function(A){A.p=Redsea.process;A.r=Redsea.reset;A.e=Redsea.xhrerror;A.eof=Redsea.eof;A.ch=Redsea.channelInfo;clearTimeout(Redsea.frameloadtimer);Redsea.setstatus(4);Redsea.log("Frame registered");clearTimeout(Redsea.pingtimer);if(Redsea.mode=="iframe"||Redsea.mode=="xhrinteractive"){Redsea.pingtimer=setTimeout(Redsea.onPingTimeout,Redsea.initialpingtimeout)}},joinChannel:function(A,B){if(typeof (Redsea.channels[A])!="undefined"){throw"Cannot join channel "+A+": already subscribed"}Redsea.channels[A]={backtrack:B};Redsea.log("Joined channel "+A);Redsea.channelcount++;if(Redsea.status!=0&&Redsea.status!=6){Redsea.connect()}},leaveChannel:function(A){if(typeof (Redsea.channels[A])=="undefined"){throw"Cannot leave channel "+A+": not subscribed"}delete Redsea.channels[A];Redsea.log("Left channel "+A);Redsea.channelcount--;if(Redsea.channelcount&&Redsea.status!=0&&Redsea.status!=6){Redsea.connect()}else{Redsea.disconnect()}},connect:function(){Redsea.log("Connecting");if(!Redsea.host){throw"Redsea host not specified"}if(isNaN(Redsea.port)){throw"Redsea port not specified"}if(!Redsea.channelcount){throw"No channels specified"}if(Redsea.status){Redsea.disconnect()}Redsea.setstatus(1);if(!Redsea.hostid){Redsea.hostid=Redsea.time()+""+Math.floor(Math.random()*1000000)}if(Redsea.mode=="stream"){Redsea.mode=Redsea.selectStreamTransport()}Redsea.log("Selected "+Redsea.mode+" transport");if(Redsea.mode=="iframe"){Redsea.loadFrame(Redsea.getSubsUrl())}else{Redsea.loadFrame(Redsea.protocol+"://"+Redsea.host+((Redsea.port==80)?"":":"+Redsea.port)+"/stream.html")}Redsea.frameloadtimer=setTimeout(Redsea.onFrameLoadTimeout,Redsea.frameloadtimeout)},disconnect:function(){if(Redsea.status){clearTimeout(Redsea.pingtimer);clearTimeout(Redsea.frameloadtimer);if(typeof CollectGarbage=="function"){CollectGarbage()}if(Redsea.status!=6){Redsea.setstatus(0)}Redsea.log("Disconnected");try{Redsea.frameref.parentNode.removeChild(Redsea.frameref);delete Redsea.frameref;return true}catch(A){}try{Redsea.frameref.open();Redsea.frameref.close();return true}catch(A){}}},selectStreamTransport:function(){try{var B=ActiveXObject;return"iframe"}catch(A){}if((typeof window.addEventStream)=="function"){return"iframe"}return"xhrinteractive"},getSubsUrl:function(){var B=Redsea.protocol+"://"+Redsea.host+"/push/"+Redsea.hostid+"/"+Redsea.mode;for(var A in Redsea.channels){B+="/"+A;if(typeof Redsea.channels[A].lastmsgreceived!="undefined"){B+=".r"+(Redsea.channels[A].lastmsgreceived+1)}else{if(Redsea.channels[A].backtrack>0){B+=".b"+Redsea.channels[A].backtrack}else{if(Redsea.channels[A].backtrack!=undefined){B+=".h"}}}}B+="?nc="+Redsea.time();return B},loadFrame:function(A){try{if(!Redsea.frameref){var B=new ActiveXObject("htmlfile");Redsea.frameref=B}Redsea.frameref.open();Redsea.frameref.write("<html><script>");Redsea.frameref.write('document.domain="'+(document.domain)+'";');Redsea.frameref.write("<\/script></html>");Redsea.frameref.parentWindow.Redsea=Redsea;Redsea.frameref.close();var D=Redsea.frameref.createElement("div");Redsea.frameref.body.appendChild(D);D.innerHTML='<iframe src="'+A+'"></iframe>'}catch(C){if(!Redsea.frameref){var E=document.createElement("IFRAME");E.style.width="10px";E.style.height="10px";E.style.border="none";E.style.position="absolute";E.style.top="-10px";E.style.marginTop="-10px";E.style.zIndex="-20";E.Redsea=Redsea;document.body.appendChild(E);Redsea.frameref=E}Redsea.frameref.setAttribute("src",A)}},onPingTimeout:function(){Redsea.log("Ping timeout");if(Redsea.mode!="longpoll"){Redsea.log("Switching to long-polling");Redsea.mode="longpoll";Redsea.callbacks["changemode"]("poll");clearTimeout(Redsea.pingtimer)}setTimeout(Redsea.connect,Redsea.reconnecttimeout);Redsea.reconnecttimeout=Math.min(Redsea.reconnecttimeout*5,3000)},process:function(C,A,B){if(C==-1){Redsea.log("Ping");Redsea.ping()}else{if(typeof (Redsea.channels[A])!="undefined"){Redsea.log("Message "+C+" received on channel "+A+" (last id on channel: "+Redsea.channels[A].lastmsgreceived+")\n"+B);Redsea.callbacks["process"](B);Redsea.channels[A].lastmsgreceived=C}}Redsea.setstatus(5)},ping:function(){if(Redsea.pingtimer){clearTimeout(Redsea.pingtimer);Redsea.pingtimer=setTimeout(Redsea.onPingTimeout,Redsea.pingtimeout)}Redsea.setstatus(5)},reset:function(){if(Redsea.status!=6&&Redsea.status!=0){Redsea.log("Stream reset");Redsea.ping();Redsea.callbacks["reset"]();setTimeout(Redsea.connect,10)}},xhrerror:function(){Redsea.onPingTimeout()},eof:function(){Redsea.log("Received end of stream, will not reconnect");Redsea.callbacks["eof"]();Redsea.setstatus(6);Redsea.disconnect()},channelInfo:function(A,B){Redsea.channels[A].lastmsgreceived=B;Redsea.log("Received channel info for channel "+A+": resume from "+B);Redsea.reconnecttimeout=10},registerEventCallback:function(A,B){Function.prototype.andThen=function(D){var E=this;var C=Redsea.arguments;return function(F){E(C);D(F)}};if(typeof Redsea.callbacks[A]=="function"){Redsea.callbacks[A]=(Redsea.callbacks[A]).andThen(B)}else{Redsea.callbacks[A]=B}},onFrameLoadTimeout:function(){Redsea.log("Frame load timeout");clearTimeout(Redsea.frameloadtimer);Redsea.setstatus(3);Redsea.onPingTimeout()},setstatus:function(A){if(Redsea.status!=A){Redsea.status=A;Redsea.callbacks["statuschanged"](A)}},log:function(A){},time:function(){var A=new Date();return A.getTime()}};if(dwr==null){var dwr={}}if(dwr.engine==null){dwr.engine={}}if(DWREngine==null){var DWREngine=dwr.engine}dwr.engine.setErrorHandler=function(A){dwr.engine._errorHandler=A};dwr.engine.setWarningHandler=function(A){dwr.engine._warningHandler=A};dwr.engine.setTextHtmlHandler=function(A){dwr.engine._textHtmlHandler=A};dwr.engine.setTimeout=function(A){dwr.engine._timeout=A};dwr.engine.setPreHook=function(A){dwr.engine._preHook=A};dwr.engine.setPostHook=function(A){dwr.engine._postHook=A};dwr.engine.setHeaders=function(A){dwr.engine._headers=A};dwr.engine.setParameters=function(A){dwr.engine._parameters=A};dwr.engine.XMLHttpRequest=1;dwr.engine.IFrame=2;dwr.engine.ScriptTag=3;dwr.engine.setRpcType=function(A){if(A!=dwr.engine.XMLHttpRequest&&A!=dwr.engine.IFrame&&A!=dwr.engine.ScriptTag){dwr.engine._handleError(null,{name:"dwr.engine.invalidRpcType",message:"RpcType must be one of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag"});return }dwr.engine._rpcType=A};dwr.engine.setHttpMethod=function(A){if(A!="GET"&&A!="POST"){dwr.engine._handleError(null,{name:"dwr.engine.invalidHttpMethod",message:"Remoting method must be one of GET or POST"});return }dwr.engine._httpMethod=A};dwr.engine.setOrdered=function(A){dwr.engine._ordered=A};dwr.engine.setAsync=function(A){dwr.engine._async=A};dwr.engine.setActiveReverseAjax=function(A){};dwr.engine.defaultErrorHandler=function(B,A){dwr.engine._debug("Error: "+A.name+", "+A.message,true);if(B==null||B==""){alert("A server error has occured.")}else{if(B.indexOf("0x80040111")!=-1){dwr.engine._debug(B)}else{alert(B)}}};dwr.engine.defaultWarningHandler=function(B,A){dwr.engine._debug(B)};dwr.engine.beginBatch=function(){if(dwr.engine._batch){dwr.engine._handleError(null,{name:"dwr.engine.batchBegun",message:"Batch already begun"});return }dwr.engine._batch=dwr.engine._createBatch()};dwr.engine.endBatch=function(B){var A=dwr.engine._batch;if(A==null){dwr.engine._handleError(null,{name:"dwr.engine.batchNotBegun",message:"No batch in progress"});return }dwr.engine._batch=null;if(A.map.callCount==0){return }if(B){dwr.engine._mergeBatch(A,B)}if(dwr.engine._ordered&&dwr.engine._batchesLength!=0){dwr.engine._batchQueue[dwr.engine._batchQueue.length]=A}else{dwr.engine._sendData(A)}};dwr.engine.setPollMethod=function(A){dwr.engine.setPollType(A)};dwr.engine.setMethod=function(A){dwr.engine.setRpcType(A)};dwr.engine.setVerb=function(A){dwr.engine.setHttpMethod(A)};dwr.engine.setPollType=function(){dwr.engine._debug("Manually setting the Poll Type is not supported")};dwr.engine._scriptSessionId=null;dwr.engine._getScriptSessionId=function(){if(dwr.engine._scriptSessionId==null){dwr.engine._scriptSessionId=dwr.engine._origScriptSessionId+Math.floor(Math.random()*1000)}return dwr.engine._scriptSessionId};dwr.engine._errorHandler=dwr.engine.defaultErrorHandler;dwr.engine._warningHandler=dwr.engine.defaultWarningHandler;dwr.engine._preHook=null;dwr.engine._postHook=null;dwr.engine._batches={};dwr.engine._batchesLength=0;dwr.engine._batchQueue=[];dwr.engine._rpcType=dwr.engine.XMLHttpRequest;dwr.engine._httpMethod="POST";dwr.engine._ordered=false;dwr.engine._async=true;dwr.engine._batch=null;dwr.engine._timeout=0;dwr.engine._DOMDocument=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];dwr.engine._XMLHTTP=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];dwr.engine._activeReverseAjax=false;dwr.engine._outstandingIFrames=[];dwr.engine._pollReq=null;dwr.engine._pollCometInterval=200;dwr.engine._pollRetries=0;dwr.engine._maxPollRetries=0;dwr.engine._textHtmlHandler=null;dwr.engine._headers=null;dwr.engine._parameters=null;dwr.engine._postSeperator="\n";dwr.engine._defaultInterceptor=function(A){return A};dwr.engine._urlRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._contentRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._replyRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._nextBatchId=1;dwr.engine._propnames=["rpcType","httpMethod","async","timeout","errorHandler","warningHandler","textHtmlHandler"];dwr.engine._partialResponseNo=0;dwr.engine._partialResponseYes=1;dwr.engine._partialResponseFlush=2;dwr.engine._execute=function(K,B,I,H){var E=false;if(dwr.engine._batch==null){dwr.engine.beginBatch();E=true}var D=dwr.engine._batch;var G=[];for(var C=0;C<arguments.length-3;C++){G[C]=arguments[C+3]}if(D.path==null){D.path=K}else{if(D.path!=K){dwr.engine._handleError(D,{name:"dwr.engine.multipleServlets",message:"Can't batch requests to multiple DWR Servlets."});return }}var A;var J=G[G.length-1];if(typeof J=="function"||J==null){A={callback:G.pop()}}else{A=G.pop()}dwr.engine._mergeBatch(D,A);D.handlers[D.map.callCount]={exceptionHandler:A.exceptionHandler,callback:A.callback};var F="c"+D.map.callCount+"-";D.map[F+"scriptName"]=B;D.map[F+"methodName"]=I;D.map[F+"id"]=D.map.callCount;for(C=0;C<G.length;C++){dwr.engine._serializeAll(D,[],G[C],F+"param"+C)}D.map.callCount++;if(E){dwr.engine.endBatch()}};dwr.engine._poll=function(B){if(!dwr.engine._activeReverseAjax){return }var A=dwr.engine._createBatch();A.map.id=0;A.map.callCount=1;A.isPoll=true;if(dwr.engine._pollWithXhr=="true"){A.rpcType=dwr.engine.XMLHttpRequest;A.map.partialResponse=dwr.engine._partialResponseNo}else{if(navigator.userAgent.indexOf("Gecko/")!=-1){A.rpcType=dwr.engine.XMLHttpRequest;A.map.partialResponse=dwr.engine._partialResponseYes}else{if(navigator.userAgent.indexOf("; MSIE")!=-1){A.rpcType=dwr.engine.IFrame;A.map.partialResponse=dwr.engine._partialResponseYes}else{if(navigator.userAgent.indexOf("Safari/")!=-1){A.rpcType=dwr.engine.XMLHttpRequest;A.map.partialResponse=dwr.engine._partialResponseYes}else{A.rpcType=dwr.engine.XMLHttpRequest;A.map.partialResponse=dwr.engine._partialResponseNo}}}}A.httpMethod="POST";A.async=true;A.timeout=0;A.path=(B)?B:dwr.engine._defaultPath;A.preHooks=[];A.postHooks=[];A.errorHandler=dwr.engine._pollErrorHandler;A.warningHandler=dwr.engine._pollErrorHandler;A.handlers[0]={callback:function(C){dwr.engine._pollRetries=0;setTimeout("dwr.engine._poll()",C)}};dwr.engine._sendData(A);if(A.rpcType==dwr.engine.XMLHttpRequest&&A.map.partialResponse==dwr.engine._partialResponseYes){dwr.engine._checkCometPoll()}};dwr.engine._pollErrorHandler=function(B,A){dwr.engine._pollRetries++;dwr.engine._debug("Reverse Ajax poll failed (pollRetries="+dwr.engine._pollRetries+"): "+A.name+" : "+A.message);if(dwr.engine._pollRetries<dwr.engine._maxPollRetries){setTimeout("dwr.engine._poll()",10000)}else{dwr.engine._activeReverseAjax=false;dwr.engine._debug("Giving up.")}};dwr.engine._createBatch=function(){var A={map:{callCount:0,page:window.location.pathname+window.location.search,httpSessionId:dwr.engine._sessionId,scriptSessionId:dwr.engine._getScriptSessionId()},charsProcessed:0,paramCount:0,parameters:{},headers:{},isPoll:false,handlers:{},preHooks:[],postHooks:[],rpcType:dwr.engine._rpcType,httpMethod:dwr.engine._httpMethod,async:dwr.engine._async,timeout:dwr.engine._timeout,errorHandler:dwr.engine._errorHandler,warningHandler:dwr.engine._warningHandler,textHtmlHandler:dwr.engine._textHtmlHandler};if(dwr.engine._preHook){A.preHooks.push(dwr.engine._preHook)}if(dwr.engine._postHook){A.postHooks.push(dwr.engine._postHook)}var C,B;if(dwr.engine._headers){for(C in dwr.engine._headers){B=dwr.engine._headers[C];if(typeof B!="function"){A.headers[C]=B}}}if(dwr.engine._parameters){for(C in dwr.engine._parameters){B=dwr.engine._parameters[C];if(typeof B!="function"){A.parameters[C]=B}}}return A};dwr.engine._mergeBatch=function(A,D){var E,C;for(var B=0;B<dwr.engine._propnames.length;B++){E=dwr.engine._propnames[B];if(D[E]!=null){A[E]=D[E]}}if(D.preHook!=null){A.preHooks.unshift(D.preHook)}if(D.postHook!=null){A.postHooks.push(D.postHook)}if(D.headers){for(E in D.headers){C=D.headers[E];if(typeof C!="function"){A.headers[E]=C}}}if(D.parameters){for(E in D.parameters){C=D.parameters[E];if(typeof C!="function"){A.map["p-"+E]=""+C}}}};dwr.engine._getJSessionId=function(){var C=document.cookie.split(";");for(var B=0;B<C.length;B++){var A=C[B];while(A.charAt(0)==" "){A=A.substring(1,A.length)}if(A.indexOf(dwr.engine._sessionCookieName+"=")==0){return A.substring(dwr.engine._sessionCookieName.length+1,A.length)}}return""};dwr.engine._checkCometPoll=function(){for(var B=0;B<dwr.engine._outstandingIFrames.length;B++){var E="";var C=dwr.engine._outstandingIFrames[B];try{E=dwr.engine._getTextFromCometIFrame(C)}catch(A){dwr.engine._handleWarning(C.batch,A)}if(E!=""){dwr.engine._processCometResponse(E,C.batch)}}if(dwr.engine._pollReq){var D=dwr.engine._pollReq;var E=D.responseText;if(E!=null){dwr.engine._processCometResponse(E,D.batch)}}if(dwr.engine._outstandingIFrames.length>0||dwr.engine._pollReq){setTimeout("dwr.engine._checkCometPoll()",dwr.engine._pollCometInterval)}};dwr.engine._getTextFromCometIFrame=function(B){var A=B.contentWindow.document.body;if(A==null){return""}var C=A.innerHTML;if(C.indexOf("<PRE>")==0||C.indexOf("<pre>")==0){C=C.substring(5,C.length-7)}return C};dwr.engine._processCometResponse=function(D,E){if(E.charsProcessed==D.length){return }if(D.length==0){E.charsProcessed=0;return }var B=D.indexOf("//#DWR-START#",E.charsProcessed);if(B==-1){E.charsProcessed=D.length;return }var A=D.lastIndexOf("//#DWR-END#");if(A==-1){return }if(D.charCodeAt(A+11)==13&&D.charCodeAt(A+12)==10){E.charsProcessed=A+13}else{E.charsProcessed=A+11}var C=D.substring(B+13,A);dwr.engine._receivedBatch=E;dwr.engine._eval(C);dwr.engine._receivedBatch=null};dwr.engine._sendData=function(E){E.map.batchId=dwr.engine._nextBatchId;dwr.engine._nextBatchId++;dwr.engine._batches[E.map.batchId]=E;dwr.engine._batchesLength++;E.completed=false;for(var D=0;D<E.preHooks.length;D++){E.preHooks[D]()}E.preHooks=null;if(E.timeout&&E.timeout!=0){E.interval=setInterval(function(){dwr.engine._abortRequest(E)},E.timeout)}if(E.rpcType==dwr.engine.XMLHttpRequest){if(window.XMLHttpRequest){E.req=new XMLHttpRequest()}else{if(window.ActiveXObject&&!(navigator.userAgent.indexOf("Mac")>=0&&navigator.userAgent.indexOf("MSIE")>=0)){E.req=dwr.engine._newActiveXObject(dwr.engine._XMLHTTP)}}}var A,C;if(E.req){if(E.async){E.req.onreadystatechange=function(){if(typeof dwr!="undefined"){dwr.engine._stateChange(E)}}}if(E.isPoll){dwr.engine._pollReq=E.req;if(!document.all){E.req.batch=E}}var B=navigator.userAgent.indexOf("Safari/");if(B>=0){var G=navigator.userAgent.substring(B+7);if(parseInt(G,10)<400){if(dwr.engine._allowGetForSafariButMakeForgeryEasier=="true"){E.httpMethod="GET"}else{dwr.engine._handleWarning(E,{name:"dwr.engine.oldSafari",message:"Safari GET support disabled. See getahead.org/dwr/server/servlet and allowGetForSafariButMakeForgeryEasier."})}}}E.mode=E.isPoll?dwr.engine._ModePlainPoll:dwr.engine._ModePlainCall;C=dwr.engine._constructRequest(E);try{E.req.open(E.httpMethod,C.url,E.async);try{for(A in E.headers){var I=E.headers[A];if(typeof I=="string"){E.req.setRequestHeader(A,I)}}if(!E.headers["Content-Type"]){E.req.setRequestHeader("Content-Type","text/plain")}}catch(H){dwr.engine._handleWarning(E,H)}E.req.send(C.body);if(!E.async){dwr.engine._stateChange(E)}}catch(H){dwr.engine._handleError(E,H)}}else{if(E.rpcType!=dwr.engine.ScriptTag){var F=E.isPoll?"dwr-if-poll-"+E.map.batchId:"dwr-if-"+E.map["c0-id"];if(E.isPoll&&window.ActiveXObject){E.htmlfile=new window.ActiveXObject("htmlfile");E.htmlfile.open();E.htmlfile.write("<html>");E.htmlfile.write("<div><iframe className='wibble' src='javascript:void(0)' id='"+F+"' name='"+F+"' onload='dwr.engine._iframeLoadingComplete("+E.map.batchId+");'></iframe></div>");E.htmlfile.write("</html>");E.htmlfile.close();E.htmlfile.parentWindow.dwr=dwr;E.document=E.htmlfile}else{E.div=document.createElement("div");document.body.appendChild(E.div);E.div.innerHTML="<iframe src='javascript:void(0)' frameborder='0' style='width:0px;height:0px;border:0;' id='"+F+"' name='"+F+"' onload='dwr.engine._iframeLoadingComplete ("+E.map.batchId+");'></iframe>";E.document=document}E.iframe=E.document.getElementById(F);E.iframe.batch=E;E.mode=E.isPoll?dwr.engine._ModeHtmlPoll:dwr.engine._ModeHtmlCall;if(E.isPoll){dwr.engine._outstandingIFrames.push(E.iframe)}C=dwr.engine._constructRequest(E);if(E.httpMethod=="GET"){E.iframe.setAttribute("src",C.url)}else{E.form=E.document.createElement("form");E.form.setAttribute("id","dwr-form");E.form.setAttribute("action",C.url);E.form.setAttribute("target",F);E.form.target=F;E.form.setAttribute("method",E.httpMethod);for(A in E.map){var I=E.map[A];if(typeof I!="function"){var J=E.document.createElement("input");J.setAttribute("type","hidden");J.setAttribute("name",A);J.setAttribute("value",I);E.form.appendChild(J)}}E.document.body.appendChild(E.form);E.form.submit()}}else{E.httpMethod="GET";E.mode=E.isPoll?dwr.engine._ModePlainPoll:dwr.engine._ModePlainCall;C=dwr.engine._constructRequest(E);E.script=document.createElement("script");E.script.id="dwr-st-"+E.map["c0-id"];E.script.src=C.url;document.body.appendChild(E.script)}}};dwr.engine._ModePlainCall="/call/plaincall/";dwr.engine._ModeHtmlCall="/call/htmlcall/";dwr.engine._ModePlainPoll="/call/plainpoll/";dwr.engine._ModeHtmlPoll="/call/htmlpoll/";dwr.engine._constructRequest=function(A){var B={url:A.path+A.mode,body:null};if(A.isPoll==true){B.url+="Poll.req"}else{if(A.map.callCount==1){B.url+=A.map["c0-scriptName"]+"."+A.map["c0-methodName"]+".req"}else{B.url+="Batch."+A.map.callCount+".req"}}if(dwr.engine._getJSessionId()==""){B.url+=";jsessionid="+dwr.engine._sessionId}var C;if(A.httpMethod=="GET"){A.map.callCount=""+A.map.callCount;B.url+="?";for(C in A.map){if(typeof A.map[C]!="function"){B.url+=encodeURIComponent(C)+"="+encodeURIComponent(A.map[C])+"&"}}B.url=B.url.substring(0,B.url.length-1)}else{B.body="";for(C in A.map){if(typeof A.map[C]!="function"){B.body+=C+"="+A.map[C]+dwr.engine._postSeperator}}B.body=dwr.engine._contentRewriteHandler(B.body)}B.url=dwr.engine._urlRewriteHandler(B.url);return B};dwr.engine._stateChange=function(C){var B;if(C.completed){dwr.engine._debug("Error: _stateChange() with batch.completed");return }var F=C.req;try{if(F.readyState!=4){return }}catch(D){dwr.engine._handleWarning(C,D);dwr.engine._clearUp(C);return }try{var E=F.responseText;E=dwr.engine._replyRewriteHandler(E);var A=F.status;if(E==null||E==""){dwr.engine._handleWarning(C,{name:"dwr.engine.missingData",message:"No data received from server"})}else{if(A!=200){dwr.engine._handleError(C,{name:"dwr.engine.http."+A,message:F.statusText})}else{var G=F.getResponseHeader("Content-Type");if(!G.match(/^text\/plain/)&&!G.match(/^text\/javascript/)){if(G.match(/^text\/html/)&&typeof C.textHtmlHandler=="function"){C.textHtmlHandler()}else{dwr.engine._handleWarning(C,{name:"dwr.engine.invalidMimeType",message:"Invalid content type: '"+G+"'"})}}else{if(C.isPoll&&C.map.partialResponse==dwr.engine._partialResponseYes){dwr.engine._processCometResponse(E,C)}else{if(E.search("//#DWR")==-1){dwr.engine._handleWarning(C,{name:"dwr.engine.invalidReply",message:"Invalid reply from server"})}else{B=E}}}}}}catch(D){dwr.engine._handleWarning(C,D)}dwr.engine._callPostHooks(C);dwr.engine._receivedBatch=C;if(B!=null){B=B.replace(dwr.engine._scriptTagProtection,"")}dwr.engine._eval(B);dwr.engine._receivedBatch=null;dwr.engine._validateBatch(C);dwr.engine._clearUp(C)};dwr.engine._validateBatch=function(A){if(!A.completed){for(var B=0;B<A.map.callCount;B++){if(A.handlers[B]!=null){dwr.engine._handleWarning(A,{name:"dwr.engine.incompleteReply",message:"Incomplete reply from server"});break}}}};dwr.engine._iframeLoadingComplete=function(A){var B=dwr.engine._batches[A];if(B){dwr.engine._validateBatch(B)}};dwr.engine._remoteHandleCallback=function(A,F,E){var C=dwr.engine._batches[A];if(A==0){return }if(C==null){dwr.engine._debug("Warning: batch == null in remoteHandleCallback for batchId="+A,true);return }try{var B=C.handlers[F];C.handlers[F]=null;if(!B){dwr.engine._debug("Warning: Missing handlers. callId="+F,true)}else{if(typeof B.callback=="function"){B.callback(E)}}}catch(D){dwr.engine._handleError(C,D)}};dwr.engine._remoteHandleException=function(A,E,D){var C=dwr.engine._batches[A];if(C==null){dwr.engine._debug("Warning: null batch in remoteHandleException",true);return }var B=C.handlers[E];C.handlers[E]=null;if(B==null){dwr.engine._debug("Warning: null handlers in remoteHandleException",true);return }if(D.message==undefined){D.message=""}if(typeof B.exceptionHandler=="function"){B.exceptionHandler(D.message,D)}else{if(typeof C.errorHandler=="function"){C.errorHandler(D.message,D)}}};dwr.engine._remoteHandleBatchException=function(C,A){var B=(dwr.engine._receivedBatch==null&&A!=null);if(B){dwr.engine._receivedBatch=dwr.engine._batches[A]}if(C.message==undefined){C.message=""}dwr.engine._handleError(dwr.engine._receivedBatch,C);if(B){dwr.engine._receivedBatch=null;dwr.engine._clearUp(dwr.engine._batches[A])}};dwr.engine._remotePollCometDisabled=function(C,A){dwr.engine.setActiveReverseAjax(false);var B=(dwr.engine._receivedBatch==null&&A!=null);if(B){dwr.engine._receivedBatch=dwr.engine._batches[A]}if(C.message==undefined){C.message=""}dwr.engine._handleError(dwr.engine._receivedBatch,C);if(B){dwr.engine._receivedBatch=null;dwr.engine._clearUp(dwr.engine._batches[A])}};dwr.engine._remoteBeginIFrameResponse=function(B,A){if(B!=null){dwr.engine._receivedBatch=B.batch}dwr.engine._callPostHooks(dwr.engine._receivedBatch)};dwr.engine._remoteEndIFrameResponse=function(A){dwr.engine._clearUp(dwr.engine._receivedBatch);dwr.engine._receivedBatch=null};dwr.engine._eval=function(script){if(script==null){return null}if(script==""){dwr.engine._debug("Warning: blank script",true);return null}return eval(script)};dwr.engine._abortRequest=function(A){if(A&&!A.completed){clearInterval(A.interval);dwr.engine._clearUp(A);if(A.req){A.req.abort()}dwr.engine._handleError(A,{name:"dwr.engine.timeout",message:"Timeout"})}};dwr.engine._callPostHooks=function(A){if(A.postHooks){for(var B=0;B<A.postHooks.length;B++){A.postHooks[B]()}A.postHooks=null}};dwr.engine._clearUp=function(B){if(!B){dwr.engine._debug("Warning: null batch in dwr.engine._clearUp()",true);return }if(B.completed=="true"){dwr.engine._debug("Warning: Double complete",true);return }if(B.div){B.div.parentNode.removeChild(B.div)}if(B.iframe){for(var C=0;C<dwr.engine._outstandingIFrames.length;C++){if(dwr.engine._outstandingIFrames[C]==B.iframe){dwr.engine._outstandingIFrames.splice(C,1)}}B.iframe.parentNode.removeChild(B.iframe);B.iframe=null}if(B.form){B.form.parentNode.removeChild(B.form)}if(B.req){if(B.req==dwr.engine._pollReq){dwr.engine._pollReq=null}delete B.req}if(B.map&&B.map.batchId){delete dwr.engine._batches[B.map.batchId];dwr.engine._batchesLength--}B.completed=true;if(dwr.engine._batchQueue.length!=0){var A=dwr.engine._batchQueue.shift();dwr.engine._sendData(A)}};dwr.engine._handleError=function(A,B){if(typeof B=="string"){B={name:"unknown",message:B}}if(B.message==null){B.message=""}if(B.name==null){B.name="unknown"}if(A&&typeof A.errorHandler=="function"){A.errorHandler(B.message,B)}else{if(dwr.engine._errorHandler){dwr.engine._errorHandler(B.message,B)}}if(A){dwr.engine._clearUp(A)}};dwr.engine._handleWarning=function(A,B){if(typeof B=="string"){B={name:"unknown",message:B}}if(B.message==null){B.message=""}if(B.name==null){B.name="unknown"}if(A&&typeof A.warningHandler=="function"){A.warningHandler(B.message,B)}else{if(dwr.engine._warningHandler){dwr.engine._warningHandler(B.message,B)}}if(A){dwr.engine._clearUp(A)}};dwr.engine._serializeAll=function(B,D,C,A){if(C==null){B.map[A]="null:null";return }switch(typeof C){case"boolean":B.map[A]="boolean:"+C;break;case"number":B.map[A]="number:"+C;break;case"string":B.map[A]="string:"+encodeURIComponent(C);break;case"object":if(C instanceof String){B.map[A]="String:"+encodeURIComponent(C)}else{if(C instanceof Boolean){B.map[A]="Boolean:"+C}else{if(C instanceof Number){B.map[A]="Number:"+C}else{if(C instanceof Date){B.map[A]="Date:"+C.getTime()}else{if(C&&C.join){B.map[A]=dwr.engine._serializeArray(B,D,C,A)}else{B.map[A]=dwr.engine._serializeObject(B,D,C,A)}}}}}break;case"function":break;default:dwr.engine._handleWarning(null,{name:"dwr.engine.unexpectedType",message:"Unexpected type: "+typeof C+", attempting default converter."});B.map[A]="default:"+C;break}};dwr.engine._lookup=function(E,C,A){var D;for(var B=0;B<E.length;B++){if(E[B].data==C){D=E[B];break}}if(D){return"reference:"+D.name}E.push({data:C,name:A});return null};dwr.engine._serializeObject=function(C,H,G,B){var F=dwr.engine._lookup(H,G,B);if(F){return F}if(G.nodeName&&G.nodeType){return dwr.engine._serializeXml(C,H,G,B)}var E="Object_"+dwr.engine._getObjectClassName(G)+":{";var D;for(D in G){if(typeof G[D]!="function"){C.paramCount++;var A="c"+dwr.engine._batch.map.callCount+"-e"+C.paramCount;dwr.engine._serializeAll(C,H,G[D],A);E+=encodeURIComponent(D)+":reference:"+A+", "}}if(E.substring(E.length-2)==", "){E=E.substring(0,E.length-2)}E+="}";return E};dwr.engine._errorClasses={"Error":Error,"EvalError":EvalError,"RangeError":RangeError,"ReferenceError":ReferenceError,"SyntaxError":SyntaxError,"TypeError":TypeError,"URIError":URIError};dwr.engine._getObjectClassName=function(C){if(C&&C.constructor&&C.constructor.toString){var D=C.constructor.toString();var A=D.match(/function\s+(\w+)/);if(A&&A.length==2){return A[1]}}if(C&&C.constructor){for(var B in dwr.engine._errorClasses){if(C.constructor==dwr.engine._errorClasses[B]){return B}}}if(C){var D=Object.prototype.toString.call(C);var A=D.match(/\[object\s+(\w+)/);if(A&&A.length==2){return A[1]}}return"Object"};dwr.engine._serializeXml=function(C,F,E,B){var D=dwr.engine._lookup(F,E,B);if(D){return D}var A;if(window.XMLSerializer){A=new XMLSerializer().serializeToString(E)}else{if(E.toXml){A=E.toXml}else{A=E.innerHTML}}return"XML:"+encodeURIComponent(A)};dwr.engine._serializeArray=function(C,H,G,B){var F=dwr.engine._lookup(H,G,B);if(F){return F}var E="Array:[";for(var D=0;D<G.length;D++){if(D!=0){E+=","}C.paramCount++;var A="c"+dwr.engine._batch.map.callCount+"-e"+C.paramCount;dwr.engine._serializeAll(C,H,G[D],A);E+="reference:";E+=A}E+="]";return E};dwr.engine._unserializeDocument=function(A){var C;if(window.DOMParser){var E=new DOMParser();C=E.parseFromString(A,"text/xml");if(!C.documentElement||C.documentElement.tagName=="parsererror"){var B=C.documentElement.firstChild.data;B+="\n"+C.documentElement.firstChild.nextSibling.firstChild.data;throw B}return C}else{if(window.ActiveXObject){C=dwr.engine._newActiveXObject(dwr.engine._DOMDocument);C.loadXML(A);return C}else{var D=document.createElement("div");D.innerHTML=A;return D}}};dwr.engine._newActiveXObject=function(A){var D;for(var C=0;C<A.length;C++){try{D=new ActiveXObject(A[C]);break}catch(B){}}return D};dwr.engine._debug=function(F,D){var A=false;try{if(window.console){if(D&&window.console.trace){window.console.trace()}window.console.log(F);A=true}else{if(window.opera&&window.opera.postError){window.opera.postError(F);A=true}}}catch(C){}if(!A){var B=document.getElementById("dwr-debug");if(B){var E=F+"<br/>"+B.innerHTML;if(E.length>2048){E=E.substring(0,2048)}B.innerHTML=E}}};Gettext=function(C){this.domain="messages";this.locale_data=undefined;var B=["domain","locale_data"];if(this.isValidObject(C)){for(var D in C){for(var A=0;A<B.length;A++){if(D==B[A]){if(this.isValidObject(C[D])){this[D]=C[D]}}}}}this.try_load_lang();return this};Gettext.context_glue="004";Gettext._locale_data={};Gettext.prototype.try_load_lang=function(){if(typeof (this.locale_data)!="undefined"){var D=this.locale_data;this.locale_data=undefined;this.parse_locale_data(D);if(typeof (Gettext._locale_data[this.domain])=="undefined"){throw new Error("Error: Gettext 'locale_data' does not contain the domain '"+this.domain+"'")}}var B=this.get_lang_refs();if(typeof (B)=="object"&&B.length>0){for(var A=0;A<B.length;A++){var C=B[A];if(C.type=="application/json"){if(!this.try_load_lang_json(C.href)){throw new Error("Error: Gettext 'try_load_lang_json' failed. Unable to exec xmlhttprequest for link ["+C.href+"]")}}else{if(C.type=="application/x-po"){if(!this.try_load_lang_po(C.href)){throw new Error("Error: Gettext 'try_load_lang_po' failed. Unable to exec xmlhttprequest for link ["+C.href+"]")}}else{throw new Error("TODO: link type ["+C.type+"] found, and support is planned, but not implemented at this time.")}}}}};Gettext.prototype.parse_locale_data=function(F){if(typeof (Gettext._locale_data)=="undefined"){Gettext._locale_data={}}for(var E in F){if((!F.hasOwnProperty(E))||(!this.isValidObject(F[E]))){continue}var B=false;for(var A in F[E]){B=true;break}if(!B){continue}var G=F[E];if(E==""){E="messages"}if(!this.isValidObject(Gettext._locale_data[E])){Gettext._locale_data[E]={}}if(!this.isValidObject(Gettext._locale_data[E].head)){Gettext._locale_data[E].head={}}if(!this.isValidObject(Gettext._locale_data[E].msgs)){Gettext._locale_data[E].msgs={}}for(var M in G){if(M==""){var I=G[M];for(var L in I){var H=L.toLowerCase();Gettext._locale_data[E].head[H]=I[L]}}else{Gettext._locale_data[E].msgs[M]=G[M]}}}for(var E in Gettext._locale_data){if(this.isValidObject(Gettext._locale_data[E].head["plural-forms"])&&typeof (Gettext._locale_data[E].head.plural_func)=="undefined"){var K=Gettext._locale_data[E].head["plural-forms"];var D=new RegExp("^(\\s*nplurals\\s*=\\s*[0-9]+\\s*;\\s*plural\\s*=\\s*(?:\\s|[-\\?\\|&=!<>+*/%:;a-zA-Z0-9_()])+)","m");if(D.test(K)){var J=Gettext._locale_data[E].head["plural-forms"];if(!/;\s*$/.test(J)){J=J.concat(";")}var C="var plural; var nplurals; "+J+' return { "nplural" : nplurals, "plural" : (plural === true ? 1 : plural ? plural : 0) };';Gettext._locale_data[E].head.plural_func=new Function("n",C)}else{throw new Error("Syntax error in language file. Plural-Forms header is invalid ["+K+"]")}}else{if(typeof (Gettext._locale_data[E].head.plural_func)=="undefined"){Gettext._locale_data[E].head.plural_func=function(O){var N=(O!=1)?1:0;return{"nplural":2,"plural":N}}}}}return };Gettext.prototype.try_load_lang_po=function(B){var D=this.sjax(B);if(!D){return }var C=this.uri_basename(B);var A=this.parse_po(D);var E={};if(A){if(!A[""]){A[""]={}}if(!A[""]["domain"]){A[""]["domain"]=C}C=A[""]["domain"];E[C]=A;this.parse_locale_data(E)}return 1};Gettext.prototype.uri_basename=function(B){var C;if(C=B.match(/^(.*\/)?(.*)/)){var A;if(A=C[2].match(/^(.*)\..+$/)){return A[1]}else{return C[2]}}else{return""}};Gettext.prototype.try_load_lang_json=function(A){var B=this.sjax(A);if(!B){return }var C=this.JSON(B);this.parse_locale_data(C);return 1};Gettext.prototype.get_lang_refs=function(){var C=new Array();var A=document.getElementsByTagName("link");for(var B=0;B<A.length;B++){if(A[B].rel=="gettext"&&A[B].href){if(typeof (A[B].type)=="undefined"||A[B].type==""){if(/\.json$/i.test(A[B].href)){A[B].type="application/json"}else{if(/\.js$/i.test(A[B].href)){A[B].type="application/json"}else{if(/\.po$/i.test(A[B].href)){A[B].type="application/x-po"}else{if(/\.mo$/i.test(A[B].href)){A[B].type="application/x-mo"}else{throw new Error("LINK tag with rel=gettext found, but the type and extension are unrecognized.")}}}}}A[B].type=A[B].type.toLowerCase();if(A[B].type=="application/json"){A[B].type="application/json"}else{if(A[B].type=="text/javascript"){A[B].type="application/json"}else{if(A[B].type=="application/x-po"){A[B].type="application/x-po"}else{if(A[B].type=="application/x-mo"){A[B].type="application/x-mo"}else{throw new Error("LINK tag with rel=gettext found, but the type attribute ["+A[B].type+"] is unrecognized.")}}}}C.push(A[B])}}return C};Gettext.prototype.textdomain=function(A){if(A&&A.length){this.domain=A}return this.domain};Gettext.prototype.gettext=function(C){var E;var A;var D;var B;return this.dcnpgettext(null,E,C,A,D,B)};Gettext.prototype.dgettext=function(D,C){var F;var A;var E;var B;return this.dcnpgettext(D,F,C,A,E,B)};Gettext.prototype.dcgettext=function(D,C,B){var F;var A;var E;return this.dcnpgettext(D,F,C,A,E,B)};Gettext.prototype.ngettext=function(C,A,E){var D;var B;return this.dcnpgettext(null,D,C,A,E,B)};Gettext.prototype.dngettext=function(D,C,A,F){var E;var B;return this.dcnpgettext(D,E,C,A,F,B)};Gettext.prototype.dcngettext=function(D,C,A,F,B){var E;return this.dcnpgettext(D,E,C,A,F,B,B)};Gettext.prototype.pgettext=function(E,C){var A;var D;var B;return this.dcnpgettext(null,E,C,A,D,B)};Gettext.prototype.dpgettext=function(D,F,C){var A;var E;var B;return this.dcnpgettext(D,F,C,A,E,B)};Gettext.prototype.dcpgettext=function(D,F,C,B){var A;var E;return this.dcnpgettext(D,F,C,A,E,B)};Gettext.prototype.npgettext=function(E,C,A,D){var B;return this.dcnpgettext(null,E,C,A,D,B)};Gettext.prototype.dnpgettext=function(D,F,C,A,E){var B;return this.dcnpgettext(D,F,C,A,E,B)};Gettext.prototype.dcnpgettext=function(U,E,T,O,J,L){if(!this.isValidObject(T)){return""}var G=this.isValidObject(O);var Q=this.isValidObject(E)?E+Gettext.context_glue+T:T;var A=this.isValidObject(U)?U:this.isValidObject(this.domain)?this.domain:"messages";var S="LC_MESSAGES";var L=5;var K=new Array();if(typeof (Gettext._locale_data)!="undefined"&&this.isValidObject(Gettext._locale_data[A])){K.push(Gettext._locale_data[A])}else{if(typeof (Gettext._locale_data)!="undefined"){for(var R in Gettext._locale_data){K.push(Gettext._locale_data[R])}}}var B=[];var F=false;var I;if(K.length){for(var P=0;P<K.length;P++){var N=K[P];if(this.isValidObject(N.msgs[Q])){for(var M=0;M<N.msgs[Q].length;M++){B[M]=N.msgs[Q][M]}B.shift();I=N;F=true;if(B.length>0&&B[0].length!=0){break}}}}if(B.length==0||B[0].length==0){B=[T,O]}var D=B[0];if(G){var H;if(F&&this.isValidObject(I.head.plural_func)){var C=I.head.plural_func(J);if(!C.plural){C.plural=0}if(!C.nplural){C.nplural=0}if(C.nplural<=C.plural){C.plural=0}H=C.plural}else{H=(J!=1)?1:0}if(this.isValidObject(B[H])){D=B[H]}}return D};Gettext.strargs=function(G,C){if(null==C||"undefined"==typeof (C)){C=[]}else{if(C.constructor!=Array){C=[C]}}var F="";while(true){var D=G.indexOf("%");var A;if(D==-1){F+=G;break}F+=G.substr(0,D);if(G.substr(D,2)=="%%"){F+="%";G=G.substr((D+2))}else{if(A=G.substr(D).match(/^%(\d+)/)){var E=parseInt(A[1]);var B=A[1].length;if(E>0&&C[E-1]!=null&&typeof (C[E-1])!="undefined"){F+=C[E-1]}G=G.substr((D+1+B))}else{F+="%";G=G.substr((D+1))}}}return F};Gettext.prototype.strargs=function(B,A){return Gettext.strargs(B,A)};Gettext.prototype.isArray=function(A){return this.isValidObject(A)&&A.constructor==Array};Gettext.prototype.isValidObject=function(A){if(null==A){return false}else{if("undefined"==typeof (A)){return false}else{return true}}};Gettext.prototype.sjax=function(D){var C;if(window.XMLHttpRequest){C=new XMLHttpRequest()}else{if(navigator.userAgent.toLowerCase().indexOf("msie 5")!=-1){C=new ActiveXObject("Microsoft.XMLHTTP")}else{C=new ActiveXObject("Msxml2.XMLHTTP")}}if(!C){throw new Error("Your browser doesn't do Ajax. Unable to support external language files.")}C.open("GET",D,false);try{C.send(null)}catch(E){return }var A=C.status;if(A==200||A==0){return C.responseText}else{var B=C.statusText+" (Error "+C.status+")";if(C.responseText.length){B+="\n"+C.responseText}alert(B);return }};Gettext.prototype.JSON=function(data){return eval("("+data+")")};function SoundManager(B,A){this.flashVersion=8;this.debugMode=false;this.useConsole=true;this.consoleOnly=false;this.waitForWindowLoad=false;this.nullURL="data/null.mp3";this.defaultOptions={"autoLoad":false,"stream":true,"autoPlay":false,"onid3":null,"onload":null,"whileloading":null,"onplay":null,"onpause":null,"onresume":null,"whileplaying":null,"onstop":null,"onfinish":null,"onbeforefinish":null,"onbeforefinishtime":5000,"onbeforefinishcomplete":null,"onjustbeforefinish":null,"onjustbeforefinishtime":200,"multiShot":true,"usePeakData":false,"useSpectrumData":false,"position":null,"pan":0,"volume":100};this.allowPolling=true;var C=this;this.version=null;this.versionNumber="V2.75a.20080707";this.movieURL=null;this.url=null;this.swfLoaded=false;this.enabled=false;this.o=null;this.id=(A||"sm2movie");this.oMC=null;this.sounds=[];this.soundIDs=[];this.isIE=(navigator.userAgent.match(/MSIE/));this.isSafari=(navigator.userAgent.match(/safari/i));this.debugID="soundmanager-debug";this._debugOpen=true;this._didAppend=false;this._appendSuccess=false;this._didInit=false;this._disabled=false;this._windowLoaded=false;this._hasConsole=(typeof console!="undefined"&&typeof console.log!="undefined");this._debugLevels=["log","info","warn","error"];this._defaultFlashVersion=9;this.features={peakData:false,spectrumData:false};this.sandbox={"type":null,"types":{"remote":"remote (domain-based) rules","localWithFile":"local with file access (no internet access)","localWithNetwork":"local with network (internet access only, no local access)","localTrusted":"local, trusted (local + internet access)"},"description":null,"noRemote":null,"noLocal":null};this._setVersionInfo=function(){if(C.flashVersion!=8&&C.flashVersion!=9){alert('soundManager.flashVersion must be 8 or 9. "'+C.flashVersion+'" is invalid. Reverting to '+C._defaultFlashVersion+".");C.flashVersion=C._defaultFlashVersion}C.version=C.versionNumber+(C.flashVersion==9?" (AS3/Flash 9)":" (AS2/Flash 8)");C.movieURL=(C.flashVersion==8?"sound-d9f4ae80.swf":"sound_f9.swf");C.features.peakData=(C.flashVersion>=9);C.features.spectrumData=(C.flashVersion>=9)};this._overHTTP=(document.location?document.location.protocol.match(/http/i):null);this._waitingforEI=false;this._initPending=false;this._tryInitOnFocus=(this.isSafari&&typeof document.hasFocus=="undefined");this._isFocused=(typeof document.hasFocus!="undefined"?document.hasFocus():null);this._okToDisable=!this._tryInitOnFocus;var D="http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";this.supported=function(){return(C._didInit&&!C._disabled)};this.getMovie=function(G){return C.isIE?window[G]:(C.isSafari?document.getElementById(G+"embed")||document[G+"embed"]:document.getElementById(G+"embed"))};this.loadFromXML=function(G){try{C.o._loadFromXML(G)}catch(H){C._failSafely();return true}};this.createSound=function(G){if(!C._didInit){throw new Error("soundManager.createSound(): Not loaded yet - wait for soundManager.onload() before calling sound-related methods")}if(arguments.length==2){G={"id":arguments[0],"url":arguments[1]}}var H=C._mergeObjects(G);C._writeDebug("soundManager.createSound(): "+H.id+" ("+H.url+")",1);if(C._idCheck(H.id,true)){C._writeDebug("soundManager.createSound(): "+H.id+" exists",1);return C.sounds[H.id]}C.sounds[H.id]=new E(C,H);C.soundIDs[C.soundIDs.length]=H.id;try{if(C.flashVersion==8){C.o._createSound(H.id,H.onjustbeforefinishtime)}else{C.o._createSound(H.id,H.url,H.onjustbeforefinishtime,H.usePeakData,H.useSpectrumData)}}catch(I){C._failSafely();return true}if(H.autoLoad||H.autoPlay){window.setTimeout(function(){C.sounds[H.id].load(H)},20)}if(H.autoPlay){C.sounds[H.id].playState=1}return C.sounds[H.id]};this.destroySound=function(G){if(!C._idCheck(G)){return false}for(var H=0;H<C.soundIDs.length;H++){if(C.soundIDs[H]==G){C.soundIDs.splice(H,1);continue}}C.sounds[G].unload();delete C.sounds[G]};this.load=function(G,H){if(!C._idCheck(G)){return false}C.sounds[G].load(H)};this.unload=function(G){if(!C._idCheck(G)){return false}C.sounds[G].unload()};this.play=function(G,H){if(!C._idCheck(G)){if(typeof H!="Object"){H={url:H}}if(H&&H.url){C._writeDebug('soundController.play(): attempting to create "'+G+'"',1);H.id=G;C.createSound(H)}else{return false}}C.sounds[G].play(H)};this.start=this.play;this.setPosition=function(G,H){if(!C._idCheck(G)){return false}C.sounds[G].setPosition(H)};this.stop=function(G){if(!C._idCheck(G)){return false}C._writeDebug("soundManager.stop("+G+")",1);C.sounds[G].stop()};this.stopAll=function(){C._writeDebug("soundManager.stopAll()",1);for(var G in C.sounds){if(C.sounds[G] instanceof E){C.sounds[G].stop()}}};this.pause=function(G){if(!C._idCheck(G)){return false}C.sounds[G].pause()};this.resume=function(G){if(!C._idCheck(G)){return false}C.sounds[G].resume()};this.togglePause=function(G){if(!C._idCheck(G)){return false}C.sounds[G].togglePause()};this.setPan=function(G,H){if(!C._idCheck(G)){return false}C.sounds[G].setPan(H)};this.setVolume=function(H,G){if(!C._idCheck(H)){return false}C.sounds[H].setVolume(G)};this.mute=function(G){if(!G){var H=null;C._writeDebug("soundManager.mute(): Muting all sounds");for(H in C.sounds){C.sounds[H].mute()}}else{if(!C._idCheck(G)){return false}C._writeDebug('soundManager.mute(): Muting "'+G+'"');C.sounds[G].mute()}};this.unmute=function(G){if(!G){var H=null;C._writeDebug("soundManager.unmute(): Unmuting all sounds");for(H in C.sounds){C.sounds[H].unmute()}}else{if(!C._idCheck(G)){return false}C._writeDebug('soundManager.unmute(): Unmuting "'+G+'"');C.sounds[G].unmute()}};this.setPolling=function(G){if(!C.o||!C.allowPolling){return false}C.o._setPolling(G)};this.disable=function(){if(C._disabled){return false}C._disabled=true;C._writeDebug("soundManager.disable(): Disabling all functions - future calls will return false.",1);for(var G=C.soundIDs.length;G--;){C._disableObject(C.sounds[C.soundIDs[G]])}C.initComplete();C._disableObject(C)};this.getSoundById=function(H,I){if(!H){throw new Error("SoundManager.getSoundById(): sID is null/undefined")}var G=C.sounds[H];if(!G&&!I){C._writeDebug('"'+H+'" is an invalid sound ID.',2)}return G};this.onload=function(){soundManager._writeDebug("<em>Warning</em>: soundManager.onload() is undefined.",2)};this.onerror=function(){};this._idCheck=this.getSoundById;this._disableObject=function(H){for(var G in H){if(typeof H[G]=="function"&&typeof H[G]._protected=="undefined"){H[G]=function(){return false}}}G=null};this._failSafely=function(){var I="You may need to whitelist this location/domain eg. file:///C:/ or C:/ or mysite.com, or set ALWAYS ALLOW under the Flash Player Global Security Settings page. The latter is probably less-secure.";var H='<a href="'+D+'" title="'+I+'">view/edit</a>';var G='<a href="'+D+'" title="Flash Player Global Security Settings">FPGSS</a>';if(!C._disabled){C._writeDebug("soundManager: Failed to initialise.",2);C.disable()}};this._normalizeMovieURL=function(G){if(G){if(G.match(/\.swf/)){G=G.substr(0,G.lastIndexOf(".swf"))}if(G.lastIndexOf("/")!=G.length-1){G=G+"/"}}return(G&&G.lastIndexOf("/")!=-1?G.substr(0,G.lastIndexOf("/")+1):"./")+C.movieURL};this._createMovie=function(I,H){if(C._didAppend&&C._appendSuccess){return false}if(window.location.href.indexOf("debug=1")+1){C.debugMode=true}C._didAppend=true;C._setVersionInfo();C.url=location.protocol+"//"+document.domain+"/"+C.movieURL;H=C.url;var M=['<object id="'+I+'" data="'+H+'" type="application/x-shockwave-flash" width="1" height="1"><param name="movie" value="'+H+'" /><param name="AllowScriptAccess" value="always" /></object>','<object id="'+I+'embed" data="'+H+'" type="application/x-shockwave-flash" width="1" height="1"><param name="movie" value="'+H+'" /><param name="AllowScriptAccess" value="always" /></object>'];var P='<div id="'+C.debugID+'-toggle" style="position:fixed;_position:absolute;right:0px;bottom:0px;_top:0px;width:1.2em;height:1.2em;line-height:1.2em;margin:2px;padding:0px;text-align:center;border:1px solid #999;cursor:pointer;background:#fff;color:#333;z-index:706" title="Toggle SM2 debug console" onclick="soundManager._toggleDebug()">-</div>';var N='<div id="'+C.debugID+'" style="display:'+(C.debugMode&&((!C._hasConsole||!C.useConsole)||(C.useConsole&&C._hasConsole&&!C.consoleOnly))?"block":"none")+';opacity:0.85"></div>';var L="soundManager._createMovie(): appendChild/innerHTML set failed. May be app/xhtml+xml DOM-related.";var J='<div style="position:absolute;left:-256px;top:-256px;width:1px;height:1px" class="movieContainer">'+M[C.isIE?0:1]+"</div>"+(C.debugMode&&((!C._hasConsole||!C.useConsole)||(C.useConsole&&C._hasConsole&&!C.consoleOnly))&&!document.getElementById(C.debugID)?"x"+N+P:"");var G=(document.body?document.body:(document.documentElement?document.documentElement:document.getElementsByTagName("div")[0]));if(G){C.oMC=document.createElement("div");C.oMC.className="movieContainer";C.oMC.style.position="absolute";C.oMC.style.left="-256px";C.oMC.style.width="1px";C.oMC.style.height="1px";try{G.appendChild(C.oMC);C.oMC.innerHTML=M[C.isIE?0:1];C._appendSuccess=true}catch(O){throw new Error(L)}if(!document.getElementById(C.debugID)&&((!C._hasConsole||!C.useConsole)||(C.useConsole&&C._hasConsole&&!C.consoleOnly))){var Q=document.createElement("div");Q.id=C.debugID;Q.style.display=(C.debugMode?"block":"none");if(C.debugMode){try{var K=document.createElement("div");G.appendChild(K);K.innerHTML=P}catch(O){throw new Error(L)}}G.appendChild(Q)}G=null}C._writeDebug("-- SoundManager 2 "+C.version+" --",1);C._writeDebug("soundManager._createMovie(): Trying to load "+H,1)};this._writeDebug=function(H,N,J){if(!C.debugMode){return false}if(typeof J!="undefined"&&J){H=H+" | "+new Date().getTime()}if(C._hasConsole&&C.useConsole){var G=C._debugLevels[N];if(typeof console[G]!="undefined"){console[G](H)}else{console.log(H)}if(C.useConsoleOnly){return true}}var M="soundmanager-debug";try{var L=document.getElementById(M);if(!L){return false}var K=document.createElement("div");H=H.replace(/\n/g,"<br />");if(typeof N=="undefined"){var N=0}else{N=parseInt(N)}K.innerHTML=H;if(N){if(N>=2){K.style.fontWeight="bold"}if(N==3){K.style.color="#ff3333"}}L.insertBefore(K,L.firstChild)}catch(I){}L=null};this._writeDebug._protected=true;this._writeDebugAlert=function(G){alert(G)};if(window.location.href.indexOf("debug=alert")+1&&C.debugMode){C._writeDebug=C._writeDebugAlert}this._toggleDebug=function(){var H=document.getElementById(C.debugID);var G=document.getElementById(C.debugID+"-toggle");if(!H){return false}if(C._debugOpen){G.innerHTML="+";H.style.display="none"}else{G.innerHTML="-";H.style.display="block"}C._debugOpen=!C._debugOpen};this._toggleDebug._protected=true;this._debug=function(){C._writeDebug("soundManager._debug(): sounds by id/url:",0);for(var H=0,G=C.soundIDs.length;H<G;H++){C._writeDebug(C.sounds[C.soundIDs[H]].sID+" | "+C.sounds[C.soundIDs[H]].url,0)}};this._mergeObjects=function(H,G){var K={};for(var I in H){K[I]=H[I]}var J=(typeof G=="undefined"?C.defaultOptions:G);for(var L in J){if(typeof K[L]=="undefined"){K[L]=J[L]}}return K};this.createMovie=function(G){if(G){C.url=G}C._initMovie()};this._initMovie=function(){if(C.o){return false}C.o=C.getMovie(C.id);if(!C.o){C._createMovie(C.id,C.url);C.o=C.getMovie(C.id)}if(C.o){C._writeDebug("soundManager._initMovie(): Got "+C.o.nodeName+" element ("+(C._didAppend?"created via JS":"static HTML")+")",1);C._writeDebug("soundManager._initMovie(): Waiting for ExternalInterface call from Flash..")}};this.waitForExternalInterface=function(){if(C._waitingForEI){return false}C._waitingForEI=true;if(C._tryInitOnFocus&&!C._isFocused){C._writeDebug("soundManager: Special case: Flash may not have started due to non-focused tab (Safari is lame), and/or focus cannot be detected. Waiting for focus-related event..");return false}if(!C._didInit){C._writeDebug("soundManager: Getting impatient, still waiting for Flash.. ;)")}setTimeout(function(){if(!C._didInit){C._writeDebug("soundManager: No Flash response within reasonable time after document load.\nPossible causes: Flash version under 8, no support, or Flash security denying JS-Flash communication.",2);if(!C._overHTTP){C._writeDebug('soundManager: Loading this page from local/network file system (not over HTTP?) Flash security likely restricting JS-Flash access. Consider adding current URL to "trusted locations" in the Flash player security settings manager at '+D+", or simply serve this content over HTTP.",2)}}if(!C._didInit&&C._okToDisable){C._failSafely()}},750)};this.handleFocus=function(){if(C._isFocused||!C._tryInitOnFocus){return true}C._okToDisable=true;C._isFocused=true;C._writeDebug("soundManager.handleFocus()");if(C._tryInitOnFocus){window.removeEventListener("mousemove",C.handleFocus,false)}C._waitingForEI=false;setTimeout(C.waitForExternalInterface,500);if(window.removeEventListener){window.removeEventListener("focus",C.handleFocus,false)}else{if(window.detachEvent){window.detachEvent("onfocus",C.handleFocus)}}};this.initComplete=function(){if(C._didInit){return false}C._didInit=true;C._writeDebug("-- SoundManager 2 "+(C._disabled?"failed to load":"loaded")+" ("+(C._disabled?"security/load error":"OK")+") --",1);if(C._disabled){C._writeDebug("soundManager.initComplete(): calling soundManager.onerror()",1);C.onerror.apply(window);return false}if(C.waitForWindowLoad&&!C._windowLoaded){C._writeDebug("soundManager: Waiting for window.onload()");if(window.addEventListener){window.addEventListener("load",C.initUserOnload,false)}else{if(window.attachEvent){window.attachEvent("onload",C.initUserOnload)}}return false}else{if(C.waitForWindowLoad&&C._windowLoaded){C._writeDebug("soundManager: Document already loaded")}C.initUserOnload()}};this.initUserOnload=function(){C._writeDebug("soundManager.initComplete(): calling soundManager.onload()",1);try{C.onload.apply(window)}catch(G){C._writeDebug("soundManager.onload() threw an exception: "+G.message,2);setTimeout(function(){throw new Error(G)},20);return false}C._writeDebug("soundManager.onload() complete",1)};this.init=function(){C._writeDebug("-- soundManager.init() --");C._initMovie();if(C._didInit){C._writeDebug("soundManager.init(): Already called?");return false}try{C._writeDebug("Attempting to call JS-Flash..");C.o._externalInterfaceTest(false);if(!C.allowPolling){C._writeDebug("Polling (whileloading/whileplaying support) is disabled.",1)}C.setPolling(true);if(!C.debugMode){C.o._disableDebug()}C.enabled=true}catch(G){C._failSafely();C.initComplete();return false}C.initComplete()};this.beginDelayedInit=function(){C._writeDebug("soundManager.beginDelayedInit(): Document loaded");C._windowLoaded=true;setTimeout(C.waitForExternalInterface,500);setTimeout(C.beginInit,20)};this.beginInit=function(){if(C._initPending){return false}C.createMovie();C._initMovie();C._initPending=true;return true};this._externalInterfaceOK=function(){if(C.swfLoaded){return false}C._writeDebug("soundManager._externalInterfaceOK()");C.swfLoaded=true;C._tryInitOnFocus=false;if(C.isIE){setTimeout(C.init,100)}else{C.init()}};this._setSandboxType=function(G){var H=C.sandbox;H.type=G;H.description=H.types[(typeof H.types[G]!="undefined"?G:"unknown")];C._writeDebug("Flash security sandbox type: "+H.type);if(H.type=="localWithFile"){H.noRemote=true;H.noLocal=false;C._writeDebug("Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",2)}else{if(H.type=="localWithNetwork"){H.noRemote=false;H.noLocal=true}else{if(H.type=="localTrusted"){H.noRemote=false;H.noLocal=false}}}};this.destruct=function(){C._writeDebug("soundManager.destruct()");C.disable()};function E(I,H){var G=this;var J=I;this.sID=H.id;this.url=H.url;this.options=J._mergeObjects(H);this.instanceOptions=this.options;this._debug=function(){if(J.debugMode){var M=null;var O=[];var L=null;var N=null;var K=64;for(M in G.options){if(G.options[M]!=null){if(G.options[M] instanceof Function){L=G.options[M].toString();L=L.replace(/\s\s+/g," ");N=L.indexOf("{");O[O.length]=" "+M+": {"+L.substr(N+1,(Math.min(Math.max(L.indexOf("\n")-1,K),K))).replace(/\n/g,"")+"... }"}else{O[O.length]=" "+M+": "+G.options[M]}}}J._writeDebug("SMSound() merged options: {\n"+O.join(", \n")+"\n}")}};this._debug();this.id3={};G.resetProperties=function(K){G.bytesLoaded=null;G.bytesTotal=null;G.position=null;G.duration=null;G.durationEstimate=null;G.loaded=false;G.loadSuccess=null;G.playState=0;G.paused=false;G.readyState=0;G.didBeforeFinish=false;G.didJustBeforeFinish=false;G.instanceOptions={};G.instanceCount=0;G.peakData={left:0,right:0};G.spectrumData=[]};G.resetProperties();this.load=function(K){G.loaded=false;G.loadSuccess=null;G.readyState=1;G.playState=(K.autoPlay?1:0);G.instanceOptions=J._mergeObjects(K);if(typeof G.instanceOptions.url=="undefined"){G.instanceOptions.url=G.url}try{J._writeDebug("soundManager.load(): "+G.instanceOptions.url,1);if(J.flashVersion==8){J.o._load(G.sID,G.instanceOptions.url,G.instanceOptions.stream,G.instanceOptions.autoPlay,(G.instanceOptions.whileloading?1:0))}else{J.o._load(G.sID,G.instanceOptions.url,G.instanceOptions.stream?true:false,G.instanceOptions.autoPlay?true:false)}}catch(L){J._writeDebug("SMSound().load(): JS-Flash communication failed.",2)}};this.unload=function(){J._writeDebug('SMSound().unload(): "'+G.sID+'"');G.setPosition(0);J.o._unload(G.sID,J.nullURL);G.resetProperties()};this.play=function(L){if(!L){L={}}G.instanceOptions=J._mergeObjects(L,G.instanceOptions);G.instanceOptions=J._mergeObjects(G.instanceOptions,G.options);if(G.playState==1){var K=G.instanceOptions.multiShot;if(!K){J._writeDebug('SMSound.play(): "'+G.sID+'" already playing (one-shot)',1);return false}else{J._writeDebug('SMSound.play(): "'+G.sID+'" already playing (multi-shot)',1)}}if(!G.loaded){if(G.readyState==0){J._writeDebug('SMSound.play(): Attempting to load "'+G.sID+'"',1);G.instanceOptions.stream=true;G.instanceOptions.autoPlay=true;G.load(G.instanceOptions)}else{if(G.readyState==2){J._writeDebug('SMSound.play(): Could not load "'+G.sID+'" - exiting',2);return false}else{J._writeDebug('SMSound.play(): "'+G.sID+'" is loading - attempting to play..',1)}}}else{J._writeDebug('SMSound.play(): "'+G.sID+'"')}if(G.paused){G.resume()}else{G.playState=1;if(!G.instanceCount||J.flashVersion==9){G.instanceCount++}G.position=(typeof G.instanceOptions.position!="undefined"&&!isNaN(G.instanceOptions.position)?G.instanceOptions.position:0);if(G.instanceOptions.onplay){G.instanceOptions.onplay.apply(G)}G.setVolume(G.instanceOptions.volume);G.setPan(G.instanceOptions.pan);if(J.flashVersion!=8||(J.flashVersion==8&&!G.instanceOptions.autoPlay)){J.o._start(G.sID,G.instanceOptions.loop||1,(J.flashVersion==9?G.position:G.position/1000))}}};this.start=this.play;this.stop=function(K){if(G.playState==1){G.playState=0;G.paused=false;if(G.instanceOptions.onstop){G.instanceOptions.onstop.apply(G)}J.o._stop(G.sID);G.instanceCount=0;G.instanceOptions={}}};this.setPosition=function(K){G.instanceOptions.position=K;J.o._setPosition(G.sID,(J.flashVersion==9?G.instanceOptions.position:G.instanceOptions.position/1000),(G.paused||!G.playState))};this.pause=function(){if(G.paused){return false}J._writeDebug("SMSound.pause()");G.paused=true;J.o._pause(G.sID);if(G.instanceOptions.onpause){G.instanceOptions.onpause.apply(G)}};this.resume=function(){if(!G.paused){return false}J._writeDebug("SMSound.resume()");G.paused=false;J.o._pause(G.sID);if(G.instanceOptions.onresume){G.instanceOptions.onresume.apply(G)}};this.togglePause=function(){J._writeDebug("SMSound.togglePause()");if(!G.playState){G.play({position:(J.flashVersion==9?G.position:G.position/1000)});return false}if(G.paused){G.resume()}else{G.pause()}};this.setPan=function(K){if(typeof K=="undefined"){K=0}J.o._setPan(G.sID,K);G.instanceOptions.pan=K};this.setVolume=function(K){if(typeof K=="undefined"){K=100}J.o._setVolume(G.sID,K);G.instanceOptions.volume=K};this.mute=function(){J.o._setVolume(G.sID,0)};this.unmute=function(){J.o._setVolume(G.sID,G.instanceOptions.volume)};this._whileloading=function(K,L,M){G.bytesLoaded=K;G.bytesTotal=L;G.duration=Math.floor(M);G.durationEstimate=parseInt((G.bytesTotal/G.bytesLoaded)*G.duration);if(G.readyState!=3&&G.instanceOptions.whileloading){G.instanceOptions.whileloading.apply(G)}};this._onid3=function(N,K){J._writeDebug('SMSound()._onid3(): "'+this.sID+'" ID3 data received.');var O=[];for(var M=0,L=N.length;M<L;M++){O[N[M]]=K[M]}G.id3=J._mergeObjects(G.id3,O);if(G.instanceOptions.onid3){G.instanceOptions.onid3.apply(G)}};this._whileplaying=function(K,L,M){if(isNaN(K)||K==null){return false}G.position=K;if(G.instanceOptions.usePeakData&&typeof L!="undefined"&&L){G.peakData={left:L.leftPeak,right:L.rightPeak}}if(G.instanceOptions.useSpectrumData&&typeof M!="undefined"&&M){G.spectrumData=M}if(G.playState==1){if(G.instanceOptions.whileplaying){G.instanceOptions.whileplaying.apply(G)}if(G.loaded&&G.instanceOptions.onbeforefinish&&G.instanceOptions.onbeforefinishtime&&!G.didBeforeFinish&&G.duration-G.position<=G.instanceOptions.onbeforefinishtime){J._writeDebug("duration-position &lt;= onbeforefinishtime: "+G.duration+" - "+G.position+" &lt= "+G.instanceOptions.onbeforefinishtime+" ("+(G.duration-G.position)+")");G._onbeforefinish()}}};this._onload=function(K){K=(K==1?true:false);J._writeDebug('SMSound._onload(): "'+G.sID+'"'+(K?" loaded.":" failed to load? - "+G.url));if(!K){if(J.sandbox.noRemote==true){J._writeDebug("SMSound._onload(): Reminder: Flash security is denying network/internet access",1)}if(J.sandbox.noLocal==true){J._writeDebug("SMSound._onload(): Reminder: Flash security is denying local access",1)}}G.loaded=K;G.loadSuccess=K;G.readyState=K?3:2;if(G.instanceOptions.onload){G.instanceOptions.onload.apply(G)}};this._onbeforefinish=function(){if(!G.didBeforeFinish){G.didBeforeFinish=true;if(G.instanceOptions.onbeforefinish){G.instanceOptions.onbeforefinish.apply(G)}}};this._onjustbeforefinish=function(K){if(!G.didJustBeforeFinish){G.didJustBeforeFinish=true;if(G.instanceOptions.onjustbeforefinish){G.instanceOptions.onjustbeforefinish.apply(G)}}};this._onfinish=function(){J._writeDebug('SMSound._onfinish(): "'+G.sID+'"');G.playState=0;G.paused=false;if(G.instanceOptions.onfinish){G.instanceOptions.onfinish.apply(G)}if(G.instanceOptions.onbeforefinishcomplete){G.instanceOptions.onbeforefinishcomplete.apply(G)}G.didBeforeFinish=false;G.didJustBeforeFinish=false;if(G.instanceCount){G.instanceCount--;if(!G.instanceCount){G.instanceCount=0;G.instanceOptions={}}}}}this.customInit=function(){var G=true;if(window.addEventListener){window.addEventListener("focus",C.handleFocus,false);window.addEventListener("beforeunload",C.destruct,false);if(C._tryInitOnFocus){window.addEventListener("mousemove",C.handleFocus,false)}}else{if(window.attachEvent){window.attachEvent("onfocus",C.handleFocus);window.attachEvent("beforeunload",C.destruct)}else{G=false;soundManager.onerror();soundManager.disable()}}if(G){C.beginDelayedInit()}};var F=[" SoundManager 2: Javascript Sound for the Web "," http://schillmania.com/projects/soundmanager2/ "," Copyright (c) 2008, Scott Schiller. All rights reserved. "," Code provided under the BSD License: http://schillmania.com/projects/soundmanager2/license.txt ",]}var goMessages={};goMessages["fr"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Bloc"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Tournez sur l'Approbation Manuel?"],"This message will be permanently removed!":[null,"Ce message sera dfinitivement supprim!"],"Please sign in":[null,"S'identifier"],"Sign out":[null,"Dconnexion"],"Block user":[null,"Bloc"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Se connecter</b> en tant qu'<b>invit</b>"],"Sign out now?":[null,"Se dconnecter?"],"viewer":[null,"spectateur"],"viewers":[null,"spectateurs"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"sera <b>permanence</ b> supprim. <div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Il sera parti pour toujours!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Tous les messages devront tre approuvs manuellement pour l'affichage!"],"Delete all messages from":[null,"Supprimer tous les messages de"],"Cancel":[null,"Annuler"],"Turn off Manual Approval?":[null,"teignez Approbation Manuelle?"],"Are you sure?":[null,"Etes-vous sr?"],"full":[null,"plein"],"Ok":[null,"OK"],"Delete all messages":[null,"Supprimer tous les messages de"],"online":[null,"en ligne"],"Guest":[null,"Invite"],"Delete message?":[null,"Supprimer le message?"],"show all...":[null,"afficher..."],"hide all...":[null,"masquer..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Tous les messages en file d'attente d'approbation sera ignor."],"cancel":[null,"annuler"],"Online":[null,"En ligne"]}};goMessages["de"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Block"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Schalten Sie Manuelle Genehmigung?"],"This message will be permanently removed!":[null,"Diese Nachricht wird dauerhaft entfernt werden!"],"Please sign in":[null,"Bitte anmelden"],"Sign out":[null,"Abmelden"],"Block user":[null,"Block"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Anmelden</b> als <b>Gast</b>"],"Sign out now?":[null,"Jetzt abmelden?"],"viewer":[null,"zuschauer"],"viewers":[null,"zuschauer"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"wird <b>dauerhaft</b> gelscht. <div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Es wird fr immer verschwunden sein!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Alle Nachrichten werden mssen manuell zur Anzeige freigegeben!"],"Delete all messages from":[null,"Lschen aller Mitteilungen aus"],"Cancel":[null,"Abbrechen"],"Turn off Manual Approval?":[null,"Schalten Sie Manuelle Genehmigung?"],"Are you sure?":[null,"Sind sie sicher?"],"full":[null,"voll"],"Ok":[null,"OK"],"Delete all messages":[null,"Lschen aller Mitteilungen aus"],"online":[null,"online"],"Guest":[null,"Gast"],"Delete message?":[null,"Nachricht lschen?"],"show all...":[null,"anzeigen..."],"hide all...":[null,"ausblenden..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Alle Nachrichten, derzeit in der Warteschlange Genehmigung wird bersprungen."],"cancel":[null,"abbrechen"],"Online":[null,"Online"]}};goMessages["es"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Bloquear"],"Send Private Message":[null,"Mandar Mensaje Privado"],"Turn on Manual Approval?":[null,"Activar la aprobacin manual?"],"This message will be permanently removed!":[null,"Este mensaje se eliminar de forma permanente!"],"Please sign in":[null,"Inicie sesin"],"Sign out":[null,"Cerrar sesin"],"Block user":[null,"Bloquear Usuario"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Iniciar sesin</b> como <b>invitado</b>"],"Sign out now?":[null,"Cerrar sesin ahora?"],"viewer":[null,"visor"],"viewers":[null,"visores"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"se eliminar <b>de forma permanente</b>.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>No podr recuperarse!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Todos los mensajes necesitan ser<br/>aprobado manualmente por la pantalla!"],"Delete all messages from":[null,"Eliminar todos los mensajes de"],"Cancel":[null,"Cancelar"],"Turn off Manual Approval?":[null,"Desactivar la aprobacin manual?"],"Are you sure?":[null,"Ests seguro?"],"full":[null,"completo"],"Ok":[null,"Aceptar"],"Delete all messages":[null,"Borrar todos los mensajes"],"online":[null,"en lnea"],"Guest":[null,"Invitado"],"Delete message?":[null,"Eliminar mensaje?"],"show all...":[null,"mostrar todos..."],"hide all...":[null,"ocultar todos..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Los mensajes que estn actualmente en el<br/>cola de aprobacin se omitir."],"cancel":[null,"cancelar"],"Online":[null,"En lnea"]}};goMessages["pt"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Bloquear"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Ligar Aprovao Manual?"],"This message will be permanently removed!":[null,"Esta mensagem ser removida permanentemente!"],"Please sign in":[null,"Por favor faa o login"],"Sign out":[null,"Sair"],"Block user":[null,"Bloquear"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Entrar</b> como <b>Convidado</b>"],"Sign out now?":[null,"Sair agora?"],"viewer":[null,"visualizador"],"viewers":[null,"visualizadores"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"ser <b>permanentemente</b> apagado.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Ser perdido para sempre!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Todas as mensagens precisaro<br/>ser aprovadas manualmente para exibio!"],"Delete all messages from":[null,"Apagar todas as mensagens de"],"Cancel":[null,"Cancelar"],"Turn off Manual Approval?":[null,"Desligar Aprovao Manual?"],"Are you sure?":[null,"Voc tem certeza?"],"full":[null,"cheio"],"Ok":[null,"Ok"],"Delete all messages":[null,"Apagar todas as mensagens de"],"online":[null,"conectado"],"Guest":[null,"Convidado"],"Delete message?":[null,"Apagar mensagem?"],"show all...":[null,"mostrar todos..."],"hide all...":[null,"ocultar todos..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Qualquer mensagem atualmente na<br/>fila de aprovao ser ignorada."],"cancel":[null,"cancelar"],"Online":[null,"Conectado"]}};goMessages["it"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Blocca"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Attiva l'approvazione manuale?"],"This message will be permanently removed!":[null,"Questo messaggio verra' eliminato per sempre!"],"Please sign in":[null,"Accedi per favore"],"Sign out":[null,"Esci"],"Block user":[null,"Blocca"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Accedi</b> come <b>ospite</b>"],"Sign out now?":[null,"Esci ora?"],"viewer":[null,"visitatore"],"viewers":[null,"visitatori"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"verra' eliminato<b>per sempre</b>.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Sara' perso per sempre!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Tutti i messaggi dovranno essere<br/>approvati manualmente per essere visualizzati!"],"Delete all messages from":[null,"Elimina tutti i messaggi da"],"Cancel":[null,"Cancella"],"Turn off Manual Approval?":[null,"Disattiva l'approvazione manuale?"],"Are you sure?":[null,"Sei sicuro?"],"full":[null,"pieno"],"Ok":[null,"Ok"],"Delete all messages":[null,"Elimina tutti i messaggi da"],"online":[null,"online"],"Guest":[null,"Utente non registrato"],"Delete message?":[null,"Elimina messaggio?"],"show all...":[null,"mostra tutti..."],"hide all...":[null,"nascondi tutti..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"I messaggi che si trovano ora in<br/>coda per essere approvati verranno saltati."],"cancel":[null,"annulla"],"Online":[null,"Online"]}};goMessages["nl"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Blok"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Handmatige goedkeuring inschakelen?"],"This message will be permanently removed!":[null,"Dit bericht zal permanent verwijderd worden!"],"Please sign in":[null,"Meld u aan"],"Sign out":[null,"Meld u af"],"Block user":[null,"Blok"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Meld u aan</b> als een <b>Gast</b>"],"Sign out now?":[null,"Wilt u zich nu afmelden?"],"viewer":[null,"kijker"],"viewers":[null,"kijkers"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"zal <b>permanent</b> worden verwijderd.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Het zal voor altijd verdwenen zijn!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Alle berichten moeten<br/>handmatig worden goedgekeurd voor ze worden weergegeven!"],"Delete all messages from":[null,"Verwijder alle berichten van"],"Cancel":[null,"Annuleer"],"Turn off Manual Approval?":[null,"Handmatige goedkeuring uitschakelen?"],"Are you sure?":[null,"Weet u het zeker?"],"full":[null,"volledig"],"Ok":[null,"OK"],"Delete all messages":[null,"Verwijder alle berichten van"],"online":[null,"online"],"Guest":[null,"Gast"],"Delete message?":[null,"Verwijder bericht?"],"show all...":[null,"toon alles...."],"hide all...":[null,"verberg alles..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Alle berichten die op dit moment<br/>wachten op goedkeuring worden overgeslagen."],"cancel":[null,"annuleer"],"Online":[null,"Online"]}};goMessages["nl"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,"Blok"],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"Handmatige goedkeuring inschakelen?"],"This message will be permanently removed!":[null,"Dit bericht zal permanent verwijderd worden!"],"Please sign in":[null,"Meld u aan"],"Sign out":[null,"Meld u af"],"Block user":[null,"Blok"],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b>Meld u aan</b> als een <b>Gast</b>"],"Sign out now?":[null,"Wilt u zich nu afmelden?"],"viewer":[null,"kijker"],"viewers":[null,"kijkers"],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"zal <b>permanent</b> worden verwijderd.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>Het zal voor altijd verdwenen zijn!</div>"],"All messages will need to be<br/>manually approved for display!":[null,"Alle berichten moeten<br/>handmatig worden goedgekeurd voor ze worden weergegeven!"],"Delete all messages from":[null,"Verwijder alle berichten van"],"Cancel":[null,"Annuleer"],"Turn off Manual Approval?":[null,"Handmatige goedkeuring uitschakelen?"],"Are you sure?":[null,"Weet u het zeker?"],"full":[null,"volledig"],"Ok":[null,"OK"],"Delete all messages":[null,"Verwijder alle berichten van"],"online":[null,"online"],"Guest":[null,"Gast"],"Delete message?":[null,"Verwijder bericht?"],"show all...":[null,"toon alles...."],"hide all...":[null,"verberg alles..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"Alle berichten die op dit moment<br/>wachten op goedkeuring worden overgeslagen."],"cancel":[null,"annuleer"],"Online":[null,"Online"]}};goMessages["ja"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,""],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,"?"],"This message will be permanently removed!":[null,"!"],"Please sign in":[null,""],"Sign out":[null,""],"Block user":[null,""],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b></b>  <b></b>"],"Sign out now?":[null,"?"],"viewer":[null,""],"viewers":[null,""],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null,"<b></b> <div style='color:#ff0000;font-weight:bold;padding-top:5px;'> !</div>"],"All messages will need to be<br/>manually approved for display!":[null," <br/> !"],"Delete all messages from":[null,""],"Cancel":[null,""],"Turn off Manual Approval?":[null,"?"],"Are you sure?":[null,"?"],"full":[null,""],"Ok":[null,""],"Delete all messages":[null,""],"online":[null,""],"Guest":[null,""],"Delete message?":[null,"?"],"show all...":[null,"..."],"hide all...":[null,"..."],"Any messages currently in the<br/>approval queue will be skipped.":[null," <br/> "],"cancel":[null,""],"Online":[null,""]}};goMessages["zh"]={"messages":{"":{"MIME-Version":" 1.0","POT-Creation-Date":" 2011-11-20 16:29-0500","Language":" ","Last-Translator":" Jonathan McGee <jon@chatroll.com>","Content-Type":" text/plain; charset=UTF-8","PO-Revision-Date":" ","Language-Team":" ","Content-Transfer-Encoding":" 8bit","Project-Id-Version":" ","Report-Msgid-Bugs-To":" "},"Block":[null,""],"Send Private Message":[null,""],"Turn on Manual Approval?":[null,""],"This message will be permanently removed!":[null,""],"Please sign in":[null,""],"Sign out":[null,""],"Block user":[null,""],"<b>Sign in</b> as a <b>Guest</b>":[null,"<b></b><b></b>"],"Sign out now?":[null,""],"viewer":[null,""],"viewers":[null,""],"will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>":[null," <b></b> <div style='color:#ff0000;font-weight:bold;padding-top:5px;'></div>"],"All messages will need to be<br/>manually approved for display!":[null,"<br/> "],"Delete all messages from":[null,""],"Cancel":[null,""],"Turn off Manual Approval?":[null,""],"Are you sure?":[null,""],"full":[null,""],"Ok":[null,""],"Delete all messages":[null,""],"online":[null,""],"Guest":[null,""],"Delete message?":[null,""],"show all...":[null,"..."],"hide all...":[null,"..."],"Any messages currently in the<br/>approval queue will be skipped.":[null,"<br/>"],"cancel":[null,""],"Online":[null,""]}};var Logger=Class.create();Logger.prototype={initialize:function(){this.entries=[];this.numFlushes=0;this.maxFlushes=1;window.onerror=function(B,C,A){logger.error("(window error) "+B+" ("+C+":"+A+")");return true};dwr.engine.setErrorHandler(function(C,B){var A="(DWR) "+C;if(B){A+=" (exception thrown)"}logger.error(A)});dwr.engine.setWarningHandler(function(C,B){var A="(DWR) "+C;if(B){A+=" (exception thrown)"}logger.warn(A)})},catchBlockError:function(C){var B=C.name+": "+C.message;var D=C.fileName?C.fileName:C.sourceURL;var A=C.lineNumber?C.lineNumber:C.line;this.error("(catch block) "+B+" ("+D+":"+A+")")},debug:function(A,B){},info:function(A,B){A="[INFO] "+A;this.queue(A)},warn:function(A,B){A="[WARNING] "+A;this.queue(A)},error:function(A,B){A="[ERROR] "+A;this.queue(A)},isDebugEnabled:function(){return false},queue:function(A){this.entries.push(A);setTimeout(logger.flush,500)},flush:function(){if(this.numFlushes<this.maxFlushes){this.numFlushes++;ServiceInterface.log(this.entries,{callback:function(){},errorHandler:function(){}})}this.entries=[]}};Date.parseGMT=function(B){var C=new Date();var A=Date.parse(B);if(isNaN(A)){C=null}else{C.setTime(A-(C.getTimezoneOffset()*60*1000))}return C};Date.prototype.days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];Date.prototype.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Date.prototype.getDayString=function(){return this.days[this.getDay()]};Date.prototype.getMonthString=function(){return this.months[this.getMonth()]};Date.prototype.getDateString=function(){var A=this.months[this.getMonth()]+" "+this.getDate()+" "+this.getFullYear();return A};Date.prototype.getHourMinuteString=function(){var A=this.getHours();var C=this.getMinutes();var B=(A<12)?" AM":" PM";if(A>12){A=A-12}else{if(A==0){A=12}}if(C<10){C="0"+C}return A+":"+C+B};var CustomEvent=Class.create();CustomEvent.prototype={initialize:function(){this.handlers=new Array()},observe:function(A){this.handlers.push(A)},fire:function(B){for(var A=0,C=this.handlers.length;A<C;++A){(this.handlers[A])(B)}},stopObserving:function(A){this.handlers=this.handlers.without(A)}};var TemplateManager=Class.create();TemplateManager.prototype={initialize:function(){},evaluate:function(B,A){return this.templates[B](A)}};var TooltipManager=Class.create();TooltipManager.prototype={initialize:function(){this.activeTooltip=null;this.onHideCallback=null;this.onDocumentClickListener=this._onDocumentClick.bindAsEventListener(this)},showTooltip:function(C){this.hideTooltips();C=Object.extend({element:null,html:null,relativeElement:null,top:"auto",bottom:"auto",left:"auto",right:"auto",offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,onHideCallback:null},C);var A=new Element("div");if(C.element!=null){A.insert(C.element)}else{A.innerHTML=C.html}A.setStyle({position:"absolute",zIndex:1000});A.hide();$(document.body).insert({bottom:A});var H=null;var G=function(){if(H==null){if(C.relativeElement!=null){H=C.relativeElement.getDimensions()}else{H=document.viewport.getDimensions()}}};var M=null;var N=function(){if(M==null){if(C.relativeElement!=null){M=C.relativeElement.cumulativeOffset()}else{M={top:0,left:0}}}};var K=null;var L=function(){if(K==null){K=document.viewport.getDimensions()}};var F=null;var D=function(){if(F==null){F=document.viewport.getScrollOffsets()}};var I=null;var E=function(){if(I==null){I=A.getDimensions()}};if(C.top=="fixed"){D();var J=F.top+C.offsetTop;A.setStyle({top:J+"px"})}else{if(C.bottom=="fixed"){L();D();E();var J=K.height+F.top-I.height-C.offsetBottom;A.setStyle({top:J+"px"})}else{if(C.top=="top"){N();var J=M.top+C.offsetTop;A.setStyle({top:J+"px"})}else{if(C.top=="bottom"){N();G();var J=M.top+H.height+C.offsetTop;A.setStyle({top:J+"px"})}else{if(C.top=="center"){D();N();G();E();var J=F.top+M.top+(H.height-I.height)/2;A.setStyle({top:J+"px"})}}}}}if(C.left=="fixed"){D();var B=F.left+C.offsetLeft;A.setStyle({left:B+"px"})}else{if(C.left=="left"){N();var B=M.left+C.offsetLeft;A.setStyle({left:B+"px"})}else{if(C.left=="right"){N();G();var B=M.left+H.width+C.offsetLeft;A.setStyle({left:B+"px"})}else{if(C.right=="right"){N();G();E();var B=M.left+H.width-I.width+C.offsetRight;A.setStyle({left:B+"px"})}else{if(C.left=="center"){D();N();G();E();var B=F.left+M.left+(H.width-I.width)/2;A.setStyle({left:B+"px"})}}}}}A.show();this.activeTooltip=A;this.onHideCallback=C.onHideCallback;setTimeout(function(){document.observe("click",this.onDocumentClickListener)}.bind(this),0);return this.activeTooltip},hideTooltips:function(){if(this.activeTooltip!=null){document.stopObserving("click",this.onDocumentClickListener);if(this.onHideCallback!=null){this.onHideCallback()}this.onHideCallback=null;this.activeTooltip.remove();this.activeTooltip=null}},_onDocumentClick:function(B){var A=Event.findElement(B,"div");if(!A.descendantOf(this.activeTooltip)){setTimeout(function(){this.hideTooltips()}.bind(this),0)}}};window.lnk=function(B,F){try{if(B===window){B=window.event.srcElement;while(B){if(B.href){break}B=B.parentNode}}var C=encodeURIComponent||escape;var D=B.href.split("#");var A=["/url?url=",C(D[0]).replace(/\+/g,"%2B"),F?F:"",D[1]?"#"+D[1]:""].join("");B.href=A;B.onmousedown=""}catch(E){}return true};var Facebook=Class.create();Facebook.prototype={initialize:function(){this.chatApp=null},setChatApp:function(A){this.chatApp=A},load:function(){window.fbAsyncInit=this._onLoad.bind(this);var A=document.createElement("div");A.id="fb-root";document.body.appendChild(A);var B=document.createElement("script");B.async=true;B.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";document.getElementById("fb-root").appendChild(B)},_onLoad:function(){FB.init({apiKey:this.chatApp.clientConfig.fbApiKey,status:true,cookie:true,xfbml:false,channelUrl:document.location.protocol+this.chatApp.clientConfig.baseWebUrl+"/fbchannel.html",oauth:true})},login:function(A){FB.getLoginStatus(function(B){if(B.status==="connected"){A(B)}else{FB.login(A,{perms:""})}})}};var Twitter=Class.create();Twitter.prototype={initialize:function(){this.chatApp=null},setChatApp:function(A){this.chatApp=A}};var Chart=Class.create();Chart.prototype={initialize:function(){},setChatApp:function(A){this.chatApp=A},render:function(E,G,D,C,F,H,A,B){ServiceInterface.getChartData(G,D,C,H,A,B,{callback:function(L){var K=[];var M=[0,6,12,18];L[0].data.each(function(Q){var P=Q[0];var O=new Date(P);if(H==3600&&M.indexOf(O.getHours())!=-1){K.push(P)}else{if(H==86400){if(O.getDate()%5==0){K.push(P)}}else{if(H==2592000){if(O.getDate()==1){K.push(P)}}}}});var J=function(S){var R=new Date(parseInt(S));var P;if(H==3600){var O=R.getHours();if(O<10){O="0"+O}var Q=R.getMinutes();if(Q<10){Q="0"+Q}P=R.getDayString()+" "+O+":"+Q}else{if(H==86400){P=R.getMonthString()+" "+R.getDate()}else{P=R.getMonthString()+" "+R.getFullYear()}}return P};var N=function(){Flotr.draw(E,L,{lines:{show:(F=="line"),color:"#4475b8",lineWidth:3,fill:true,fillColor:"#4475b8"},bars:{show:(F=="bar"),barWidth:H*850,lineWidth:0,stacked:true},points:{show:(F=="line"),radius:3,lineWidth:0,color:"#4475b8",fill:true,fillColor:"#4475b8"},xaxis:{ticks:K,tickFormatter:J},yaxis:{min:0,tickDecimals:0},grid:{backgroundColor:"#ffffff"},mouse:{track:true,lineColor:"#4475b8",fillOpacity:1,radius:4,relative:true,position:"w",sensibility:H*2000,trackDecimals:0,trackFormatter:function(O){return J(O.x)+"<br/>"+O.y}}})};var I=E.getWidth();N();Event.observe(window,"resize",function(){var O=E.getWidth();if(O!=I){I=O;N()}})},errorHandler:function(){E.innerHTML="Error retrieving chart data."}})}};var ChatApp=Class.create();ChatApp.prototype={initialize:function(clientConfigJson){this.clientConfig=(function(){return eval(clientConfigJson)})();this.templateManager=new TemplateManager();this.tooltipManager=new TooltipManager();this.profileManager=new ProfileManager();this.profileManager.setChatApp(this);this.groupManager=new GroupManager();this.groupManager.setChatApp(this);this.userPreferenceManager=new UserPreferenceManager();this.userPreferenceManager.setChatApp(this);this.accountManager=new AccountManager();this.accountManager.setChatApp(this);this.clientInterface=new ClientInterface();this.clientInterface.setChatApp(this);this.messageBus=new MessageBus();this.messageBus.setChatApp(this);gt=new Gettext({"locale_data":goMessages[this.clientConfig.language]});_=function(msgid){return gt.gettext(msgid)};soundManager=new SoundManager();soundManager.customInit();this.resetClientEnabled=true;if(this.clientConfig.fbApiKey!=null){this.facebook=new Facebook();this.facebook.setChatApp(this);this.facebook.load()}},fireGroupUiAction:function(A){var B=this.groupManager.getGroup(this.clientConfig.groupId);if(B!=null){B.onUiActionEvent(A)}}};var Profile=Class.create();Profile.prototype={initialize:function(A){Object.extend(this,A);this.chatApp=null;this.profileLinkBefore=null;this.profileLinkAfter=null;this.profileImageClassName=null;this.profileDisplayNameClassName=null},setChatApp:function(A){this.chatApp=A},prepareForTemplateEval:function(){this.displayNameHTML=this.getDisplayNameHTML();this.iconImageHTML=this.getIconImageHTML();this.tinyImageHTML=this.getTinyImageHTML()},getDisplayNameHTML:function(){this._updateProfileLink();var A=this.displayNameHtml;if(this.guest&&(A=="")){if(this.userId==this.chatApp.profileManager.currentUserId){A="Me"}else{A="Guest"}}var B=this.profileLinkBefore;if(this.profileDisplayNameClassName!=null){B+="<span class='"+this.profileDisplayNameClassName+"'>"}B+=A;if(this.profileDisplayNameClassName!=null){B+="</span>"}B+=this.profileLinkAfter;return B},getIconImageHTML:function(){return this._getImageHTML(this.iconImageURL,"profile-icon-image")},getTinyImageHTML:function(){return this._getImageHTML(this.tinyImageURL,"profile-tiny-image")},_getImageHTML:function(C,A){this._updateProfileLink();if(this.profileLinkBefore!=""){A+=" highlight "}if(this.profileImageClassName!=null){A+=this.profileImageClassName}var B=this.profileLinkBefore+"<img ";if(A!=""){B+="class='"+A+"' "}B+="src='"+this.chatApp.clientConfig.baseImagesUrl+C+"'/>"+this.profileLinkAfter;return B},_updateProfileLink:function(){if(this.profileLinkBefore==null&&this.profileLinkAfter==null){var A="";if(this.chatApp.clientConfig.embedded){A="target='_blank'"}if(!this.guest&&this.profileUrl!=null){this.profileLinkBefore="<a "+A+" href='"+this.profileUrl+"'>";this.profileLinkAfter="</a>"}else{if(this.guest&&this.userId==this.chatApp.profileManager.currentUserId&&this.chatApp.clientConfig.groupSigninMethods["chatroll"]){this.profileLinkBefore="<a "+A+" href='/profile/me'>";this.profileLinkAfter="</a>"}else{this.profileLinkBefore="";this.profileLinkAfter=""}}}}};var ProfileManager=Class.create();ProfileManager.prototype={initialize:function(){this.chatApp=null;this.currentUserId=null;this.profiles=new Hash();this.currentProfileChangeEvent=new CustomEvent();this.profileChangeEvents=new Hash()},setChatApp:function(A){this.chatApp=A},setCurrentProfile:function(A){this.currentUserId=A.userId;var B=new Profile(A);B.setChatApp(this.chatApp);this.setProfile(B)},getCurrentProfile:function(){var A=null;if(this.currentUserId!=null){A=this.getProfile(this.currentUserId)}return A},setProfile:function(C){var A=C.userId;var B=new Profile(C);B.setChatApp(this.chatApp);this.profiles.set(A,B);if(this.currentUserId==A){this._fireCurrentProfileChangeEvent(B)}this._fireProfileChangeEvent(A,B)},getProfile:function(B){if(!this.profiles.get(B)){var A=new Profile({userId:B,displayName:"",displayNameHtml:"...",guest:true,mainImageURL:"/t.gif",iconImageURL:"/t.gif",tinyImageURL:"/t.gif"});A.setChatApp(this.chatApp);this.profiles.set(B,A);ServiceInterface.getProfile(B,{callback:this._getProfileCallback.bindAsEventListener(this)})}return this.profiles.get(B)},addCurrentProfileChangeListener:function(A){this.currentProfileChangeEvent.observe(A)},removeCurrentProfileChangeListener:function(A){this.currentProfileChangeEvent.stopObserving(A)},addProfileChangeListener:function(A,B){var C=this.profileChangeEvents.get(A);if(C==null){C=new CustomEvent();this.profileChangeEvents.set(A,C)}C.observe(B)},removeProfileChangeListener:function(A,B){if(A!=null){var C=this.profileChangeEvents.get(A);if(C){C.stopObserving(B)}else{logger.error("removeProfileChangeListener: no event for profile "+A)}}else{this.profileChangeEvents.each(function(E){var D=E.value;D.stopObserving(B)})}},_fireCurrentProfileChangeEvent:function(A){this.currentProfileChangeEvent.fire(A)},_fireProfileChangeEvent:function(A,B){var C=this.profileChangeEvents.get(A);if(C){C.fire(B)}},_getProfileCallback:function(A){this.setProfile(A)}};var GroupPermission=Class.create();GroupPermission.PERMISSION_WRITE=1;GroupPermission.PERMISSION_ADMIN=4;GroupPermission.PERMISSION_MODERATE=6;GroupPermission.PERMISSION_SEND_PM=9;GroupPermission.PERMISSION_DELETE_OWN_MESSAGES=11;var Feature=Class.create();Feature.GROUP_USER_FEATURE_FREE_PM=100;var Group=Class.create();Group.CONTACT_LIST_POSITION_AUTO=0;Group.CONTACT_LIST_POSITION_RIGHT=1;Group.CONTACT_LIST_POSITION_TOP=2;Group.prototype={initialize:function(A){Object.extend(this,A);this.chatApp=null;this.onlineCount=0;this.initialContactListProfiles=null;this.groupUserStates=null;this.onlineCountChangeEvent=new CustomEvent();this.messageEvent=new CustomEvent();this.messageDeleteEvent=new CustomEvent();this.userJoinEvent=new CustomEvent();this.userLeaveEvent=new CustomEvent();this.stickyMessageUpdateEvent=new CustomEvent();this.groupItemEvent=new CustomEvent();this.groupItemUpdateEvent=new CustomEvent();this.groupItemActionEvent=new CustomEvent();this.groupItemDeleteEvent=new CustomEvent();this.chatAdEvent=new CustomEvent();this.privateMessageActionEvent=new CustomEvent();this.approvalQueueEvent=new CustomEvent();this.messageSkippedEvent=new CustomEvent();this.groupUserStateUpdateAnyEvent=new CustomEvent();this.groupUserStateUpdateEvents=new Hash();this.uiActionEvents=new Hash()},setChatApp:function(A){this.chatApp=A},setConnectSuccessData:function(A){this.onlineCount=A.onlineCount;this.initialContactListProfiles=A.profiles;this.groupUserStates=A.groupUserStates},addMessageListener:function(A){this.messageEvent.observe(A)},removeMessageListener:function(A){this.messageEvent.stopObserving(A)},_fireMessageEvent:function(A){this.messageEvent.fire(A)},addMessageDeleteListener:function(A){this.messageDeleteEvent.observe(A)},removeMessageDeleteListener:function(A){this.messageDeleteEvent.stopObserving(A)},_fireMessageDeleteEvent:function(B,A){var C={userId:B,messageId:A};this.messageDeleteEvent.fire(C)},addGroupItemListener:function(A){this.groupItemEvent.observe(A)},removeGroupItemListener:function(A){this.groupItemEvent.stopObserving(A)},_fireGroupItemEvent:function(A,B){var C={groupItem:A,message:B};this.groupItemEvent.fire(C)},addUserJoinListener:function(A){this.userJoinEvent.observe(A)},removeUserJoinListener:function(A){this.userJoinEvent.stopObserving(A)},_fireUserJoinEvent:function(A){this.userJoinEvent.fire(A)},addUserLeaveListener:function(A){this.userLeaveEvent.observe(A)},removeUserLeaveListener:function(A){this.userLeaveEvent.stopObserving(A)},_fireUserLeaveEvent:function(A){this.userLeaveEvent.fire(A)},addGroupUserStateUpdateAnyListener:function(A){this.groupUserStateUpdateAnyEvent.observe(A)},removeGroupUserStateUpdateAnyListener:function(A){this.groupUserStateUpdateAnyEvent.stopObserving(A)},_fireGroupUserStateUpdateAnyEvent:function(B,A){var C={userId:B,groupUserState:A};this.groupUserStateUpdateAnyEvent.fire(C)},addGroupUserStateUpdateListener:function(B,C){var A=this.groupUserStateUpdateEvents.get(B);if(A==null){A=new CustomEvent();this.groupUserStateUpdateEvents.set(B,A)}A.observe(C)},removeGroupUserStateUpdateListener:function(B,C){var A=this.groupUserStateUpdateEvents.get(B);if(A!=null){A.stopObserving(C)}else{logger.error("removeGroupUserStateUpdateListener: no event for userId "+B)}},_fireGroupUserStateUpdateEvent:function(C,B){var A=this.groupUserStateUpdateEvents.get(C);if(A!=null){A.fire(B)}},addGroupItemUpdateListener:function(A){this.groupItemUpdateEvent.observe(A)},removeGroupItemUpdateListener:function(A){this.groupItemUpdateEvent.stopObserving(A)},_fireGroupItemUpdateEvent:function(A){this.groupItemUpdateEvent.fire(A)},addGroupItemActionListener:function(A){this.groupItemActionEvent.observe(A)},removeGroupItemActionListener:function(A){this.groupItemActionEvent.stopObserving(A)},_fireGroupItemActionEvent:function(A,B){var C={groupItem:A,action:B};this.groupItemActionEvent.fire(C)},addGroupItemDeleteListener:function(A){this.groupItemDeleteEvent.observe(A)},removeGroupItemDeleteListener:function(A){this.groupItemDeleteEvent.stopObserving(A)},_fireGroupItemDeleteEvent:function(A){this.groupItemDeleteEvent.fire(A)},addChatAdListener:function(A){this.chatAdEvent.observe(A)},removeChatAdListener:function(A){this.chatAdEvent.stopObserving(A)},_fireChatAdEvent:function(A){this.chatAdEvent.fire(A)},addPrivateMessageActionListener:function(A){this.privateMessageActionEvent.observe(A)},removePrivateMessageActionListener:function(A){this.privateMessageActionEvent.stopObserving(A)},_firePrivateMessageActionEvent:function(D,A,C){var B={action:D,userId:A,message:C};this.privateMessageActionEvent.fire(B)},addUiActionListener:function(B,A){var C=this.uiActionEvents.get(B);if(C==null){C=new CustomEvent();this.uiActionEvents.set(B,C)}C.observe(A)},removeUiActionListener:function(B,A){var C=this.uiActionEvents.get(B);if(C!=null){C.stopObserving(A)}},_fireUiActionEvent:function(A){var B=this.uiActionEvents.get(A);if(B!=null){B.fire(A)}},onOnlineCountChange:function(A){this.onlineCount=A;this.onlineCountChangeEvent.fire()},onUserJoin:function(B,A){this.groupUserStates[B.userId]=A;this._fireUserJoinEvent(B)},onUserLeave:function(A){if(A!=this.chatApp.profileManager.currentUserId){delete this.groupUserStates[A];this._fireUserLeaveEvent(A)}},onGroupUserStateUpdate:function(B,A){this.groupUserStates[B]=A;this._fireGroupUserStateUpdateEvent(B,A);this._fireGroupUserStateUpdateAnyEvent(B,A)},onMessage:function(A){this._fireMessageEvent(A)},onMessageDelete:function(B,A){this._fireMessageDeleteEvent(B,A)},onGroupItem:function(A,B){this._fireGroupItemEvent(A,B)},onGroupItemUpdate:function(A){this._fireGroupItemUpdateEvent(A)},onGroupItemDelete:function(A){this._fireGroupItemDeleteEvent(A)},onGroupItemAction:function(A,B){this._fireGroupItemActionEvent(A,B)},onChatAd:function(A){this._fireChatAdEvent(A)},onPrivateMessageReceived:function(A,B){this._firePrivateMessageActionEvent("received",A,B)},onPrivateMessageSend:function(A){this._firePrivateMessageActionEvent("send",A,null)},onUiActionEvent:function(A){this._fireUiActionEvent(A)},_onServiceError:function(B,A){logger.error("Error occurred while joining group: "+B)},leaveGroup:function(A){ServiceInterface.leaveGroup(this.groupId,{callback:A})}};var GroupItem=Class.create();GroupItem.TYPE_BOOKMARK=1;GroupItem.TYPE_IMAGE=2;GroupItem.TYPE_VIDEO_YOUTUBE=3;GroupItem.TYPE_VIDEO_BREAK=4;GroupItem.TYPE_DISCUSSION=5;var GroupManager=Class.create();GroupManager.prototype={initialize:function(){this.chatApp=null;this.groups=new Hash();this.joinGroupEvent=new CustomEvent();this.leaveGroupEvent=new CustomEvent()},setChatApp:function(A){this.chatApp=A},addJoinGroupListener:function(A){this.joinGroupEvent.observe(A)},_fireJoinGroupEvent:function(A){this.joinGroupEvent.fire(A)},addLeaveGroupListener:function(A){this.leaveGroupEvent.observe(A)},_fireLeaveGroupEvent:function(A){this.leaveGroupEvent.fire(A)},addGroup:function(A){this.groups.set(A.groupId,A);this._fireJoinGroupEvent(A)},leaveGroup:function(A){var B=this.getGroup(A);if(B){B.leaveGroup(this._onLeaveGroupSuccess.bindAsEventListener(this,B))}else{logger.error("Attempted to leave unjoined group "+A)}},_onLeaveGroupSuccess:function(B,A){this._fireLeaveGroupEvent(A);this.groups.unset(A.groupId)},getGroup:function(A){return this.groups.get(A)}};var UserPreferenceManager=Class.create();UserPreferenceManager.prototype={initialize:function(){this.chatApp=null;this.userPreference=null},setChatApp:function(A){this.chatApp=A},setUserPreference:function(A){this.userPreference=A},isSoundOn:function(){return this.userPreference.soundOn},setSoundOn:function(A){this.userPreference.soundOn=A;this._onUserPreferenceUpdate()},_onUserPreferenceUpdate:function(){ServiceInterface.updateUserPreference(this.userPreference,this.chatApp.clientConfig.groupId)}};var AccountManager=Class.create();AccountManager.prototype={initialize:function(){this.chatApp=null;this.balance=0;this.accountBalanceUpdateEvent=new CustomEvent()},setChatApp:function(A){this.chatApp=A},setBalance:function(C,D,B){this.balance=C;this._fireAccountBalanceUpdateEvent();if(B!=null){var A=new ConfirmationPopup();A.setChatApp(this.chatApp);A.setTitle("Account "+(D>0?"Credited":"Debited"));A.setCancelButtonValue(null);A.setMessage(B);A.show()}},addAccountBalaceUpdateListener:function(A){this.accountBalanceUpdateEvent.observe(A)},removeAccountBalaceUpdateListener:function(A){this.accountBalanceUpdateEvent.stopObserving(A)},_fireAccountBalanceUpdateEvent:function(){this.accountBalanceUpdateEvent.fire(""+this.balance)}};var MessageBus=Class.create();MessageBus.prototype={initialize:function(){this.chatApp=null;this.connected=false;this.heartbeatTimer=null;this.connectSuccessEvent=new CustomEvent();this.connectFailureEvent=new CustomEvent();this.disconnectEvent=new CustomEvent();this.windowUnloadListener=this._onWindowUnload.bindAsEventListener(this);Event.observe(window,"unload",this.windowUnloadListener);window.cancelDisconnect=function(){Event.stopObserving(window,"unload",this.windowUnloadListener);this._onWindowUnload()}.bind(this)},setChatApp:function(A){this.chatApp=A},addConnectSuccessListener:function(A){this.connectSuccessEvent.observe(A)},removeConnectSuccessListener:function(A){this.connectSuccessEvent.stopObserving(A)},_fireConnectSuccessEvent:function(A){this.connectSuccessEvent.fire(A)},addConnectFailureListener:function(A){this.connectFailureEvent.observe(A)},removeConnectFailureListener:function(A){this.connectFailureEvent.stopObserving(A)},_fireConnectFailureEvent:function(A){this.connectFailureEvent.fire(A)},addDisconnectListener:function(A){this.disconnectEvent.observe(A)},removeDisconnectListener:function(A){this.disconnectEvent.stopObserving(A)},_fireDisconnectEvent:function(){this.disconnectEvent.fire()},autoConnect:function(){if(this.chatApp.clientConfig.autoConnect){this.connect()}},connect:function(){if(!this.connected){var A=(document.domain).replace("secure.","");if((A!=document.domain)||!Prototype.Browser.IE){document.domain=A}ServiceInterface.connect(this.chatApp.clientConfig,{callback:this._onConnectSuccess.bind(this),errorHandler:this._onConnectFailure.bind(this)})}},_onConnectSuccess:function(B){this.connected=true;this.chatApp.profileManager.setCurrentProfile(B.currentProfile);this.chatApp.userPreferenceManager.setUserPreference(B.userPreference);this.chatApp.accountManager.setBalance(B.accountBalance,0,null);if(!this.chatApp.clientConfig.defaultSoundOn){this.chatApp.userPreferenceManager.setSoundOn(false)}if(B.groupData!=null){var C=new Group(B.groupData.group);C.setChatApp(this.chatApp);C.setConnectSuccessData(B.groupData);this.chatApp.groupManager.addGroup(C)}this._fireConnectSuccessEvent(B);var A=dwr.engine._getScriptSessionId();Redsea.hostid=A;if(location.protocol!="https:"){Redsea.protocol="http";Redsea.host=A+".live."+document.domain}else{Redsea.protocol="https";Redsea.host=(document.domain).replace("secure.","")}Redsea.port=(location.port.length>0)?location.port:80;Redsea.registerEventCallback("process",function(D){setTimeout(D,0)});Redsea.joinChannel(A,5);Redsea.connect();this._scheduleHeartbeat();logger.debug("Client connected.")},_onConnectFailure:function(B,A){clearTimeout(this.heartbeatTimer);this._fireConnectFailureEvent(A);logger.debug("Failed to connect client!")},_scheduleHeartbeat:function(){clearTimeout(this.heartbeatTimer);this.heartbeatTimer=setTimeout(this._onHeartbeatTimer.bindAsEventListener(this),60000)},_onHeartbeatTimer:function(){this._scheduleHeartbeat();ServiceInterface.heartbeat()},_onWindowUnload:function(){if(this.connected){clearTimeout(this.heartbeatTimer);Redsea.disconnect();dwr.engine.setAsync(false);this._fireDisconnectEvent();ServiceInterface.disconnect();this.connected=false}}};var ClientInterface=Class.create();ClientInterface.prototype={initialize:function(){this.chatApp=null},setChatApp:function(A){this.chatApp=A},onOnlineCountChange:function(A,C){var B=this.chatApp.groupManager.getGroup(A);if(B){B.onOnlineCountChange(C)}else{logger.error("onOnlineCountChange: Could not find group "+A)}},onJoinGroup:function(B,E,A){var D=this.chatApp.groupManager.getGroup(B);if(D){this.chatApp.profileManager.setProfile(E);var C=this.chatApp.profileManager.getProfile(E.userId);D.onUserJoin(C,A)}else{logger.error("onJoinGroup: Could not find group "+B)}},onLeaveGroup:function(B,A){var C=this.chatApp.groupManager.getGroup(B);if(C){C.onUserLeave(A)}else{logger.error("onLeaveGroup: Could not find group "+B)}},onGroupUserStateUpdate:function(C,B,A){var D=this.chatApp.groupManager.getGroup(C);if(D){D.onGroupUserStateUpdate(B,A)}else{logger.error("onGroupUserStateUpdate: Could not find group "+C)}},onStickyMessageUpdate:function(B,A){var C=this.chatApp.groupManager.getGroup(B);if(C){C.stickyMessageUpdateEvent.fire(A)}},onProfileChange:function(A){this.chatApp.profileManager.setProfile(A)},onChatAd:function(B,A){var C=this.chatApp.groupManager.getGroup(B);if(C){C.onChatAd(A)}else{logger.error("onChatAd: Could not find group "+B)}},onMessage:function(A){var B=this.chatApp.groupManager.getGroup(A.groupId);if(B){B.onMessage(A)}else{logger.error("onMessage: Could not find group "+A.groupId)}},onMessageDelete:function(C,B,A){var D=this.chatApp.groupManager.getGroup(C);if(D){D.onMessageDelete(B,A)}else{logger.error("onMessageDelete: Could not find group "+C)}},onGroupItem:function(A,B){var C=this.chatApp.groupManager.getGroup(A.groupId);if(C){C.onGroupItem(A,B)}else{logger.error("onGroupItem: Could not find group "+A.groupId)}},onGroupItemUpdate:function(A){var B=this.chatApp.groupManager.getGroup(A.groupId);if(B){B.onGroupItemUpdate(A)}else{logger.error("onGroupItemUpdate: Could not find group "+A.groupId)}},onGroupItemDelete:function(A,C){var B=this.chatApp.groupManager.getGroup(A);if(B){B.onGroupItemDelete(C)}else{logger.error("onGroupItemDelete: Could not find group "+groupItem.groupId)}},onApprovalQueueEvent:function(A){var B=this.chatApp.groupManager.getGroup(A.groupId);if(B){B.approvalQueueEvent.fire(A)}else{logger.error("onApprovalQueueEvent: Could not find group "+A.groupId)}},onMessageSkipped:function(A){var B=this.chatApp.groupManager.getGroup(A);if(B){B.messageSkippedEvent.fire()}},onAccountBalanceUpdate:function(B,C,A){this.chatApp.accountManager.setBalance(B,C,A)},onGiftNotification:function(D,A,C,B){if(this.chatApp.clientConfig.groupId==A){this.chatApp.profileManager.setProfile(D);var E=this.chatApp.groupManager.getGroup(A);E.onPrivateMessageReceived(D.userId,B)}},resetClient:function(A){if(this.chatApp.resetClientEnabled){if(A!=null){alert(A)}window.location.reload()}}};if(dwr==null){var dwr={}}if(dwr.engine==null){dwr.engine={}}if(DWREngine==null){var DWREngine=dwr.engine}if(ServiceInterface==null){var ServiceInterface={}}ServiceInterface._path="/service";ServiceInterface.log=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","log",B,A)};ServiceInterface.connect=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","connect",B,A)};ServiceInterface.setStatus=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","setStatus",C,A,B)};ServiceInterface.disconnect=function(A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","disconnect",A)};ServiceInterface.removeFriend=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","removeFriend",B,A)};ServiceInterface.modifyUserPermissions=function(F,D,C,B,A,E){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","modifyUserPermissions",F,D,C,B,A,E)};ServiceInterface.getDockFlyoutData=function(A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","getDockFlyoutData",A)};ServiceInterface.facebookAuthenticate=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","facebookAuthenticate",E,C,B,A,D)};ServiceInterface.chatrollAuthenticate=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","chatrollAuthenticate",E,C,B,A,D)};ServiceInterface.signout=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","signout",B,A)};ServiceInterface.setGuestDisplayName=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","setGuestDisplayName",C,A,B)};ServiceInterface.deleteProfileImage=function(A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","deleteProfileImage",A)};ServiceInterface.getProfile=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","getProfile",B,A)};ServiceInterface.submitGroupSettingsBasicForm=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsBasicForm",E,C,B,A,D)};ServiceInterface.submitGroupSettingsAccessForm=function(H,F,E,D,C,B,A,G){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsAccessForm",H,F,E,D,C,B,A,G)};ServiceInterface.submitGroupSettingsPrivacyForm=function(J,I,G,F,E,D,C,B,A,H){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsPrivacyForm",J,I,G,F,E,D,C,B,A,H)};ServiceInterface.submitGroupSettingsSharingForm=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsSharingForm",E,C,B,A,D)};ServiceInterface.submitGroupSettingsTwitterForm=function(D,B,A,C){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsTwitterForm",D,B,A,C)};ServiceInterface.submitGroupSettingsModerationForm=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsModerationForm",C,A,B)};ServiceInterface.setManualApprovalEnabled=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","setManualApprovalEnabled",C,A,B)};ServiceInterface.getHistoryMessages=function(D,B,A,C){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","getHistoryMessages",D,B,A,C)};ServiceInterface.getApprovalQueueSection=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","getApprovalQueueSection",C,A,B)};ServiceInterface.approveMessage=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","approveMessage",C,A,B)};ServiceInterface.skipMessage=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","skipMessage",C,A,B)};ServiceInterface.approveAllMessages=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","approveAllMessages",B,A)};ServiceInterface.skipAllMessages=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","skipAllMessages",B,A)};ServiceInterface.clearRecentMessages=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","clearRecentMessages",B,A)};ServiceInterface.submitGroupSettingsWordFilterForm=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsWordFilterForm",C,A,B)};ServiceInterface.submitGroupSettingsAccessPassForm=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsAccessPassForm",E,C,B,A,D)};ServiceInterface.submitGroupSettingsAppearanceForm=function(L,K,I,H,G,F,E,D,C,B,A,J){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","submitGroupSettingsAppearanceForm",L,K,I,H,G,F,E,D,C,B,A,J)};ServiceInterface.updateStickyMessage=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","updateStickyMessage",C,A,B)};ServiceInterface.updateWelcomeMessage=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","updateWelcomeMessage",C,A,B)};ServiceInterface.setCrossPostUrl=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","setCrossPostUrl",C,A,B)};ServiceInterface.crossPost=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","crossPost",C,A,B)};ServiceInterface.sendMessage=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","sendMessage",C,A,B)};ServiceInterface.updateUserPreference=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","updateUserPreference",C,A,B)};ServiceInterface.deleteMessages=function(D,B,A,C){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","deleteMessages",D,B,A,C)};ServiceInterface.deleteGroupItem=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","deleteGroupItem",C,A,B)};ServiceInterface.deleteGroup=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","deleteGroup",B,A)};ServiceInterface.banUser=function(C,A,B){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","banUser",C,A,B)};ServiceInterface.banIp=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","banIp",E,C,B,A,D)};ServiceInterface.modifyDeniedIpPermissions=function(F,D,C,B,A,E){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","modifyDeniedIpPermissions",F,D,C,B,A,E)};ServiceInterface.purchaseAccessPass=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","purchaseAccessPass",B,A)};ServiceInterface.purchaseBluePass=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","purchaseBluePass",B,A)};ServiceInterface.purchaseGift=function(E,C,B,A,D){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","purchaseGift",E,C,B,A,D)};ServiceInterface.trackConversion=function(B,A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","trackConversion",B,A)};ServiceInterface.getChartData=function(G,E,D,C,B,A,F){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","getChartData",G,E,D,C,B,A,F)};ServiceInterface.heartbeat=function(A){dwr.engine._execute(ServiceInterface._path,"ServiceInterface","heartbeat",A)};var MainLayout=Class.create();MainLayout.prototype={initialize:function(){this.chatApp=null;this.resizeElements=$$(".vertical-resize");this._onWindowResize()},setChatApp:function(B){this.chatApp=B;this.header=new Header($$(".header")[0]);this.header.setChatApp(B);var A=$$(".chat-sound-button")[0];if(A!=null){this.soundNotifier=new SoundNotifier(A);this.soundNotifier.setChatApp(B)}Event.observe(window,"resize",this._onWindowResize.bindAsEventListener(this));Event.observe(window,"scroll",this._onWindowResize.bindAsEventListener(this))},_onWindowResize:function(){var B=this.resizeElements.length;for(var C=0;C<B;C++){var D=this.resizeElements[C];var H=D.up();var A=H.cumulativeOffset().top;var I=90;var F=document.viewport.getHeight();var G=document.viewport.getScrollOffsets().top;var E=0;var J=400;if(G<=(A-I)){E=0;J=F-A+G-10}else{E=G-A+I;J=F-I-10}D.setStyle({top:E+"px",height:J+"px"})}}};var EmbedLayout=Class.create();EmbedLayout.prototype={initialize:function(){this.chatApp=null;this.groupChatWidget=new GroupChatWidget($$(".group-chat-embedded")[0]);this.soundNotifier=new SoundNotifier($$(".chat-sound-button")[0])},setChatApp:function(A){this.chatApp=A;this.groupChatWidget.setChatApp(this.chatApp);this.soundNotifier.setChatApp(A);this.chatApp.groupManager.addJoinGroupListener(this._onJoinGroup.bindAsEventListener(this))},_onJoinGroup:function(A){if(A.groupId==this.chatApp.clientConfig.groupId){this.groupChatWidget.setGroup(A)}}};var GroupView=Class.create();GroupView.prototype={initialize:function(B,A){this.frame=B;this.groupId=A;this.chatApp=null;this.group=null},setChatApp:function(A){this.chatApp=A;this.groupChatWidget=new GroupChatWidget($$(".group-chat-container")[0]);this.groupChatWidget.setChatApp(this.chatApp);this.chatApp.groupManager.addJoinGroupListener(this._onJoinGroup.bindAsEventListener(this))},_onJoinGroup:function(D){if(D.groupId==this.groupId){this.group=D;var C=null;this.groupContent=this.frame.down(".group-content");this.groupChatWidget.setGroup(this.group);C=this.frame.down(".widgetid-group-settings");if(C!=null){this.groupSettingsWidget=new GroupSettingsWidget(C);this.groupSettingsWidget.setChatApp(this.chatApp);this.groupSettingsWidget.setGroup(this.group)}var A=8;C=this.frame.down(".widgetid-media-items");if(C==null){C=this.frame.down(".widgetid-media-items-maximized");A=24}if(C!=null){this.mediaItemsWidget=new GroupItemsWidget(C);this.mediaItemsWidget.setChatApp(this.chatApp);var B=new Array();B.push(GroupItem.TYPE_BOOKMARK);B.push(GroupItem.TYPE_IMAGE);B.push(GroupItem.TYPE_VIDEO_BREAK);B.push(GroupItem.TYPE_VIDEO_YOUTUBE);this.mediaItemsWidget.setItemTypeFilter(B);this.mediaItemsWidget.setGroupItemsLimit(A);this.mediaItemsWidget.setGroup(this.group)}C=this.frame.down(".widgetid-group-archive");if(C!=null){this.groupArchiveWidget=new GroupArchiveWidget(C);this.groupArchiveWidget.setChatApp(this.chatApp);this.groupArchiveWidget.setGroup(this.group)}C=this.frame.down(".widgetid-group-archive-export");if(C!=null){this.groupArchiveExportWidget=new GroupArchiveExportWidget(C);this.groupArchiveExportWidget.setChatApp(this.chatApp);this.groupArchiveExportWidget.setGroup(this.group)}C=this.frame.down(".settings-section-appearance");if(C!=null){this.groupSettingsAppearanceWidget=new GroupSettingsAppearanceWidget(C);this.groupSettingsAppearanceWidget.setChatApp(this.chatApp);this.groupSettingsAppearanceWidget.setGroup(this.group)}}},_onLeaveGroup:function(A){if(A.groupId==this.groupId){window.location=this.chatApp.clientConfig.baseWebUrl+"/"}},destroy:function(){if(this.groupChatWidget!=null){this.groupChatWidget.destroy();this.groupChatWidget=null}if(this.mediaItemsWidget!=null){this.mediaItemsWidget.destroy();this.mediaItemsWidget=null}if(this.groupArchiveWidget!=null){this.groupArchiveWidget.destroy();this.groupArchiveWidget=null}}};var CreateGroupView=Class.create();CreateGroupView.prototype={initialize:function(A){this.frame=A;this.nameInput=this.frame.down(".create-group-name-input");this.nameCharsAvailable=this.frame.down(".create-group-name-chars-available");this.nameMaxSize=64;this.isNameModified=false;this.descInput=this.frame.down(".create-group-desc-input");this.descCharsAvailable=this.frame.down(".create-group-desc-chars-available");this.descMaxSize=150;this.urlInput=this.frame.down(".create-group-url-input");this.categoryInput=this.frame.down(".create-group-category-input");this._checkInputLength(this.nameInput,this.nameCharsAvailable,this.nameMaxSize);this._checkInputLength(this.descInput,this.descCharsAvailable,this.descMaxSize);this.isUrlModified=false;if(this.urlInput.value!=""&&this.urlInput.value!=this._createUrlFromNameInput()){this.isUrlModified=true}else{this.frame.down(".create-group-url-input").value=this._createUrlFromNameInput()}Event.observe(this.nameInput,"keyup",this._onNameInputKeyup.bindAsEventListener(this));Event.observe(this.urlInput,"keyup",this._onUrlInputKeyup.bindAsEventListener(this));Event.observe(this.descInput,"keyup",this._onDescInputKeyup.bindAsEventListener(this))},setChatApp:function(A){this.chatApp=A},_onNameInputKeyup:function(A){this.isNameModified=true;this._checkInputLength(this.nameInput,this.nameCharsAvailable,this.nameMaxSize);if(!this.isUrlModified){this.frame.down(".create-group-url-input").value=this._createUrlFromNameInput()}},_onUrlInputKeyup:function(A){this.isUrlModified=true},_onDescInputKeyup:function(A){this._checkInputLength(this.descInput,this.descCharsAvailable,this.descMaxSize)},_checkInputLength:function(E,D,A){var B=A-E.value.length;if(B<=0){E.value=E.value.substring(0,A);B=0;D.addClassName("form-error")}else{D.removeClassName("form-error")}var C=B+((B!=1)?" characters":" character")+" left";D.innerHTML=C},_createUrlFromNameInput:function(){var A=this.nameInput.value;A=A.gsub("'","");A=A.gsub("[^a-zA-Z0-9_\\-]"," ").strip();A=A.gsub("\\s+","-").toLowerCase();return A}};var ProfileView=Class.create();ProfileView.prototype={initialize:function(B,A){this.frame=B;this.userId=A;this.chatApp=null;this.basicSection=new BasicSection(this,this.frame.down(".basic-profile-section"))},setChatApp:function(A){this.chatApp=A}};var BasicSection=Class.create();BasicSection.prototype={initialize:function(A,B){this.profileView=A;this.frame=B;this.removeFriendButton=this.profileView.frame.down(".remove-friend-button");if(this.removeFriendButton!=null){Event.observe(this.removeFriendButton,"click",this._onRemoveFriendButtonClick.bindAsEventListener(this))}},_onRemoveFriendButtonClick:function(){ServiceInterface.removeFriend(this.profileView.userId,{callback:function(){location.reload(true)},errorHandler:function(){}})}};var ProfileSettingsView=Class.create();ProfileSettingsView.prototype={initialize:function(A){this.frame=A;var A=null;A=this.frame.down(".settings-section-basic");if(A!=null){var B=new ProfileSettingsBasicSection(A)}A=this.frame.down(".settings-section-picture");if(A!=null){var B=new ProfileSettingsPictureSection(A)}},setChatApp:function(A){}};var ProfileSettingsBasicSection=Class.create();ProfileSettingsBasicSection.prototype={initialize:function(A){this.frame=A;this.nameInput=this.frame.down(".name-input");this.selfBlurbMaxSize=500;this.selfBlurbInput=this.frame.down(".profile-selfblurb-input");this.selfBlurbCharsAvailable=this.frame.down(".profile-selfblurb-chars-available");Event.observe(this.selfBlurbInput,"keyup",this._onSelfBlurbInputKeyup.bindAsEventListener(this));this._checkInputLength(this.selfBlurbInput,this.selfBlurbCharsAvailable,this.selfBlurbMaxSize)},_onSelfBlurbInputKeyup:function(){this._checkInputLength(this.selfBlurbInput,this.selfBlurbCharsAvailable,this.selfBlurbMaxSize)},_checkInputLength:function(E,D,A){var B=A-E.value.length;if(B<=0){E.value=E.value.substring(0,A);B=0;D.addClassName("form-error")}else{D.removeClassName("form-error")}var C=B+((B>1)?" characters":" character")+" left";D.innerHTML=C}};var ProfileSettingsPictureSection=Class.create();ProfileSettingsPictureSection.prototype={initialize:function(A){this.frame=A;this.imageDisplay=this.frame.down(".profile-image-display");this.statusLabel=this.frame.down(".profile-image-status");this.imageUploadFrame=this.frame.down(".image-upload-frame");this.editControls=this.frame.down(".profile-image-edit-controls");this.imageSubmitButton=this.editControls.down(".image-submit-button");this.imageFileInput=this.editControls.down(".image-file-input");Event.observe(this.imageSubmitButton,"click",this._onSubmit.bindAsEventListener(this));this.imageDeleteButton=this.frame.down(".image-delete-button");if(this.imageDeleteButton!=null){Event.observe(this.imageDeleteButton,"click",this._onDelete.bindAsEventListener(this))}},_onSubmit:function(A){this.editControls.hide();this.statusLabel.innerHTML="Uploading...";this.statusLabel.removeClassName("form-error");this.statusLabel.show();Event.observe(this.imageUploadFrame,"load",this._onLoad.bindAsEventListener(this))},_onDelete:function(A){ServiceInterface.deleteProfileImage({callback:function(){window.location.replace(window.location.href)}})},_onLoad:function(){Event.stopObserving(this.imageUploadFrame,"load",this._onLoad.bindAsEventListener(this));var A=this.imageUploadFrame.contentWindow||this.imageUploadFrame.contentDocument;if(A.document){A=A.document}var B=A.getElementById("image-upload-errors");if(B!=undefined&&B!="undefined"){this.statusLabel.innerHTML=B.innerHTML;this.statusLabel.addClassName("form-error");this.statusLabel.show();this.editControls.show()}else{window.location.replace(window.location.href)}}};var SoundNotifier=Class.create();SoundNotifier.prototype={initialize:function(A){this.soundControl=A;this.groups=new Hash();Event.observe(this.soundControl,"click",this._onControlClick.bindAsEventListener(this));this.onMessageListener=this._onMessage.bindAsEventListener(this)},setChatApp:function(B){this.chatApp=B;var A=this.chatApp.clientConfig.baseStaticUrl;this.msgInUrl=A+"/sound/message-in-68880d53.mp3";this.msgInLayer=0;this.msgOutUrl=A+"/sound/message-out-d33411ab.mp3";this.msgOutLayer=0;B.messageBus.addConnectSuccessListener(this._onConnectSuccess.bindAsEventListener(this));B.groupManager.addJoinGroupListener(this._onJoinGroup.bindAsEventListener(this));B.groupManager.addLeaveGroupListener(this._onLeaveGroup.bindAsEventListener(this))},_onConnectSuccess:function(A){this._updateControlDisplay()},_onControlClick:function(A){if(this.chatApp.userPreferenceManager.isSoundOn()){this.chatApp.userPreferenceManager.setSoundOn(false)}else{this.chatApp.userPreferenceManager.setSoundOn(true)}this._updateControlDisplay()},_updateControlDisplay:function(){if(this.chatApp.userPreferenceManager.isSoundOn()){this.soundControl.addClassName("chat-sound-button-true");this.soundControl.removeClassName("chat-sound-button-false")}else{this.soundControl.addClassName("chat-sound-button-false");this.soundControl.removeClassName("chat-sound-button-true")}},_onJoinGroup:function(A){if(!this.groups.get(A.groupId)){this.groups.set(A.groupId,A);A.addMessageListener(this.onMessageListener)}else{logger.error("_onJoinGroup: Can't create already existing group: "+A.groupId)}},_onLeaveGroup:function(B){var A=this.groups.get(B.groupId);if(A){this.groups.unset(B.groupId);A.removeMessageListener(this.onMessageListener)}else{logger.error("_onLeaveGroup: Couldn't find group: "+B.groupId)}},_onMessage:function(A){if(this.chatApp.userPreferenceManager.isSoundOn()){if(A.userId!=this.chatApp.profileManager.currentUserId){this.msgInLayer=(this.msgInLayer+1)%2;soundManager.play("msgIn"+this.msgInLayer,this.msgInUrl)}else{this.msgOutLayer=(this.msgOutLayer+1)%2;soundManager.play("msgOut"+this.msgOutLayer,this.msgOutUrl)}}}};var Header=Class.create();Header.prototype={initialize:function(A){this.frame=A;this.chatApp=null},setChatApp:function(B){this.chatApp=B;var A=this.frame.down(".header-profile");if(A!=null){this.headerProfile=new HeaderProfile(A);this.headerProfile.setChatApp(B)}}};var HeaderProfile=Class.create();HeaderProfile.prototype={initialize:function(A){this.chatApp=null;this.frame=A;this.mouseInside=false;this.popupOpen=false;this.statusLink=this.frame.down(".header-status-link");this.statusIcon=this.frame.down(".status-icon");this.statusText=this.frame.down(".header-status-text");if(this.statusLink){Event.observe(this.statusLink,"mouseenter",this._onLinkMouseEnter.bindAsEventListener(this));Event.observe(this.statusLink,"mouseleave",this._onLinkMouseLeave.bindAsEventListener(this))}},setChatApp:function(A){this.chatApp=A;this.chatApp.profileManager.addCurrentProfileChangeListener(this._onCurrentProfileChange.bindAsEventListener(this))},_onCurrentProfileChange:function(A){this._updateDisplay(A)},_updateDisplay:function(A){if(!A.guest){this.statusIcon.className="status-icon status-icon-"+A.status;this.statusIcon.title=A.displayStatus;this.statusText.innerHTML="("+A.displayStatus+")"}},_onLinkMouseEnter:function(){this.mouseInside=true;this._openPopup()},_onLinkMouseLeave:function(){this.mouseInside=false;setTimeout(this._onLinkMouseLeaveTimer.bind(this),300)},_onLinkMouseLeaveTimer:function(){if(!this.mouseInside){this._closePopup()}},_openPopup:function(){if(!this.popupOpen){var A=this.chatApp.tooltipManager.showTooltip({html:this.frame.down(".header-status-popup").innerHTML,relativeElement:this.statusLink,right:"right",top:"bottom",offsetTop:4});Event.observe(A,"mouseenter",this._onLinkMouseEnter.bindAsEventListener(this));Event.observe(A,"mouseleave",this._onLinkMouseLeave.bindAsEventListener(this));Event.observe(A.down(".header-status-online"),"click",function(){this._closePopup();this._setStatus(1)}.bindAsEventListener(this));Event.observe(A.down(".header-status-away"),"click",function(){this._closePopup();this._setStatus(2)}.bindAsEventListener(this));this.popupOpen=true}},_closePopup:function(){if(this.popupOpen){this.chatApp.tooltipManager.hideTooltips();this.popupOpen=false}},_setStatus:function(A){ServiceInterface.setStatus(A,this.chatApp.clientConfig.groupId)}};var DockFlyout=Class.create();DockFlyout.prototype={initialize:function(A){this.chatApp=null;this.dockFlyoutButton=A;this.notifyBubble=this.dockFlyoutButton.down(".dock-item-bubble");this.notifyText=this.notifyBubble.down("div");Event.observe(this.dockFlyoutButton,"mouseenter",this._onButtonMouseEnter.bindAsEventListener(this));Event.observe(this.dockFlyoutButton,"mouseleave",this._onButtonMouseLeave.bindAsEventListener(this));Event.observe(this.dockFlyoutButton,"click",this._onButtonClick.bindAsEventListener(this))},setChatApp:function(A){this.chatApp=A},_onButtonMouseEnter:function(){if(!this.flyoutOpen){this.chatApp.tooltipManager.showTooltip({html:"<div class='tooltip'>View All</div>",relativeElement:this.dockFlyoutButton,left:"right",offsetLeft:4,top:"fixed",offsetTop:110})}},_onButtonMouseLeave:function(){if(!this.flyoutOpen){this.chatApp.tooltipManager.hideTooltips()}},_onButtonClick:function(){this._showFlyout()},_showFlyout:function(){ServiceInterface.getDockFlyoutData({callback:this._onDockFlyoutData.bind(this)})},_onDockFlyoutData:function(A){this.chatApp.tooltipManager.hideTooltips();if(A!=null&&A.length>0){this.flyoutOpen=true;var B=this._renderHTML(A);var C=this.chatApp.tooltipManager.showTooltip({html:B,relativeElement:this.dockFlyoutButton,left:"right",offsetLeft:4,top:"fixed",offsetTop:74,onHideCallback:function(){this.flyoutOpen=false}.bind(this)})}else{this.chatApp.tooltipManager.showTooltip({html:"<div class='tooltip'>Chatrolls you create will be <br/>added here for easy access</div>",relativeElement:this.dockFlyoutButton,left:"right",offsetLeft:4,top:"fixed",offsetTop:110})}},_renderHTML:function(S){var C=178;var O=34;var E=((document.viewport.getWidth()-200)/C).floor();if(E<1){E=1}var D=10;var Q=D*E;var N=S.size();if(N>Q){D=(N/E).ceil()}var K=(N/D).ceil();var J=(N<D)?N:D;var R=K*C;var M=J*O;var L="<div class='dock-flyout'>";L+="<div class='dock-flyout-title' style='width:"+R+"px;'><div style='padding:4px;'>"+N+" Chatrolls</div></div>";L+="<div style='position:relative;width:"+R+"px;height:"+M+"px;'>";for(var P=0;P<S.length;P++){var H=S[P];var B="";var A="";var G="";var T="1";var U=(P/J).floor()*C;var I=(P%J)*O;var F=this.chatApp.templateManager.evaluate("site:dock-flyout-item",{url:this.chatApp.clientConfig.baseWebUrl+"/"+H.url,left:U,top:I,nameHtmlWbr:H.nameHtmlWbr,itemClass:B,textClass:A,notifyVisibility:G,notifyText:T});L+=F}L+="</div>";L+="</div>";return L}};var ConfirmationPopup=Class.create();ConfirmationPopup.prototype={initialize:function(){this.chatApp=null;this.container=null;this.title=_("Are you sure?");this.message=null;this.okButtonValue=_("OK");this.cancelButtonValue=_("Cancel");this.onOkCallback=null;this.onCancelCallback=null;this.width=null;this.height=null},setChatApp:function(A){this.chatApp=A},setContainer:function(A){this.container=A},setTitle:function(A){this.title=A},setMessage:function(A){this.message=A},setOkButtonValue:function(A){this.okButtonValue=A},setCancelButtonValue:function(A){this.cancelButtonValue=A},setWidth:function(A){this.width=A},setHeight:function(A){this.height=A},setOnOkCallback:function(A){this.onOkCallback=A},setOnCancelCallback:function(A){this.onCancelCallback=A},destroy:function(){this.chatApp.tooltipManager.hideTooltips()},show:function(){var C=new Element("div");C.innerHTML=this.chatApp.templateManager.evaluate("site-confirmation-popup");var E=C.down(".popup-title");if(this.title!=null){E.innerHTML=this.title;Event.observe(C.down(".confirmation-close-button"),"click",this._closePopup.bindAsEventListener(this))}else{E.hide();C.down(".confirmation-close-button").hide()}C.down(".confirmation-message").innerHTML=this.message;var H=C.down(".confirmation-ok-button");if(this.okButtonValue!=null){H.value=this.okButtonValue}else{H.hide()}var D=C.down(".confirmation-cancel-button");if(this.cancelButtonValue!=null){D.value=this.cancelButtonValue}else{D.hide()}var B=C.down(".confirmation-popup-border");if(this.width!=null||this.height!=null){var G=(this.width!=null)?this.width+"px":null;var A=(this.height!=null)?this.height+"px":null;B.setStyle({width:G,height:A})}var F=this.chatApp.tooltipManager.showTooltip({element:C.firstDescendant(),relativeElement:this.container,left:"center",top:"center",onHideCallback:this.onCancelCallback});Event.observe(F.down(".confirmation-ok-button"),"click",this._onOkButtonClick.bindAsEventListener(this));Event.observe(F.down(".confirmation-cancel-button"),"click",this._onCancelButtonClick.bindAsEventListener(this))},_onOkButtonClick:function(){this.destroy();if(this.onOkCallback!=null){this.onOkCallback()}},_onCancelButtonClick:function(){this.destroy();if(this.onCancelCallback!=null){this.onCancelCallback()}},_closePopup:function(){this.destroy();if(this.onCancelCallback!=null){this.onCancelCallback()}}};var FacebookConnectButton=Class.create();FacebookConnectButton.prototype={initialize:function(A){this.frame=A;this.chatApp=null;this.defaultRedirectUrl=null;this.isSignup=false;this.onErrorCallback=null},setChatApp:function(A){this.chatApp=A;Event.observe(this.frame,"click",this._onClick.bindAsEventListener(this))},setSignupMode:function(A){this.isSignup=A},setOnErrorCallback:function(A){this.onErrorCallback=A},setDefaultRedirectUrl:function(A){this.defaultRedirectUrl=A},_onClick:function(A){this.chatApp.facebook.login(function(C){if(C.authResponse){this.chatApp.resetClientEnabled=false;var B=C.authResponse;ServiceInterface.facebookAuthenticate(B.accessToken,B.expiresIn,this.chatApp.clientConfig.groupId,this.isSignup,{callback:function(D){if(D!=null){location.replace(D)}else{if(this.defaultRedirectUrl!=null){location.replace(this.defaultRedirectUrl)}else{location.reload(true)}}}.bind(this),errorHandler:function(){this.chatApp.resetClientEnabled=true;if(this.onErrorCallback!=null){this.onErrorCallback()}}.bind(this)})}}.bind(this))}};var SigninBox=Class.create();SigninBox.randomGuestName=null;function popupWindow(B,F,A,C){var E=(screen.width/2)-(A/2);var D=(screen.height/2)-(C/2);return window.open(B,F,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+A+", height="+C+", top="+D+", left="+E)}function reloadWhenReady(){if(document.cookie.indexOf("JSESSIONID")!=-1){window.location.reload(true)}else{var A=window.setInterval(function(){if(document.cookie.indexOf("JSESSIONID")!=-1){window.clearInterval(A);window.location.reload(true)}},200)}}SigninBox.prototype={initialize:function(A){this.frame=A;this.chatApp=null;this.numSelectableMethods=0;this.defaultMode=null;this.currentMode=null},setChatApp:function(D){this.chatApp=D;var B=$H(this.chatApp.clientConfig.groupSigninMethods).keys().length;if(B!=0){this.frame.show();var A;if(this.chatApp.clientConfig.groupSigninMethods["chatroll"]){A=this.frame.down(".signin-chatroll-button");A.show();Event.observe(A,"click",function(E){this._setMode("chatroll")}.bindAsEventListener(this));this.numSelectableMethods++;if(this.defaultMode==null){this.defaultMode="chatroll"}}if(this.chatApp.clientConfig.groupSigninMethods["facebook"]){A=this.frame.down(".signin-facebook-button");A.show();Event.observe(A,"click",function(E){if(document.cookie.indexOf("JSESSIONID")==-1){var F="https://"+document.domain+"/auth-redirect;jsessionid="+dwr.engine._sessionId+"?url=close";popupWindow(F,"",400,200)}this.chatApp.facebook.login(function(H){if(H.authResponse){this._setMode("facebook");this.chatApp.resetClientEnabled=false;var G=H.authResponse;ServiceInterface.facebookAuthenticate(G.accessToken,G.expiresIn,this.chatApp.clientConfig.groupId,false,{callback:function(){reloadWhenReady()},errorHandler:function(){this.chatApp.resetClientEnabled=true}})}}.bind(this))}.bindAsEventListener(this));this.numSelectableMethods++}if(this.chatApp.clientConfig.groupSigninMethods["twitter"]){var C=this.frame.down(".signin-twitter-button");C.show();Event.observe(C,"click",function(F){this._setMode("facebook");var E="https://"+document.domain+"/twitter-auth-request?groupId="+this.chatApp.clientConfig.groupId;var G="https://"+document.domain+"/auth-redirect;jsessionid="+dwr.engine._sessionId+"?url="+encodeURIComponent(E);popupWindow(G,"",800,600)}.bindAsEventListener(this));this.numSelectableMethods++}if(this.chatApp.clientConfig.groupSigninMethods["guest"]){A=this.frame.down(".signin-guest-button");A.show();Event.observe(A,"click",function(E){this._setMode("guest")}.bindAsEventListener(this));this.numSelectableMethods++;if(this.defaultMode==null){this.defaultMode="guest"}}if(this.chatApp.clientConfig.groupSigninMethods["sso"]){}if(this.numSelectableMethods>1||this.defaultMode==null){this.defaultMode="select"}this._setMode(this.defaultMode)}this.chatApp.messageBus.addConnectFailureListener(this._onConnectFailure.bindAsEventListener(this))},_setMode:function(G){if(G!=this.currentMode){var H=false;if(this.currentMode!=null){var E=this.frame.down(".signin-"+this.currentMode);E.hide();H=true}this.currentMode=G;var D=this.frame.down(".signin-"+this.currentMode);D.show();if(G=="select"){var A="";A+="<b>"+_("Please sign in")+"</b>";this.frame.down(".signin-prompt").innerHTML=A}else{if(G=="chatroll"){var A="";A+="<b>Sign in</b> or <a style='font-weight:bold;text-decoration:underline;' ";A+="href='"+this.chatApp.clientConfig.baseWebUrl+"/signup?groupId="+this.chatApp.clientConfig.groupId+"' ";if(this.chatApp.clientConfig.embedded){A+="target='_blank' "}A+=">Sign up</a> with <b>Chatroll</b>";this.frame.down(".signin-prompt").innerHTML=A;this._addModeCancelButton();var F=this.frame.down(".chatroll-signin-name");var B=this.frame.down(".chatroll-signin-password");var C=this.frame.down(".chatroll-signin-submit");F.enable();B.enable();C.enable();Event.observe(C,"click",this._onChatrollSubmit.bindAsEventListener(this));Event.observe(F,"keydown",function(I){if(I.keyCode==13){C.click()}});Event.observe(B,"keydown",function(I){if(I.keyCode==13){C.click()}})}else{if(G=="facebook"){this.frame.down(".signin-prompt").innerHTML=""}else{if(G=="guest"){this.frame.down(".signin-prompt").innerHTML=_("<b>Sign in</b> as a <b>Guest</b>");this._addModeCancelButton();var F=this.frame.down(".guest-signin-name");var C=this.frame.down(".guest-signin-submit");F.enable();C.enable();if(SigninBox.randomGuestName==null){SigninBox.randomGuestName=_("Guest")+Math.floor(Math.random()*999);F.value=SigninBox.randomGuestName}Event.observe(C,"click",this._onGuestSubmit.bindAsEventListener(this));Event.observe(F,"keydown",function(I){if(I.keyCode==13){C.click()}})}}}}this.focus(H)}},isSigninRequired:function(){var A=this.chatApp.profileManager.getCurrentProfile();if(A==null||(A.guest&&A.displayName=="")||this.chatApp.clientConfig.groupUserState.permissions[GroupPermission.PERMISSION_WRITE]==false){return true}else{return false}},focus:function(A){if(!this.chatApp.clientConfig.embedded||A){if(this.currentMode=="chatroll"){this.frame.down(".chatroll-signin-name").select()}else{if(this.currentMode=="guest"){this.frame.down(".guest-signin-name").select()}}}},_onChatrollSubmit:function(){var B=$F(this.frame.down(".chatroll-signin-name"));var A=$F(this.frame.down(".chatroll-signin-password"));A=hex_sha1(this.chatApp.clientConfig.authChallenge+hex_sha1(A));if(document.cookie.indexOf("JSESSIONID")==-1){var C="https://"+document.domain+"/auth-redirect;jsessionid="+dwr.engine._sessionId+"?url=close";popupWindow(C,"",400,200)}this.chatApp.resetClientEnabled=false;ServiceInterface.chatrollAuthenticate(this.chatApp.clientConfig.authChallenge,B,A,this.chatApp.clientConfig.groupId,{callback:function(){reloadWhenReady()},errorHandler:function(){this.chatApp.resetClientEnabled=true;var D="<span style='color:#ff0000;font-weight:bold;'>Wrong username or password!</span>";this.frame.down(".signin-prompt").innerHTML=D;this._addModeCancelButton()}.bind(this)})},_onGuestSubmit:function(){if(document.cookie.indexOf("JSESSIONID")==-1){var A="https://"+document.domain+"/auth-redirect;jsessionid="+dwr.engine._sessionId+"?url=close";popupWindow(A,"",400,200)}if(this.chatApp.clientConfig.autoConnect){this._setGuestName()}else{this.chatApp.messageBus.addConnectSuccessListener(this._onConnectSuccess.bindAsEventListener(this));this.chatApp.messageBus.connect()}},_setGuestName:function(){var B=this.frame.down(".guest-signin-name");var A=$F(B);B.disable();this.frame.down(".guest-signin-submit").disable();ServiceInterface.setGuestDisplayName(A,this.chatApp.clientConfig.groupId,{callback:function(C){this.chatApp.profileManager.setCurrentProfile(C)}.bind(this),errorHandler:function(){this.frame.down(".guest-signin-name").enable();this.frame.down(".guest-signin-submit").enable();var C="<span style='color:#ff0000;font-weight:bold;'>Minimum 3 letters and numbers (no spaces!)</span>";this.frame.down(".signin-prompt").innerHTML=C;this._addModeCancelButton()}.bind(this)})},_addModeCancelButton:function(){var A=this.frame.down(".signin-prompt").innerHTML;if(this.defaultMode=="select"){A+=" (<a class='signin-cancel' href='javascript:void(0)'>"+_("cancel")+"</a>)"}this.frame.down(".signin-prompt").innerHTML=A;if(this.defaultMode=="select"){Event.observe(this.frame.down(".signin-cancel"),"click",function(){this._setMode("select")}.bindAsEventListener(this))}},_onConnectSuccess:function(){this._setGuestName()},_onConnectFailure:function(C){var B=this.frame.down(".signin-over-capacity");var A="<div style='padding-top:8px;'>This Chatroll is over capacity. Please <a href='#' onclick='window.location.reload();'>Retry</a> in a minute.</div>";if(C.javaClassName=="com.chatroll.service.group.AccessPassRequiredException"){this.accessPassOffer=C.offer;A+="<div>(Purchase an <a class='access-pass-purchase' href='javascript:void(0);'>Access Pass</a> to get access now.)</div>";B.innerHTML=A;Event.observe(B.down(".access-pass-purchase"),"click",this._onAccessPassPurchaseClick.bindAsEventListener(this))}else{B.innerHTML=A}this._setMode("over-capacity");this.frame.down(".signin-prompt").hide();this.frame.show()},_onAccessPassPurchaseClick:function(){var B=new ConfirmationPopup();B.setChatApp(this.chatApp);B.setTitle("Get Access Now");B.setOkButtonValue("Buy Now");B.setCancelButtonValue("No Thanks");var A="<div style='width:190px;'><div><img class='access-badge-icon' style='vertical-align:middle;' src='/t.gif'><span style='font-weight:bold;vertical-align:middle;padding-left:7px;'>Access Pass &ndash; "+this.accessPassOffer.amount+" Credits</span></div><div style='padding-top:5px;'>The Access Pass gives you unlimited immediate entry to this Chatroll for the next 24 hours.</div></div>";B.setMessage(A);B.setOnOkCallback(function(){var C=this.chatApp.tooltipManager.activeTooltip;ServiceInterface.purchaseAccessPass(this.chatApp.clientConfig.groupId,{callback:this._onAccessPassPurchaseSuccess.bind(this),errorHandler:this._onAccessPassPurchaseError.bind(this)})}.bind(this));B.show()},_onAccessPassPurchaseSuccess:function(){window.location.reload()},_onAccessPassPurchaseError:function(){var B=new ConfirmationPopup();B.setChatApp(this.chatApp);B.setTitle("Insufficient Credit");B.setOkButtonValue(null);B.setCancelButtonValue(null);var A="<div style='width:190px;'>You need <b>"+this.accessPassOffer.amount+" Credits</b> to<br/>buy an Access Pass.<div style='padding-top:8px;font-size:1.1em;font-weight:bold;'><a style='text-decoration:underline;' href='/store/getcredits?offerId="+this.accessPassOffer.offerId+"' target='_blank'>Get Chatroll Credits Now &raquo;</a></div></div>";B.setMessage(A);B.show()}};var ChatAd=Class.create();ChatAd.prototype={initialize:function(){this.chatApp=null;this.group=null;this.chatWidget=null;this.adImpression=null;this.animDuration=500;this.slotHeight=0;this.animStartTime=0;this.closeTimer=null;this.iframeClickInterval=null;this.conversionTracked=false;this.fbLikeSubscribed=false},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.group.addChatAdListener(this._onChatAd.bindAsEventListener(this))},setChatWidget:function(A){this.chatWidget=A},_animateSlot:function(A,D){if(D){this.animStartTime=new Date().getTime()}var C=(new Date().getTime())-this.animStartTime;if(C>this.animDuration){C=this.animDuration}var B=Math.sin(0.5*Math.PI*C/this.animDuration);if(!A){B=1-B}this.chatWidget.setAdPadding(Math.round(B*this.slotHeight));if(C<this.animDuration){setTimeout(function(){this._animateSlot(A,false)}.bind(this),10)}else{if(A){this._showAd()}}},_showAd:function(){var C=this.chatWidget.chatWrapper.down(".chat-ad");C.setStyle({zIndex:"inherit"});var A=C.down(".ad-close");if(A){Event.observe(A,"click",this._closeAd.bindAsEventListener(this))}var B=C.down(".ad-close-all");if(B){Event.observe(B,"click",this._onCloseAllClick.bindAsEventListener(this))}this.closeTimer=setTimeout(this._closeAd.bind(this),this.adImpression.durationSeconds*1000)},_clearCloseTimer:function(){if(this.closeTimer){clearTimeout(this.closeTimer);this.closeTimer=null}},_closeAd:function(){this._clearCloseTimer();if(this.iframeClickInterval){clearInterval(this.iframeClickInterval);this.iframeClickInterval=null}this.chatWidget.chatWrapper.down(".chat-ad").remove();this._animateSlot(false,true)},_onCloseAllClick:function(C){var B=new ConfirmationPopup();B.setChatApp(this.chatApp);B.setTitle("Disable Ads?");B.setOkButtonValue(null);B.setCancelButtonValue("No Thanks");var A="<div style='width:170px;font-size:0.95em;'><div style='padding:5px 0;'><div><img class='pro-badge-icon pro-badge-icon-100' style='vertical-align:middle;' src='/t.gif'><span style='font-weight:bold;vertical-align:middle;padding-left:7px;'>Blue Pro &ndash; 200 Credits</span></div><div class='padding-10'></div><div>This Chatroll is ad-supported.<br/>The Blue Pro upgrade gives you ad-free access and unlocks Pro-only features.</div><div class='padding-10'></div><div style='font-size:0.9em;color:#888;'><a style='font-size:1.4em;font-weight:bold;text-decoration:underline;' href='javascript:void(0)' target='_blank'>Upgrade Now! &raquo;</a></div><div style='font-size:0.9em;color:#888;'>30-day trial available.</div></div>";B.setMessage(A);B.show()},_onChatAd:function(A){var K=this.chatWidget.chatWrapper;var B=this.chatWidget.messagesContainer;var E=B.positionedOffset();var G=K.getHeight()-E.top-B.getHeight()+4;var J=E.left+3;var L=B.getWidth()-22;var F=(A.contentWidth!=null)?(A.contentWidth+"px"):"100%";var I=(A.contentHeight!=null)?(A.contentHeight+"px"):"auto";var D=new Template(A.content);var H=D.evaluate({sessionId:dwr.engine._sessionId,fblikeWidth:(L-16)});K.insert("<div class='chat-ad' style='display:block;position:absolute;z-index:-100;bottom:"+G+"px;left:"+J+"px;width:"+L+"px;'><div style='width:"+F+"px;height:"+I+";margin:0 auto;'>"+H+"</div></div>");var C=this.chatWidget.chatWrapper.down(".chat-ad");var N=function(){var R=C.down(".fblike-container");if(R){var P=R.down("iframe");if(P!=null){var Q=P.getStyle("height");R.setStyle({height:Q})}}var O=C.down(".tweet-container");if(O){this.conversionTracked=false;Event.observe(O,"mouseover",function(){if(!this.conversionTracked){this.conversionTracked=true;ServiceInterface.trackConversion(this.adImpression.impressionId)}}.bind(this))}this.slotHeight=C.getHeight()+6;this.adImpression=A;this._animateSlot(true,true)}.bind(this);var M=C.down(".fblike-container");if(M){if(!this.fbLikeSubscribed){FB.Event.subscribe("edge.create",this._onFacebookLike.bind(this));this.fbLikeSubscribed=true}FB.XFBML.parse(M,function(){setTimeout(N,100)})}else{setTimeout(N,0)}},_onFacebookLike:function(B){this._clearCloseTimer();var C=this.chatWidget.chatWrapper.down(".chat-ad");C.insert('<div style="position:absolute;top:6px;right:10px;"><a class="ad-close" style="font-size:0.9em;font-weight:bold;text-decoration:underline;cursor:pointer;">close</a></div>');var A=C.down(".ad-close");if(A){Event.observe(A,"click",this._closeAd.bindAsEventListener(this))}ServiceInterface.trackConversion(this.adImpression.impressionId)}};var StickyMessage=Class.create();StickyMessage.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A},setGroupChatWidget:function(A){this.groupChatWidget=A},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.chatApp.messageBus.addConnectSuccessListener(function(){this._setStickyMessage(this.group.stickyMessageHtmlWbr)}.bind(this));this.group.stickyMessageUpdateEvent.observe(function(B){this._setStickyMessage(B)}.bind(this))},_setStickyMessage:function(A){if(A==""){this.groupChatWidget.setStickyPadding(0);this.frame.hide()}else{this.frame.innerHTML=A;this.frame.show();this.groupChatWidget.setStickyPadding(this.frame.getHeight())}}};var MessageTile=Class.create();MessageTile.TYPE_CHAT=1;MessageTile.TYPE_COMMENT=2;MessageTile.TYPE_ITEM=3;MessageTile.prototype={initialize:function(){this.chatApp=null;this.group=null;this.message=null;this.frame=null;this.deleteButton=null;this.groupItemTiles=null},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A},initializeFromElement:function(element){this.frame=element;this.message={messageId:$w(this.frame.className)[1],userId:$w(this.frame.className)[2],type:$w(this.frame.className)[3]};var timestamp=this.frame.down(".message-timestamp");var localTime=Date.parseGMT(timestamp.innerHTML);timestamp.innerHTML=localTime.getDateString()+", "+localTime.getHourMinuteString();var initialItems=this.frame.select(".group-item-small");initialItems.each(function(itemElement){var objString=itemElement.down(".item-jsobj").innerHTML.unescapeHTML();var groupItem=(function(){return eval(objString)})();this.onGroupItem(groupItem)}.bind(this));this._registerPopupButtons();this._updateDeleteButton();this._updateCrossPostButton()},initializeFromMessage:function(C){this.message=C;var D=C.createdTime.getDateString()+", "+C.createdTime.getHourMinuteString();var A=null;if(C.type==MessageTile.TYPE_CHAT){A=this.chatApp.templateManager.evaluate("message:chat-message-tile",{message:this.message,timestamp:D})}else{if(C.type==MessageTile.TYPE_ITEM){A=this.chatApp.templateManager.evaluate("message:new-item-tile",{message:this.message,timestamp:D})}else{if(C.type==MessageTile.TYPE_COMMENT){this.message.textHtml=C.comment.textHtml;A=this.chatApp.templateManager.evaluate("message:comment-post-tile",{message:this.message,timestamp:D})}}}var B=new Element("div");B.innerHTML=A;this.frame=B.down(".message");this._registerPopupButtons();this._updateDisplay();if(C.type==MessageTile.TYPE_ITEM){this.onGroupItem(C.groupItems[0])}else{if(C.type==MessageTile.TYPE_COMMENT){this.onGroupItem(C.comment.groupItem)}}},_updateDisplay:function(){var F=this.frame.down(".message-profile-name");var H=this.frame.down(".message-profile-image");var E=this.chatApp.profileManager.getProfile(this.message.userId);var A=E.guest?" <span class='message-guestmark'>(guest)</span>":"";F.innerHTML=E.getDisplayNameHTML()+A;H.innerHTML=E.getIconImageHTML();var D=this.frame.down(".message-status-icon");if(D!=null){D.remove()}var B=this.group.groupUserStates[this.message.userId];if((B!=null)&&B.products.length>0){var G=B.products[B.products.length-1];var C="<a href='#' onclick='goChatApp.fireGroupUiAction(BluePassOfferPopup.SHOW_POPUP);return false;' class='message-status-icon' title='";C+=G.name;C+="'/>";C+="<img class='pro-badge-icon pro-badge-icon-"+G.productId+"' src='/t.gif'/>";C+="</a>";H.insert({after:C});F.setStyle({paddingLeft:"18px"})}this._updateCrossPostButton();this._updateDeleteButton()},_registerPopupButtons:function(){if(this.message.userId!=this.chatApp.profileManager.currentUserId){var B=this.chatApp.profileManager.getProfile(this.message.userId);var C=this.frame.down(".message-profile-image");var A=this.frame.down(".message-profile-name");Event.observe(A,"click",this._onPopupButtonClick.bindAsEventListener(this));Event.observe(C,"click",this._onPopupButtonClick.bindAsEventListener(this));if(B.guest){A.addClassName("clickable");C.addClassName("clickable")}}},_onPopupButtonClick:function(C){Event.stop(C);var B=this.chatApp.profileManager.getProfile(this.message.userId);var A=new ContactListPopup();A.setChatApp(this.chatApp);A.setGroup(this.group);A.setProfile(B)},_updateCrossPostButton:function(){var A=(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]&&this.group.crossPostGroupId!=null);if(A&&this.crossPostButton==null){this.crossPostButton=this.frame.down(".message-cross-post-button");Event.observe(this.crossPostButton,"click",this._onCrossPostButtonClick.bindAsEventListener(this))}},_updateDeleteButton:function(){var A=(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]||(this.message.userId==this.chatApp.profileManager.currentUserId&&this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_DELETE_OWN_MESSAGES]));if(A&&this.deleteButton==null){this.deleteButton=this.frame.down(".message-delete-button");Event.observe(this.deleteButton,"click",this._onDeleteButtonClick.bindAsEventListener(this));Event.observe(this.frame,"mouseenter",this._onMouseEnter.bindAsEventListener(this));Event.observe(this.frame,"mouseleave",this._onMouseLeave.bindAsEventListener(this))}},onProfileChange:function(A){this._updateDisplay()},onGroupUserStateUpdate:function(A){this._updateDisplay()},onGroupItem:function(B){if(this.groupItemTiles==null){this.groupItemTiles=new Hash()}if(this.groupItemsContainer==null){this.groupItemsContainer=this.frame.down(".message-group-items")}if(this.groupItemTiles.get(B.item.itemId)==null){var A=GroupItemTile.create(B.item.itemType,this.groupItemsContainer,GroupItemTile.SIZE_SMALL);A.setChatApp(this.chatApp);A.setGroup(this.group);A.setGroupItem(B);this.groupItemTiles.set(B.item.itemId,A)}},destroy:function(){if(this.groupItemTiles!=null){this.groupItemTiles.values().each(function(A){A.destroy()}.bind(this));this.groupItemTiles=null}this.frame.remove();this.frame=null},_onDeleteButtonClick:function(){this.frame.addClassName("delete-highlight");var A=this.chatApp.profileManager.getProfile(this.message.userId);var B=new DeleteMessagePopup();B.setChatApp(this.chatApp);B.setWidth(180);B.setTitle(_("Delete message?"));B.setMessage(_("This message will be permanently removed!"));B.setOnOkCallback(function(E,D){var C=this.message.messageId;if(E){C=0}ServiceInterface.deleteMessages(this.group.groupId,this.message.userId,C);if(D){ServiceInterface.banUser(this.group.groupId,this.message.userId)}}.bind(this));B.setOnCancelCallback(function(){this.frame.removeClassName("delete-highlight")}.bind(this));B.setGroup(this.group);B.setProfile(A);B.show()},_onCrossPostButtonClick:function(){ServiceInterface.crossPost(this.group.groupId,this.message.messageId)},_onMouseEnter:function(){this.deleteButton.show();if(this.crossPostButton){this.crossPostButton.show()}},_onMouseLeave:function(){this.deleteButton.hide();if(this.crossPostButton){this.crossPostButton.hide()}}};var DeleteMessagePopup=Class.create(ConfirmationPopup,{setGroup:function(A){this.group=A},setProfile:function(A){this.profile=A;if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]){this.message+="<div style='margin: 5px 0; font-size:0.85em; text-align:left; position:relative;'>	<input class='delete-all-checkbox' type='checkbox' value='enabled' />"+_("Delete all messages from")+" "+A.displayNameHtml+"<br/><input class='ban-user-checkbox' type='checkbox' value='enabled' />"+_("Block")+" "+A.displayNameHtml+"</div>"}},_onOkButtonClick:function(){var C=false;var B=false;if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]){var A=this.chatApp.tooltipManager.activeTooltip;C=$F(A.down(".delete-all-checkbox"))=="enabled";B=$F(A.down(".ban-user-checkbox"))=="enabled"}if(this.onOkCallback!=null){this.onOkCallback(C,B)}this.destroy()}});var ContactList=Class.create();ContactList.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A;this.items=new Hash();this.viewerItem=new ViewerContactListItem();this.onUserJoinListener=this._onUserJoin.bindAsEventListener(this);this.onUserLeaveListener=this._onUserLeave.bindAsEventListener(this);this.onProfileChangeListener=this._onProfileChange.bindAsEventListener(this);this.onGroupUserStateUpdateAnyListener=this._onGroupUserStateUpdateAny.bindAsEventListener(this)},setChatApp:function(A){this.chatApp=A},setGroup:function(C){this.group=C;this.viewerItem.setChatApp(this.chatApp);this.frame.insert({bottom:this.viewerItem.frame});var A=this.group.initialContactListProfiles;for(var B=0,D=A.length;B<D;++B){this.chatApp.profileManager.setProfile(A[B]);this._onUserJoin(this.chatApp.profileManager.getProfile(A[B].userId))}this.viewerItem.setViewerCount(this.group.onlineCount-this.items.size());this.group.onlineCountChangeEvent.observe(this._onOnlineCountChange.bindAsEventListener(this));this.group.addUserJoinListener(this.onUserJoinListener);this.group.addUserLeaveListener(this.onUserLeaveListener);this.group.addGroupUserStateUpdateAnyListener(this.onGroupUserStateUpdateAnyListener)},destroy:function(){this.group.removeGroupUserStateUpdateAnyListener(this.onGroupUserStateUpdateAnyListener);this.group.removeUserJoinListener(this.onUserJoinListener);this.group.removeUserLeaveListener(this.onUserLeaveListener)},_onOnlineCountChange:function(){this.viewerItem.setViewerCount(this.group.onlineCount-this.items.size())},_onUserJoin:function(A){if(!this._isViewer(A)){this._addItem(A)}this.chatApp.profileManager.addProfileChangeListener(A.userId,this.onProfileChangeListener)},_onUserLeave:function(A){if(this.items.get(A)){this._removeItem(A);this.viewerItem.setViewerCount(this.group.onlineCount-this.items.size())}this.chatApp.profileManager.removeProfileChangeListener(A,this.onProfileChangeListener)},_onProfileChange:function(A){if(this.items.get(A.userId)){this._updateItemPosition(A)}else{if(!this._isViewer(A)){this._addItem(A);this.viewerItem.setViewerCount(this.group.onlineCount-this.items.size())}}},_onGroupUserStateUpdateAny:function(B){if(this.items.get(B.userId)){var A=this.chatApp.profileManager.getProfile(B.userId);this._updateItemPosition(A)}},_isViewer:function(A){return A.guest&&(A.displayName=="")&&A.userId!=this.chatApp.profileManager.currentUserId},_addItem:function(A){if(!this.items.get(A.userId)){var B=new ContactListItem();B.setChatApp(this.chatApp);B.setGroup(this.group);B.setProfile(A);this.items.set(A.userId,B);this._updateItemPosition(A)}else{logger.warn("_addItem: Attempted to re-add contact list item for user "+A.userId)}},_removeItem:function(A){var B=this.items.get(A);if(B){B.destroy();B=null;this.items.unset(A)}else{logger.error("_removeItem: Attempted to remove non-existing contact list item for user "+A)}},_updateItemPosition:function(D){var H=this.items.get(D.userId);if(H){var F=false;var A=this.frame.select(".contact-list-item");var C=A.length;var B=this.chatApp.profileManager.getCurrentProfile().userId;for(var G=0;G<C;G++){var E=$w(A[G].className)[1];var I=this.items.get(E);if(I==null){I=this.viewerItem}if(this._compareItemsForSort(B,H,I)>0){I.frame.insert({before:H.frame});F=true;break}}if(!F){this.frame.insert({bottom:H.frame})}}else{logger.error("_updateItemPosition: Attempted to update position for non-existing contact list item for user "+userId)}},_compareItemsForSort:function(D,L,B){var E=L.profile;var K=B.profile;if(K==null){return 1}var G=0;var F=0;var C=null;C=this.group.groupUserStates[E.userId];if((C!=null)&&C.products.length>0){var J=C.products[C.products.length-1];G=J.productId}C=this.group.groupUserStates[K.userId];if((C!=null)&&C.products.length>0){var H=C.products[C.products.length-1];F=H.productId}if(G>F){return 1}else{if(F>G){return -1}}var I=0;if(!E.guest){I=2}else{if(E.displayName!=""){I=1}}var A=0;if(!K.guest){A=2}else{if(K.displayName!=""){A=1}}if(I>A){return 1}else{if(A>I){return -1}}if(E.userId==D){return 1}else{if(K.userId==D){return -1}}return 0}};var ContactListItem=Class.create();ContactListItem.prototype={initialize:function(){this.chatApp=null;this.group=null;this.profile=null;this.onProfileChangeListener=this._onProfileChange.bindAsEventListener(this);this.onGroupUserStateUpdateListener=this._onGroupUserStateUpdate.bindAsEventListener(this)},setChatApp:function(A){this.chatApp=A;this.frame=new Element("div");this.frame.addClassName("contact-list-item")},setGroup:function(A){this.group=A},setProfile:function(A){this.profile=A;this.frame.addClassName(A.userId);this._updateDisplay();this.chatApp.profileManager.addProfileChangeListener(this.profile.userId,this.onProfileChangeListener);this.group.addGroupUserStateUpdateListener(this.profile.userId,this.onGroupUserStateUpdateListener)},destroy:function(){if(this.chatApp!=null){this.group.removeGroupUserStateUpdateListener(this.profile.userId,this.onGroupUserStateUpdateListener);this.chatApp.profileManager.removeProfileChangeListener(this.profile.userId,this.onProfileChangeListener)}this.frame.remove();this.frame=null},_onProfileChange:function(A){this.profile=A;this._updateDisplay()},_onGroupUserStateUpdate:function(A){this._updateDisplay()},_updateDisplay:function(){var B=this.group.groupUserStates[this.profile.userId];var A="";if(B){if(B.permissions[GroupPermission.PERMISSION_ADMIN]){A="contact-list-profile-name-admin"}else{if(B.permissions[GroupPermission.PERMISSION_MODERATE]){A="contact-list-profile-name-moderate"}}}this.frame.innerHTML=this.chatApp.templateManager.evaluate("profile:contact-list-item",{profile:this.profile,displayNameHTML:this.profile.getDisplayNameHTML(),tinyImageHTML:this.profile.getTinyImageHTML(),contactListNameClass:A});if((B!=null)&&B.products.length>0){var F=B.products[B.products.length-1];var D="<a target='_blank' href='#' onclick='goChatApp.fireGroupUiAction(BluePassOfferPopup.SHOW_POPUP);return false;' class='contact-list-product-icon' title='";D+=F.name;D+="'/>";D+="<img class='pro-badge-icon pro-badge-icon-"+F.productId+"' src='/t.gif'/>";D+="</a>";this.frame.down(".contact-list-status-icon").insert({after:D});this.frame.down(".contact-list-profile-name").setStyle({marginLeft:"37px"})}if(this.profile.userId!=this.chatApp.profileManager.currentUserId){var C=this.frame.down(".contact-list-status-icon");var E=this.frame.down(".contact-list-profile-name");var G=this.frame.down(".contact-list-profile-image");Event.observe(C,"click",this._onPopupButtonClick.bindAsEventListener(this));Event.observe(E,"click",this._onPopupButtonClick.bindAsEventListener(this));Event.observe(G,"click",this._onPopupButtonClick.bindAsEventListener(this));C.down(".status-icon").addClassName("clickable");if(this.profile.guest){E.addClassName("clickable");G.addClassName("clickable")}}},_onPopupButtonClick:function(B){Event.stop(B);var A=new ContactListPopup();A.setChatApp(this.chatApp);A.setGroup(this.group);A.setProfile(this.profile)}};var ViewerContactListItem=Class.create();ViewerContactListItem.prototype={initialize:function(){this.chatApp=null},setChatApp:function(C){this.chatApp=C;this.frame=new Element("div");this.frame.addClassName("contact-list-item");var A={status:1,displayStatus:_("Online")};var B="<img src='"+this.chatApp.clientConfig.baseImagesUrl+"/images/D/E/F/DEFAULTUSER-resize_20x20.jpg'/>";this.frame.innerHTML=this.chatApp.templateManager.evaluate("profile:contact-list-item",{profile:A,displayNameHTML:"",tinyImageHTML:B});this.frame.hide();this.profileName=this.frame.down(".contact-list-profile-name")},destroy:function(){this.frame.remove();this.frame=null},setViewerCount:function(A){if(A>0){var B=(A>1)?_("viewers"):_("viewer");this.profileName.innerHTML="<span style='font-weight:normal;font-size:0.9em;color:#008800;'>"+A+" "+B+"</span>";this.frame.show()}else{this.frame.hide()}}};var ContactListPopup=Class.create();ContactListPopup.prototype={initialize:function(){this.chatApp=null;this.group=null;this.profile=null;this.wrapper=null;this.moderatorControl=null;this.privateMessageControlShowButton=null;this.status=null},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A},setProfile:function(A){this.profile=A;this._showPopup()},destroy:function(){},_showPopup:function(){var C=$(document.body).down(".group-chat-container");if(C==null){C=$(document.body).down(".group-chat-embedded")}var A=C.down(".chat-messages-container");var B=this.chatApp.templateManager.evaluate("profile:contact-list-popup",{_:_,profile:this.profile,displayName:this.profile.displayName,displayNameHTML:this.profile.getDisplayNameHTML(),iconImageHTML:this.profile.getIconImageHTML()});this.wrapper=this.chatApp.tooltipManager.showTooltip({html:B,relativeElement:A,left:"center",top:"center"});this.status=this.wrapper.down(".status");this.moderatorControl=this.wrapper.down(".moderator-control");Event.observe(this.wrapper.down(".popup-close-button"),"click",this._closePopup.bindAsEventListener(this));if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_SEND_PM]){this.privateMessageControlShowButton=this.wrapper.down(".pm-show-button");this.privateMessageControlShowButton.show();Event.observe(this.privateMessageControlShowButton,"click",this._onPrivateMessageControlShowButtonClick.bindAsEventListener(this))}if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]){Event.observe(this.wrapper.down(".delete-button"),"click",this._onDeleteButtonClick.bindAsEventListener(this));Event.observe(this.wrapper.down(".ban-button"),"click",this._onBanButtonClick.bindAsEventListener(this));this.moderatorControl.show()}},_onPrivateMessageControlShowButtonClick:function(){if(this.chatApp.profileManager.getCurrentProfile().displayName==""){this.status.innerHTML="<span class='form-error'>You must <a target='_blank' href='/signin'>Sign in</a> first!</span>"}else{this.status.innerHTML="";this.group.onPrivateMessageSend(this.profile.userId)}},_onDeleteButtonClick:function(){ServiceInterface.deleteMessages(this.group.groupId,this.profile.userId,0,{callback:this._onDeleteSuccess.bind(this),errorHandler:this._onDeleteError.bind(this)})},_onDeleteSuccess:function(){this.status.innerHTML="<span class='form-success'>Messages deleted.</span>"},_onDeleteError:function(){this.status.innerHTML="<span class='form-error'>Error deleting messages. Please contact support.</span>"},_onBanButtonClick:function(){ServiceInterface.banUser(this.group.groupId,this.profile.userId,{callback:this._onBanSuccess.bind(this),errorHandler:this._onBanError.bind(this)})},_onBanSuccess:function(){this.status.innerHTML="<span class='form-success'>User blocked.</span>"},_onBanError:function(){this.status.innerHTML="<span class='form-error'>Block failed. Please contact support@chatroll.com.</span>"},_closePopup:function(){this.chatApp.tooltipManager.hideTooltips();delete this}};var GroupItemTile=Class.create();GroupItemTile.SIZE_LARGE=1;GroupItemTile.SIZE_SMALL=2;GroupItemTile.create=function(D,B,C){var A;switch(D){case GroupItem.TYPE_BOOKMARK:A=new BookmarkGroupItemTile(B,C);break;case GroupItem.TYPE_IMAGE:A=new ImageGroupItemTile(B,C);break;case GroupItem.TYPE_VIDEO_YOUTUBE:case GroupItem.TYPE_VIDEO_BREAK:A=new VideoGroupItemTile(B,C);break;case GroupItem.TYPE_DISCUSSION:A=new DiscussionGroupItemTile(B,C);break}return A};GroupItemTile.prototype={initialize:function(A,B){this.parentElement=A;this.tileSize=B;this.groupItem=null;this.chatApp=null;this.group=null;this.deleteButton=null;this.frame=null;this.onGroupItemUpdateListener=this._onGroupItemUpdate.bindAsEventListener(this)},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.group.addGroupItemUpdateListener(this.onGroupItemUpdateListener)},setGroupItem:function(A){this.groupItem=A;this._renderTile()},destroy:function(){this.group.removeGroupItemUpdateListener(this.onGroupItemUpdateListener);this.group=null;this.frame.remove();this.frame=null},_renderTile:function(){var C=false;this.frame=this.parentElement.down("."+this.groupItem.item.itemId);if(this.frame==null){C=true;var A=Object.toJSON(this.groupItem).evalJSON();A.item.imageUrl=this.chatApp.clientConfig.baseImagesUrl+A.item.imageUrl;if(this.tileSize==GroupItemTile.SIZE_LARGE){var B=this.chatApp.templateManager.evaluate(this.largeTileTemplateId,A);this.parentElement.insert({top:B})}else{var B=this.chatApp.templateManager.evaluate(this.smallTileTemplateId,A);this.parentElement.insert({bottom:B})}this.frame=this.parentElement.down("."+this.groupItem.item.itemId)}this.image=this.frame.down(".item-image");if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_MODERATE]){this._enableDeleteButton()}return C},_onGroupItemUpdate:function(A){if(A.item.itemId==this.groupItem.item.itemId){this.image.src=this.chatApp.clientConfig.baseImagesUrl+this.groupItem.item.imageUrl}},_enableDeleteButton:function(){this.deleteButton=this.frame.down(".group-item-delete-button");if(this.deleteButton!=null){Event.observe(this.deleteButton,"click",this._onDeleteButtonClick.bindAsEventListener(this));Event.observe(this.frame,"mouseenter",this._onMouseEnter.bindAsEventListener(this));Event.observe(this.frame,"mouseleave",this._onMouseLeave.bindAsEventListener(this))}},_onDeleteButtonClick:function(){this.frame.addClassName("delete-highlight");var A=new ConfirmationPopup();A.setChatApp(this.chatApp);A.setTitle("Delete item?");A.setMessage("This item will be removed!");A.setOnOkCallback(function(){ServiceInterface.deleteGroupItem(this.groupItem.groupId,this.groupItem.item.itemId)}.bind(this));A.setOnCancelCallback(function(){this.frame.removeClassName("delete-highlight")}.bind(this));A.show()},_onMouseEnter:function(){this.deleteButton.show()},_onMouseLeave:function(){this.deleteButton.hide()}};var BookmarkGroupItemTile=Class.create(GroupItemTile,{});BookmarkGroupItemTile.prototype.largeTileTemplateId="group-item:bookmark-tile";BookmarkGroupItemTile.prototype.smallTileTemplateId="group-item:bookmark-tile-small";var ImageGroupItemTile=Class.create(GroupItemTile,{});ImageGroupItemTile.prototype.largeTileTemplateId="group-item:image-tile";ImageGroupItemTile.prototype.smallTileTemplateId="group-item:image-tile-small";var VideoGroupItemTile=Class.create(GroupItemTile,{});VideoGroupItemTile.prototype.largeTileTemplateId="group-item:video-tile";VideoGroupItemTile.prototype.smallTileTemplateId="group-item:video-tile-small";var DiscussionGroupItemTile=Class.create(GroupItemTile,{_renderTile:function($super){var E=$super();if(E){var D=this.chatApp.profileManager.getProfile(this.groupItem.userId);if(this.tileSize==GroupItemTile.SIZE_LARGE){var F=this.frame.down(".group-item-profile");D.prepareForTemplateEval();F.innerHTML=this.chatApp.templateManager.evaluate("profile:small-tile",D)}else{var C=this.frame.down(".profile-icon-image-border");C.innerHTML=D.getIconImageHTML();var B=this.frame.down(".group-item-group-link");var A=this.chatApp.clientConfig.baseWebUrl+"/"+this.group.url;B.href=A}}}});DiscussionGroupItemTile.prototype.largeTileTemplateId="group-item:discussion-tile";DiscussionGroupItemTile.prototype.smallTileTemplateId="group-item:discussion-tile-small";var BluePassOfferPopup=Class.create();BluePassOfferPopup.SHOW_POPUP="showBluePassOfferPopup";BluePassOfferPopup.prototype={initialize:function(){this.chatApp=null;this.group=null},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.group.addUiActionListener(BluePassOfferPopup.SHOW_POPUP,this._onShowPopup.bindAsEventListener(this))},_onShowPopup:function(){var A=false;var C=this.group.groupUserStates[this.chatApp.profileManager.currentUserId];if((C!=null)&&C.products.length>0){var D=C.products[C.products.length-1];if(D.productId==100){A=true}}if(!A){var E=new ConfirmationPopup();E.setChatApp(this.chatApp);E.setTitle("Purchase Blue Pass");E.setOkButtonValue("Get it");E.setCancelButtonValue("No Thanks");var B="<div style='width:190px;'><div><img class='pro-badge-icon pro-badge-icon-100' style='vertical-align:middle;' src='/t.gif'><span style='font-weight:bold;vertical-align:middle;padding-left:7px;'>Blue Pass &ndash; "+200+" Credits</span></div><div style='padding-top:8px;'>Blue Pass lets you send unlimited private messages for 30 days.</div></div>";E.setMessage(B);E.setOnOkCallback(function(){var F=this.chatApp.tooltipManager.activeTooltip;ServiceInterface.purchaseBluePass(this.chatApp.clientConfig.groupId,{callback:this._onBluePassPurchaseSuccess.bind(this),errorHandler:this._onBluePassPurchaseError.bind(this)})}.bind(this));E.show()}},_onBluePassPurchaseSuccess:function(){},_onBluePassPurchaseError:function(){var B=new ConfirmationPopup();B.setChatApp(this.chatApp);B.setTitle("Insufficient Credit");B.setOkButtonValue(null);B.setCancelButtonValue(null);var A="<div style='width:190px;'>You need <b>"+200+" Credits</b> to<br/>buy a Blue Pass.<div style='padding-top:8px;font-size:1.1em;font-weight:bold;'><a style='text-decoration:underline;' href='/store/getcredits?offerId=1' target='_blank'>Get Chatroll Credits Now &raquo;</a></div></div>";B.setMessage(A);B.show()}};var PrivateMessagePopup=Class.create();PrivateMessagePopup.prototype={initialize:function(){this.chatApp=null;this.group=null;this.privateMessageEventQueue=new Array();this.isPopupShowing=false},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.group.addPrivateMessageActionListener(this._onPrivateMessageAction.bindAsEventListener(this))},_onPrivateMessageAction:function(A){if(!this.isPopupShowing){this.isPopupShowing=true;this._show(A)}else{this.privateMessageEventQueue.push(A)}},_show:function(E){var F=null;var D=null;var B=null;var C=this.chatApp.profileManager.getProfile(E.userId);if(E.action=="send"){F="Private Message to "+C.displayName;B="Send a private message"}else{F="Private Message from "+C.displayName;D=E.message;B="Send a reply"}var A=this.chatApp.templateManager.evaluate("group:private-message-popup",{title:F,displayNameHTML:C.getDisplayNameHTML(),iconImageHTML:C.getIconImageHTML(),message:D,actionLabel:B});var G=this.chatApp.tooltipManager.showTooltip({html:A,relativeElement:null,left:"center",top:"center",onHideCallback:this._onHideCallback.bind(this)});this.status=G.down(".status");this.privateMessageInput=G.down(".pm-input");Event.observe(G.down(".pm-send-button"),"click",this._onSendButtonClick.bindAsEventListener(this,E.userId));Event.observe(G.down(".pm-cancel-button"),"click",this._onCancelButtonClick.bindAsEventListener(this));Event.observe(G.down(".popup-close-button"),"click",this._onCancelButtonClick.bindAsEventListener(this));Event.observe(this.privateMessageInput,"keydown",this._onInputKeydown.bindAsEventListener(this,E.userId));if(E.action=="received"){G.down(".pm-message").show()}if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_SEND_PM]){if(this.group.groupUserStates[this.chatApp.profileManager.currentUserId].features[Feature.GROUP_USER_FEATURE_FREE_PM]){G.down(".pm-price-label").hide()}this.privateMessageInput.focus()}else{G.down(".pm-reply").hide()}},_onInputKeydown:function(B,A){if(B.keyCode==Event.KEY_RETURN||B.keyCode==10){this._sendPrivateMessage(A)}},_onSendButtonClick:function(A,B){this._sendPrivateMessage(B)},_sendPrivateMessage:function(B){var C=$F(this.privateMessageInput);C=C.strip();if(C!=""){var A=10;ServiceInterface.purchaseGift(B,A,this.group.groupId,C,{callback:this._onSendSuccess.bind(this),errorHandler:this._onSendError.bind(this,A)})}else{this.status.innerHTML="<span class='form-error'>Message cannot be empty.</span>"}},_onSendSuccess:function(){this.status.innerHTML="<span class='form-success'>Message sent.</span>";this.privateMessageInput.clear();setTimeout(function(){this._onCancelButtonClick()}.bind(this),250)},_onSendError:function(A,C,B){if(B.javaClassName=="com.chatroll.service.account.InsufficientCreditException"){this.status.innerHTML="<span class='form-error'>You need 5 Credits to send a message!</span><div style='font-size:1.1em;padding-top:2px;'><a target='_blank' style='text-decoration:underline;' href='/store/getcredits'><b>Get Credits &raquo;</b></a></div>"}else{this.status.innerHTML="<span class='form-error'>Error. Please contact support@chatroll.com</span>"}},_onCancelButtonClick:function(){this.chatApp.tooltipManager.hideTooltips()},_onHideCallback:function(){this.isPopupShowing=false;if(this.privateMessageEventQueue.length>0){setTimeout(function(){var A=this.privateMessageEventQueue.shift();this._onPrivateMessageAction(A)}.bind(this),0)}}};var ApprovalQueue=Class.create();ApprovalQueue.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A;this.messageTiles=new Hash();this.loading=false;this.loaded=false;this.lastMessageId=0;this.numTiles=0;this.maxTiles=40},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;Event.observe(this.frame.down(".approve-all-button"),"click",function(){ServiceInterface.approveAllMessages(this.group.groupId)}.bind(this));Event.observe(this.frame.down(".skip-all-button"),"click",function(){ServiceInterface.skipAllMessages(this.group.groupId)}.bind(this));this._loadApprovalQueue();this.group.approvalQueueEvent.observe(this._onApprovalQueueEvent.bindAsEventListener(this))},_loadApprovalQueue:function(){if(!this.loading){this.loading=true;ServiceInterface.getApprovalQueueSection(this.group.groupId,this.lastMessageId+1,{callback:function(A){if(A.length>0){this.lastMessageId=A[0].messageId-1;A.each(function(B){this._insertMessage(B,true)}.bind(this))}this.loading=false;this.loaded=true}.bind(this),errorHandler:function(){alert("Error loading approval queue. Please notify support@chatroll.com")}})}},_onApprovalQueueEvent:function(B){if(B.name=="add"){if(this.loaded&&!this.loading){this._insertMessage(B.message,false)}}else{if(B.name=="approve"||B.name=="skip"){var C=this.numTiles;var D=function(E,G){var F=this.messageTiles.get(E);if(F!=null){this.messageTiles.unset(E);this.numTiles--;F.destroy(G,function(){if(this.numTiles==0){this.frame.down(".empty-indicator").show()}}.bind(this))}}.bind(this);if(B.messageId!=0){D(B.messageId,B.name)}else{var A=this.messageTiles.keys();A.each(function(E){D(E,B.name)}.bind(this))}if(C>=this.maxTiles&&this.numTiles<this.maxTiles){this._loadApprovalQueue()}}else{if(B.name=="disable"){window.location.reload()}}}},_insertMessage:function(B,C){if(this.numTiles<this.maxTiles||C){if(!C&&this.lastMessageId!=0&&B.messageId!=(this.lastMessageId+1)){this._loadApprovalQueue()}else{var A=new ApprovalMessageTile();A.setChatApp(this.chatApp);A.setGroup(this.group);A.setMessage(B);this.messageTiles.set(B.messageId,A);this.numTiles++;this.frame.down(".approval-tiles").insert(A.frame);this.frame.down(".empty-indicator").hide();this.lastMessageId=B.messageId}}}};var ApprovalMessageTile=Class.create();ApprovalMessageTile.prototype={initialize:function(){this.chatApp=null;this.group=null;this.message=null;this.frame=null;this.approveButton=null;this.skipButton=null},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A},setMessage:function(F){this.message=F;var G=F.createdTime.getDateString()+", "+F.createdTime.getHourMinuteString();var A=this.chatApp.templateManager.evaluate("group:approval-message-tile",{message:this.message,timestamp:G});var C=new Element("div");C.innerHTML=A;this.frame=C.down(".approval-message-tile");this.chatApp.profileManager.setProfile(F.profile);var E=this.frame.down(".message-profile-name");var H=this.frame.down(".message-profile-image");var D=this.chatApp.profileManager.getProfile(F.userId);var B=D.guest?" <span class='message-guestmark'>(guest)</span>":"";E.innerHTML=D.getDisplayNameHTML()+B;H.innerHTML=D.getIconImageHTML();Event.observe(this.frame.down(".message-approve-button"),"click",function(){this.frame.addClassName("approve-highlight");ServiceInterface.approveMessage(this.group.groupId,this.message.messageId)}.bind(this));Event.observe(this.frame.down(".message-skip-button"),"click",function(){this.frame.addClassName("delete-highlight");ServiceInterface.skipMessage(this.group.groupId,this.message.messageId)}.bind(this))},destroy:function(A,B){if(A=="approve"){this.frame.addClassName("approve-highlight")}else{this.frame.addClassName("delete-highlight")}this.frame.down(".message-approve-button").hide();this.frame.down(".message-skip-button").hide();Effect.Fade(this.frame,{duration:1,afterFinish:function(){this.frame.remove();this.frame=null;B()}.bind(this)})}};var GroupChatWidget=Class.create();GroupChatWidget.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A;this.inputLengthLimit=512;this.sendCancelled=false;this.sending=false;this.approvalRequired=false;this.sendTime=0;this.sendDelay=0;this.autoScroll=true;this.autoScrollingTimer=null;this.lastAutoScrollTop=0;this.userScrollElement=null;this.userScrollElementOffset=0;this.contactListPosition="right";this.contactListTopVisible=false;this.messageTiles=new Hash();this.userMessageCounts=new Hash();this.limitMessages=true;this.chatWrapper=this.frame.down(".chat-wrapper");this.title=this.frame.down(".chat-name");this.onlineCountDiv=this.frame.down(".chat-online-count");this.onlineCountDisplayed=0;this.onlineCountDiv.innerHTML.scan(/[0-9]+/,function(B){this.onlineCountDisplayed=parseInt(B)}.bind(this));this.contactsShowButton=this.frame.down(".chat-contacts-show-button");this.messagesContainer=this.frame.down(".chat-messages-container");this.messages=this.frame.down(".chat-messages");this.loadingHistory=false;this.inputWrapper=this.frame.down(".chat-input-wrapper");this.input=this.frame.down(".chat-input");this.signinBoxContainer=this.frame.down(".chat-signin-box");this.signinBox=new SigninBox(this.signinBoxContainer.down(".signin-box"));this.signinRequired=false;this.signoutButton=this.frame.down(".chat-signout-button");if(this.signoutButton!=null){Event.observe(this.signoutButton,"click",function(C){var B=new ConfirmationPopup();B.setChatApp(this.chatApp);B.setContainer(this.frame);B.setTitle(_("Sign out"));B.setOkButtonValue(_("Ok"));B.setCancelButtonValue(_("Cancel"));B.setMessage("<div style='width:160px;'>"+_("Sign out now?")+"</div>");B.setOnOkCallback(function(){this.chatApp.resetClientEnabled=false;ServiceInterface.signout(this.chatApp.clientConfig.groupId,{callback:function(){window.location.reload()}.bind(this),errorHandler:function(){}})}.bind(this));B.show()}.bindAsEventListener(this))}this.popoutButton=this.frame.down(".chat-popout-button");if(this.popoutButton!=null){Event.observe(this.popoutButton,"click",this._onPopoutButtonClick.bindAsEventListener(this))}Event.observe(window,"resize",this._onWindowResize.bindAsEventListener(this));Event.observe(this.messagesContainer,"scroll",this._onMessagesScroll.bindAsEventListener(this));Event.observe(this.input,"keydown",this._onInputKeydown.bindAsEventListener(this));Event.observe(this.input,"keyup",this._onInputKeyup.bindAsEventListener(this));Event.observe(this.input,"change",this._onInputChange.bindAsEventListener(this));Event.observe(this.input,"focus",this._onInputFocus.bindAsEventListener(this));Event.observe(this.input,"click",this._onInputClick.bindAsEventListener(this));Event.observe(this.contactsShowButton,"click",this._onContactsShowButtonClick.bindAsEventListener(this));this.onMessageListener=this._onMessage.bindAsEventListener(this);this.onMessageDeleteListener=this._onMessageDelete.bindAsEventListener(this);this.onGroupItemListener=this._onGroupItem.bindAsEventListener(this);this.onCurrentProfileChangeListener=this._onCurrentProfileChange.bindAsEventListener(this);this.onProfileChangeListener=this._onProfileChange.bindAsEventListener(this);this.onGroupUserStateUpdateAnyListener=this._onGroupUserStateUpdateAny.bindAsEventListener(this);this.contactListContainer=this.frame.down(".chat-contacts-container");this.contactList=new ContactList(this.frame.down(".chat-contacts"))},setChatApp:function(A){this.chatApp=A;this.chatApp.profileManager.addCurrentProfileChangeListener(this.onCurrentProfileChangeListener);this.contactList.setChatApp(A);this.signinBox.setChatApp(A);this._updateSigninBox();this._onWindowResize()},setGroup:function(B){this.group=B;this.group.onlineCountChangeEvent.observe(this._onOnlineCountChange.bindAsEventListener(this));this.group.addMessageListener(this.onMessageListener);this.group.addMessageDeleteListener(this.onMessageDeleteListener);this.group.addGroupItemListener(this.onGroupItemListener);this.group.messageSkippedEvent.observe(function(){this.sending=false}.bind(this));this.chatAd=new ChatAd();this.chatAd.setChatApp(this.chatApp);this.chatAd.setGroup(this.group);this.chatAd.setChatWidget(this);this.privateMessagePopup=new PrivateMessagePopup();this.privateMessagePopup.setChatApp(this.chatApp);this.privateMessagePopup.setGroup(this.group);this.bluePassOfferPopup=new BluePassOfferPopup();this.bluePassOfferPopup.setChatApp(this.chatApp);this.bluePassOfferPopup.setGroup(this.group);this.contactList.setGroup(B);this._updateOnlineCount();var A=this.messages.select(".message");A.each(function(C){var D=new MessageTile();D.setChatApp(this.chatApp);D.setGroup(this.group);D.initializeFromElement(C);this._onMessageTileInserted(D)}.bind(this));this.stickyMessage=new StickyMessage(this.frame.down(".chat-sticky-message"));this.stickyMessage.setGroupChatWidget(this);this.stickyMessage.setChatApp(this.chatApp);this.stickyMessage.setGroup(this.group);if(this.frame.down(".chat-history-controls")!=null){Event.observe(this.frame.down(".chat-history-50"),"click",this._onHistoryButtonClick.bindAsEventListener(this,50));Event.observe(this.frame.down(".chat-history-100"),"click",this._onHistoryButtonClick.bindAsEventListener(this,100));Event.observe(this.frame.down(".chat-history-200"),"click",this._onHistoryButtonClick.bindAsEventListener(this,200))}},destroy:function(){this.contactList.destroy();this.contactList=null;this.messageTiles.values().each(function(A){A.destroy()}.bind(this));this.messageTiles=null;this.group.removeMessageListener(this.onMessageListener);this.group.removeMessageDeleteListener(this.onMessageListener);this.chatApp.profileManager.removeProfileChangeListener(null,this.onProfileChangeListener);this.chatApp.profileManager.removeCurrentProfileChangeListener(this.onCurrentProfileChangeListener);this.frame.remove();this.frame=null},setStickyPadding:function(A){if(A!=0){this.messages.setStyle({paddingTop:A+"px"})}else{this.messages.setStyle({paddingTop:null})}this._scrollMessages()},setAdPadding:function(A){if(A!=0){this.messages.setStyle({paddingBottom:A+"px"})}else{this.messages.setStyle({paddingBottom:null})}this._scrollMessages()},_onWindowResize:function(){this._updateContactListPosition();this._scrollMessages()},_updateContactListPosition:function(){var A="right";if(this.chatApp.clientConfig.contactListPosition==Group.CONTACT_LIST_POSITION_AUTO){A=this.frame.getWidth()<350?"top":"right"}else{if(this.chatApp.clientConfig.contactListPosition==Group.CONTACT_LIST_POSITION_TOP){A="top"}}var B="";if(this.chatWrapper.hasClassName("chat-wrapper-chromeless")){B="-chromeless"}if(A!=this.contactListPosition){this.contactListPosition=A;if(A=="top"){this.frame.down(".chat-contacts-container").addClassName("chat-contacts-container-top");this.frame.down(".chat-contacts-divider").addClassName("chat-contacts-divider-top"+B);this.frame.down(".chat-contacts-banner").addClassName("chat-contacts-banner-top"+B);this.frame.down(".chat-messages-container").addClassName("chat-messages-container-top"+B);this.frame.down(".chat-sticky-message").addClassName("chat-sticky-message-top"+B);this.contactsShowButton.show()}else{this._showContactList(false);this.frame.down(".chat-contacts-container").removeClassName("chat-contacts-container-top");this.frame.down(".chat-contacts-divider").removeClassName("chat-contacts-divider-top"+B);this.frame.down(".chat-contacts-banner").removeClassName("chat-contacts-banner-top"+B);this.frame.down(".chat-messages-container").removeClassName("chat-messages-container-top"+B);this.frame.down(".chat-sticky-message").removeClassName("chat-sticky-message-top"+B);this.contactsShowButton.hide()}}},_showContactList:function(A){var B="";if(this.chatWrapper.hasClassName("chat-wrapper-chromeless")){B="-chromeless"}if(A){this.frame.down(".chat-contacts-container").addClassName("chat-contacts-container-top-open"+B);this.frame.down(".chat-contacts-divider").addClassName("chat-contacts-divider-top-open"+B);this.frame.down(".chat-messages-container").addClassName("chat-messages-container-top-open"+B);this.frame.down(".chat-sticky-message").addClassName("chat-sticky-message-top-open"+B);this.contactsShowButton.innerHTML=_("hide all...")}else{this.frame.down(".chat-contacts-container").removeClassName("chat-contacts-container-top-open"+B);this.frame.down(".chat-contacts-divider").removeClassName("chat-contacts-divider-top-open"+B);this.frame.down(".chat-messages-container").removeClassName("chat-messages-container-top-open"+B);this.frame.down(".chat-sticky-message").removeClassName("chat-sticky-message-top-open"+B);this.contactsShowButton.innerHTML=_("show all...")}},_updateOnlineCount:function(){if(this.group.onlineCount!=this.onlineCountDisplayed){var B=this.group.onlineCount+" "+_("online");if(this.group.onlineCount>=this.group.freeLimit-1){var A=this.group.groupUserStates[this.chatApp.profileManager.currentUserId].permissions[GroupPermission.PERMISSION_ADMIN];B+=" <span class='chat-max-online-label'>(";if(A){B+="<a";if(this.chatApp.clientConfig.embedded){B+=" target='_blank'"}B+=" href='"+this.chatApp.clientConfig.baseWebUrl+"/"+this.group.url+"/settings'>"+_("full")+"</a>"}else{B+=_("full")}B+=")</span>"}if(this.group.onlineCount<50){Effect.FadeReplace(this.onlineCountDiv,{duration:0.4,innerHTML:B})}else{this.onlineCountDiv.innerHTML=B}this.onlineCountDisplayed=this.group.onlineCount}},_focus:function(A){if(this.signinBoxContainer.visible()){this.signinBox.focus()}else{this.input.focus()}},_updateSigninBox:function(){if(this.signinBox.isSigninRequired()){this.inputWrapper.hide();this.signinBoxContainer.show();this.signinRequired=true}else{this.signinBoxContainer.hide();this.inputWrapper.show();if(!this.chatApp.clientConfig.embedded&&(this.signinRequired==true)){this._focus()}}},_onOnlineCountChange:function(){this._updateOnlineCount()},_onMessage:function(B){if(B.userId==this.chatApp.profileManager.currentUserId){this.sending=false}var A=new MessageTile();A.setChatApp(this.chatApp);A.setGroup(this.group);A.initializeFromMessage(B);this.messages.insert(A.frame);this._onMessageTileInserted(A);this._scrollMessages()},_onMessageTileInserted:function(F){var B=F.message.messageId;var D=F.message.userId;this.messageTiles.set(B,F);var A=this.userMessageCounts.get(D);if(!A){this.chatApp.profileManager.addProfileChangeListener(D,this.onProfileChangeListener);this.group.addGroupUserStateUpdateAnyListener(this.onGroupUserStateUpdateAnyListener);this.userMessageCounts.set(D,1)}else{this.userMessageCounts.set(D,A+1)}if(this.limitMessages&&this.messageTiles.keys().length>40){var C=this.messages.down(".message");var E=C.previous(".chat-welcome-message");if(E!=null){E.remove()}var B=$w(C.className)[1];var G=this.messageTiles.get(B);this._deleteMessageTile(G)}},_onMessageDelete:function(B){if(B.messageId!=0){var A=this.messageTiles.get(B.messageId);if(A!=null){this._deleteMessageTile(A)}}else{var C=this.messages.select("."+B.userId);C.each(function(E){var D=$w(E.className)[1];var F=this.messageTiles.get(D);this._deleteMessageTile(F)}.bind(this))}this._scrollMessages()},_deleteMessageTile:function(C){var A=C.message.messageId;var B=C.message.userId;this.messageTiles.unset(A);var D=this.userMessageCounts.get(B);if(D==1){this.chatApp.profileManager.removeProfileChangeListener(B,this.onProfileChangeListener);this.group.removeGroupUserStateUpdateAnyListener(this.onGroupUserStateUpdateAnyListener);this.userMessageCounts.unset(B)}else{this.userMessageCounts.set(B,D-1)}C.destroy()},_onGroupItem:function(B){if(B.message!=null){var A=this.messageTiles.get(B.message.messageId);if(A!=null){A.onGroupItem(B.groupItem);this._scrollMessages()}}},_onCurrentProfileChange:function(A){this._updateSigninBox()},_onProfileChange:function(A){var B=this.messages.select("."+A.userId);B.each(function(D){var C=$w(D.className)[1];var E=this.messageTiles.get(C);E.onProfileChange(A)}.bind(this))},_onGroupUserStateUpdateAny:function(B){var A=this.messages.select("."+B.userId);A.each(function(D){var C=$w(D.className)[1];var E=this.messageTiles.get(C);E.onGroupUserStateUpdate(B.groupUserState)}.bind(this))},_sendMessage:function(){if(this.sending){this.sendCancelled=true}else{if(this.input.value.length>this.inputLengthLimit){this.sendCancelled=true}else{this.sendCancelled=false;var A=this.input.value.strip();if(A!=""){this.sending=true;this.sendDelay=0;ServiceInterface.sendMessage(this.group.groupId,A,{callback:function(B){this.sendTime=new Date().getTime();this.sendDelay=B.publishDelay;this.approvalRequired=B.approvalRequired;this._updateInputStatus()}.bind(this)})}this.input.value=""}}},_onInputKeydown:function(A){if(A.keyCode==Event.KEY_RETURN||A.keyCode==10){this.returnKeyDown=true;this._sendMessage()}},_onInputKeyup:function(A){if(A.keyCode==Event.KEY_RETURN||A.keyCode==10){if(this.returnKeyDown){this.returnKeyDown=false;if(this.sendCancelled==false){this.input.value=""}else{this.input.value=this.input.value.replace(/[\r\n]/g,"");this._trimMessageInput()}}}},_updateInputStatus:function(){if(this.sending){if(this.sendDelay>1000){var D=new Date().getTime();var A=D-this.sendTime;var B=Math.round(Math.min(A/this.sendDelay,1)*100);if(this.approvalRequired&&B==100){this.sendTime=new Date().getTime()}var C=this.frame.down(".chat-input-status");C.down(".chat-input-progress").setStyle({width:B+"%"});if(this.approvalRequired){C.down(".chat-input-approval").show()}else{C.down(".chat-input-approval").hide()}C.show();setTimeout(this._updateInputStatus.bind(this),25)}}else{this.frame.down(".chat-input-status").hide()}},_trimMessageInput:function(){if(this.input.value.length>this.inputLengthLimit){this.input.value=this.input.value.substring(0,this.inputLengthLimit)}},_onInputChange:function(A){this._trimMessageInput()},_onInputFocus:function(A){if(!this.autoScroll){this.autoScroll=true;this._scrollMessages()}},_onInputClick:function(A){if(!this.autoScroll){this.autoScroll=true;this._scrollMessages()}},_onHistoryButtonClick:function(B,D){if(!this.loadingHistory){this.limitMessages=false;this.loadingHistory=true;var A=-1;var C=this.messages.down(".message");if(C!=null){A=$w(C.className)[1]-1}ServiceInterface.getHistoryMessages(this.group.groupId,A,D,{callback:function(F){this.loadingHistory=false;var E=this.frame.down(".chat-history-controls");F.each(function(H){var G=new MessageTile();G.setChatApp(this.chatApp);G.setGroup(this.group);G.initializeFromMessage(H);E.insert({after:G.frame});E=G.frame;this._onMessageTileInserted(G);this._scrollMessages()}.bind(this))}.bind(this),errorHandler:function(){this.loadingHistory=false}})}},_onPopoutButtonClick:function(B){var A=this.chatApp.clientConfig.baseWebUrl+"/"+this.group.url+"/embed";window.open(A,"_blank","status=0,toolbar=0,location=0,menubar=0,resizable=1,width=500,height=500")},_onMessagesScroll:function(){if((this.autoScrollingTimer==null)&&(this.lastAutoScrollTop!=0)){var B=this.messagesContainer.scrollTop;if(this.autoScroll){this.autoScroll=false}else{var A=this.messagesContainer.scrollHeight-this.messagesContainer.getHeight();if(B>=A){this.autoScroll=true}}if(!this.autoScroll){this._saveUserScrollPosition()}}},_saveUserScrollPosition:function(){var A=this.userScrollElement;if(A==null||!A.descendantOf(this.messages)){A=this.messages.childElements().last()}this.userScrollElement=null;this.userScrollElementOffset=0;var D=this.messagesContainer.scrollTop;var B=0;while(A!=null){B=A.positionedOffset().top;if(D>=B){this.userScrollElement=A;A=A.next()}else{if(this.userScrollElement){break}else{A=A.previous()}}}if(this.userScrollElement){var C=this.userScrollElement.positionedOffset().top;this.userScrollElementOffset=D-C}},_scrollMessages:function(){if(this.autoScroll){if(this.autoScrollingTimer!=null){clearTimeout(this.autoScrollingTimer);this.autoScrollingTimer=null}this.autoScrollingTimer=setTimeout(function(){clearTimeout(this.autoScrollingTimer);this.autoScrollingTimer=null}.bind(this),100);this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight;this.lastAutoScrollTop=this.messagesContainer.scrollTop}else{if(this.userScrollElement&&this.userScrollElement.descendantOf(this.messages)){this.messagesContainer.scrollTop=this.userScrollElement.positionedOffset().top+this.userScrollElementOffset}else{this.messagesContainer.scrollTop=0}}},_onContactsShowButtonClick:function(A){this.contactListTopVisible=(!this.contactListTopVisible);this._showContactList(this.contactListTopVisible)}};var GroupNavigationWidget=Class.create();GroupNavigationWidget.prototype={initialize:function(A){this.frame=A;this.chatApp=null;this.group=null},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A},destroy:function(){}};var GroupItemsWidget=Class.create();GroupItemsWidget.prototype={initialize:function(A){this.frame=A;this.chatApp=null;this.group=null;this.groupItemTiles=new Hash();this.groupItemCount=0;this.groupItemsLimit=8;this.itemTypeFilter=null;this.container=this.frame.down(".group-items-widget-container");this.emptyMessage=this.frame.down(".group-items-widget-empty-message");this.onGroupItemListener=this._onGroupItem.bindAsEventListener(this);this.onGroupItemDeleteListener=this._onGroupItemDelete.bindAsEventListener(this)},setChatApp:function(A){this.chatApp=A},setItemTypeFilter:function(A){this.itemTypeFilter=A},setGroupItemsLimit:function(A){this.groupItemsLimit=A},setGroup:function(group){this.group=group;this.group.addGroupItemListener(this.onGroupItemListener);this.group.addGroupItemDeleteListener(this.onGroupItemDeleteListener);var initialItems=this.container.select(".group-item");initialItems.each(function(itemElement){var objString=itemElement.down(".item-jsobj").innerHTML.unescapeHTML();var groupItem=(function(){return eval(objString)})();this._addGroupItemTile(groupItem)}.bind(this))},destroy:function(){this.group.removeGroupItemListener(this.onGroupItemListener);this.group.removeGroupItemDeleteListener(this.onGroupItemDeleteListener);this.frame.remove();this.frame=null},_isAcceptableItemType:function(A){var B=false;if(this.itemTypeFilter==null||this.itemTypeFilter.indexOf(A.item.itemType)!=-1){B=true}return B},_addGroupItemTile:function(B){if(this._isAcceptableItemType(B)&&this.groupItemTiles.get(B.item.itemId)==null){var A=GroupItemTile.create(B.item.itemType,this.container,GroupItemTile.SIZE_LARGE);A.setChatApp(this.chatApp);A.setGroup(this.group);A.setGroupItem(B);this.groupItemTiles.set(B.item.itemId,A);this.groupItemCount++;if(this.groupItemCount>this.groupItemsLimit){var C=this.container.childElements()[this.groupItemCount-1];var D=$w(C.className)[1];this._removeGroupItemTile(D)}this.emptyMessage.hide();this.container.show()}},_onGroupItem:function(A){this._addGroupItemTile(A.groupItem)},_onGroupItemDelete:function(A){this._removeGroupItemTile(A)},_removeGroupItemTile:function(B){var A=this.groupItemTiles.unset(B);if(A!=null){A.destroy();A=null;this.groupItemCount--}}};var GroupSettingsWidget=Class.create();GroupSettingsWidget.prototype={initialize:function(G){this.frame=G;this.chatApp=null;this.group=null;this.nameMaxSize=64;this.welcomeMessageMaxSize=250;if(this.frame.down(".settings-section-basic")!=null){this.nameInput=this.frame.down(".name-input");this.nameCharsAvailable=this.frame.down(".name-chars-available");this._checkInputLength(this.nameInput,this.nameCharsAvailable,this.nameMaxSize);Event.observe(this.nameInput,"keyup",this._onNameInputKeyup.bindAsEventListener(this));this.image=this.frame.down(".group-tile-image");this.imageSubmitButton=this.frame.down(".image-submit-button");this.imageUploadFrame=this.frame.down(".image-upload-frame");this.imageUploadProgress=this.frame.down(".image-upload-progress");Event.observe(this.imageSubmitButton,"click",this._onImageSubmit.bindAsEventListener(this));Event.observe(this.imageUploadFrame,"load",this._onImageUploadComplete.bindAsEventListener(this));this.deleteGroupButton=this.frame.down(".delete-group-button");if(this.deleteGroupButton!=null){Event.observe(this.deleteGroupButton,"click",this._onDeleteGroupButtonClick.bindAsEventListener(this))}}else{if(this.frame.down(".settings-section-users")!=null){var D=this.frame.select(".settings-moderate-link");D.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"moderate"))}.bind(this));var E=this.frame.down(".settings-block-admins").select(".settings-user-remove-link");E.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"admin-remove"))}.bind(this));var B=this.frame.down(".settings-block-moderators").select(".settings-user-remove-link");B.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"moderator-remove"))}.bind(this));var A=this.frame.down(".settings-block-online").select(".settings-admin-add-link");A.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"admin-add"))}.bind(this));var J=this.frame.down(".settings-block-online").select(".settings-moderator-add-link");J.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"moderator-add"))}.bind(this))}else{if(this.frame.down(".settings-section-moderation-users")!=null){var H=this.frame.down(".settings-section-moderation-users").select(".settings-remove-user-ban-link");H.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{userId:K},"user-ban-remove"))}.bind(this));var C=this.frame.down(".settings-section-moderation-users").select(".settings-remove-ip-ban-link");C.each(function(L){var K=$w(L.className)[1];Event.observe(L,"click",this._onSettingsActionClick.bindAsEventListener(this,{ipAddress:K},"ip-ban-remove"))}.bind(this));this.addIpBanButton=this.frame.down(".add-ip-ban-button");Event.observe(this.addIpBanButton,"click",this._onSettingsActionClick.bindAsEventListener(this,null,"ip-ban-add"));var I=this.frame.down(".settings-section-moderation-users").select(".ip-ban-expiry-time");I.each(function(L){var K=Date.parseGMT(L.innerHTML);L.innerHTML=K.getDateString()+", "+K.getHourMinuteString()}.bind(this))}else{if(this.frame.down(".settings-section-permissions")!=null){this.permissionsSettingsForm=this.frame.down(".permissions-settings-form")}else{if(this.frame.down(".settings-section-access-pass")!=null){this.accessPassSettingsForm=this.frame.down(".access-pass-settings-form");this.accessPassSettingsContainer=this.accessPassSettingsForm.down(".access-pass-settings-container");this.accessPassLimitInputContainer=this.accessPassSettingsContainer.down(".access-pass-limit-input-container");this.accessPassEnabledInput=this.accessPassSettingsForm.down(".access-pass-enabled-input");this.accessPassLimitUnlimitedEnabledInput=this.accessPassSettingsContainer.down(".access-pass-limit-unlimited-enabled-input");Event.observe(this.accessPassEnabledInput,"click",this._onAccessPassEnabledInputClick.bindAsEventListener(this));Event.observe(this.accessPassLimitUnlimitedEnabledInput,"click",this._onAccessPassLimitUnlimitedEnabledInputClick.bindAsEventListener(this))}else{if(this.frame.down(".settings-section-sharing")!=null){var F=this.frame.down(".event-url-auto-input");Event.observe(F,"click",function(){var K=this.frame.down(".event-url-input");if($F(F)){K.disable()}else{K.enable()}}.bind(this))}}}}}}this.saveButton=this.frame.down(".save-button");if(this.saveButton!=null){this.saveResult=this.frame.down(".save-result");Event.observe(this.saveButton,"click",this._onSaveButtonClick.bindAsEventListener(this))}},setChatApp:function(A){this.chatApp=A},setGroup:function(I){this.group=I;if(this.frame.down(".settings-section-moderation-sticky")!=null){var E=this.frame.down(".settings-block-sticky");var A=function(K){ServiceInterface.updateStickyMessage(this.group.groupId,K,{callback:function(){E.down(".form-error").hide();E.down(".form-success").show();setTimeout(function(){E.down(".form-success").hide()},1000)}.bind(this),errorHandler:function(){E.down(".form-success").hide();E.down(".form-error").show()}.bind(this)})}.bind(this);Event.observe(E.down(".update-button"),"click",function(){A($F(E.down(".message-input")))}.bindAsEventListener(this));Event.observe(E.down(".clear-button"),"click",function(){E.down(".message-input").value="";A($F(E.down(".message-input")))}.bindAsEventListener(this));var D=this.frame.down(".settings-block-welcome");var F=function(K){ServiceInterface.updateWelcomeMessage(this.group.groupId,K,{callback:function(){D.down(".form-error").hide();D.down(".form-success").show();setTimeout(function(){D.down(".form-success").hide()},1000)}.bind(this),errorHandler:function(){D.down(".form-success").hide();D.down(".form-error").show()}.bind(this)})}.bind(this);Event.observe(D.down(".update-button"),"click",function(){F($F(D.down(".message-input")))}.bindAsEventListener(this));Event.observe(D.down(".clear-button"),"click",function(){D.down(".message-input").value="";F($F(D.down(".message-input")))}.bindAsEventListener(this))}else{if(this.frame.down(".settings-section-moderation-display")!=null){var C=this.frame.down(".speed-form");Event.observe(C.down(".speed-save-button"),"click",function(){var K=Form.getInputs(C,"radio","speed-input").find(function(L){return L.checked}).value;ServiceInterface.submitGroupSettingsModerationForm(this.group.groupId,K,{callback:function(){C.down(".form-error").hide();C.down(".form-success").show();setTimeout(function(){C.down(".form-success").hide()},1000)}.bind(this),errorHandler:function(){C.down(".form-success").hide();C.down(".form-error").show()}.bind(this)})}.bindAsEventListener(this));var B=this.frame.down(".settings-block-word-filter");Event.observe(B.down(".filter-save-button"),"click",function(){var K=$F(this.frame.down(".words-input"));ServiceInterface.submitGroupSettingsWordFilterForm(this.group.groupId,K,{callback:function(L){this._onSaveSuccess(L,"/settings/moderation/display")}.bind(this),errorHandler:this._onSaveError.bind(this)})}.bindAsEventListener(this));var J=this.frame.down(".settings-block-cross-posting");if(J!=null){var H=function(K){ServiceInterface.setCrossPostUrl(this.group.groupId,K,{callback:function(){window.location.reload()}.bind(this),errorHandler:function(){J.down(".form-success").hide();J.down(".form-error").show()}.bind(this)})}.bind(this);Event.observe(J.down(".update-button"),"click",function(){var K=$F(this.frame.down(".cross-post-url-input"));H(K)}.bindAsEventListener(this));Event.observe(J.down(".clear-button"),"click",function(){this.frame.down(".cross-post-url-input").value="";H(null)}.bindAsEventListener(this))}}else{if(this.frame.down(".settings-section-moderation-approval")!=null){var G=this.frame.down(".approval-toggle-button");Event.observe(G,"click",function(){var L=($w(G.className)[1]=="approval-manual");var K=new ConfirmationPopup();K.setChatApp(this.chatApp);K.setTitle(_("Are you sure?"));if(L){K.setMessage(_("Turn on Manual Approval?")+"<br/><br/>"+_("All messages will need to be<br/>manually approved for display!")+"<br/><br/>")}else{K.setMessage(_("Turn off Manual Approval?")+"<br/><br/>"+_("Any messages currently in the<br/>approval queue will be skipped.")+"<br/><br/>")}K.setOnOkCallback(function(){ServiceInterface.setManualApprovalEnabled(this.group.groupId,L,{callback:function(){window.location.reload()}.bind(this),errorHandler:function(){}})}.bind(this));K.show()}.bindAsEventListener(this));if(this.frame.down(".empty-indicator")!=null){this.approvalQueue=new ApprovalQueue(this.frame.down(".approval-queue"));this.approvalQueue.setChatApp(this.chatApp);this.approvalQueue.setGroup(this.group)}}}}},destroy:function(){this.frame.remove();this.frame=null},_onNameInputKeyup:function(A){this._checkInputLength(this.nameInput,this.nameCharsAvailable,this.nameMaxSize)},_onWelcomeMessageInputKeyup:function(A){this._checkInputLength(this.welcomeMessageInput,this.welcomeMessageCharsAvailable,this.welcomeMessageMaxSize)},_checkInputLength:function(E,D,A){var B=A-E.value.length;if(B<=0){E.value=E.value.substring(0,A);B=0;D.addClassName("form-error")}else{D.removeClassName("form-error")}var C=B+((B!=1)?" characters":" character")+" left";D.innerHTML=C},_onImageSubmit:function(A){this.imageUploadProgress.innerHTML="Uploading..."},_onImageUploadComplete:function(){var A=this.imageUploadFrame.contentWindow||this.imageUploadFrame.contentDocument;if(A.document){A=A.document}var B=A.getElementById("image-upload-errors");if(B!=undefined&&B!="undefined"){this.imageUploadProgress.innerHTML="<div class='form-error'>"+B.innerHTML+"</div>"}else{this.image.src=A.getElementById("main-image-url").innerHTML;this.imageUploadProgress.innerHTML=""}},_onAccessPassEnabledInputClick:function(){if($F(this.accessPassEnabledInput)==null){this.accessPassSettingsContainer.hide()}else{this.accessPassSettingsContainer.show()}},_onAccessPassLimitUnlimitedEnabledInputClick:function(){if($F(this.accessPassLimitUnlimitedEnabledInput)==null){this.accessPassLimitInputContainer.show()}else{this.accessPassLimitInputContainer.hide()}},_onSaveButtonClick:function(){if(this.frame.down(".settings-section-basic")!=null){ServiceInterface.submitGroupSettingsBasicForm(this.group.groupId,$F(this.frame.down(".name-input")),$F(this.frame.down(".url-input")),$F(this.frame.down(".language-input")),{callback:function(T){this._onSaveSuccess(T,"/settings")}.bind(this),errorHandler:this._onSaveError.bind(this)})}else{if(this.frame.down(".settings-section-access")!=null){var L=$F(this.frame.down(".signin-guest-input"))?true:false;var R=$F(this.frame.down(".signin-chatroll-input"))?true:false;var G=$F(this.frame.down(".signin-facebook-input"))?true:false;var H=$F(this.frame.down(".signin-twitter-input"))?true:false;var N=$F(this.frame.down(".signin-sso-input"))?true:false;ServiceInterface.submitGroupSettingsAccessForm(this.group.groupId,$F(this.frame.down(".free-limit-input")),R,G,H,L,N,{callback:function(T){this._onSaveSuccess(T,"/settings/access")}.bind(this),errorHandler:this._onSaveError.bind(this)})}else{if(this.frame.down(".settings-section-permissions")!=null){var E=Form.getInputs(this.permissionsSettingsForm,"radio","access-input").find(function(T){return T.checked}).value;var A=null;var O=Form.getInputs(this.permissionsSettingsForm,"radio","write-input").find(function(T){return T.checked}).value;var K=Form.getInputs(this.permissionsSettingsForm,"radio","links-input").find(function(T){return T.checked}).value;var M=Form.getInputs(this.permissionsSettingsForm,"radio","pm-input").find(function(T){return T.checked}).value;var B=Form.getInputs(this.permissionsSettingsForm,"radio","delete-input").find(function(T){return T.checked}).value;var D=Form.getInputs(this.permissionsSettingsForm,"radio","archive-access-input").find(function(T){return T.checked}).value;var F=Form.getInputs(this.permissionsSettingsForm,"radio","dashboard-access-input").find(function(T){return T.checked}).value;ServiceInterface.submitGroupSettingsPrivacyForm(this.group.groupId,E,A,O,K,M,B,D,F,{callback:function(T){this._onSaveSuccess(T,"/settings/permissions")}.bind(this),errorHandler:this._onSaveError.bind(this)})}else{if(this.frame.down(".settings-section-sharing")!=null){var S=$F(this.frame.down(".sharing-input"))?true:false;var I=$F(this.frame.down(".event-url-auto-input"))?true:false;ServiceInterface.submitGroupSettingsSharingForm(this.group.groupId,S,I,$F(this.frame.down(".event-url-input")),{callback:function(T){this._onSaveSuccess(T,"/settings/sharing")}.bind(this),errorHandler:this._onSaveError.bind(this)})}else{if(this.frame.down(".settings-section-twitter")!=null){ServiceInterface.submitGroupSettingsTwitterForm(this.group.groupId,$F(this.frame.down(".twitter-hash-input")),$F(this.frame.down(".twitter-message-input")),{callback:function(T){this._onSaveSuccess(T,"/settings/twitter")}.bind(this),errorHandler:this._onSaveError.bind(this)})}else{if(this.frame.down(".settings-section-access-pass")!=null){var Q=null;var C=null;var J=$F(this.accessPassEnabledInput);if(J==null){J=false}else{Q=$F(this.accessPassSettingsForm.down(".access-pass-price-input"));var P=$F(this.accessPassLimitUnlimitedEnabledInput);if(P==null){C=$F(this.accessPassSettingsForm.down(".access-pass-limit-input"))}}ServiceInterface.submitGroupSettingsAccessPassForm(this.group.groupId,J,C,Q,{callback:function(T){this._onSaveSuccess(T,"/settings/payments/access-pass")}.bind(this),errorHandler:this._onSaveError.bind(this)})}}}}}}},_onSaveSuccess:function(B,A){window.location.replace(this.chatApp.clientConfig.baseWebUrl+"/"+B.url+A)},_onSaveError:function(E,D){var F="";var B=D.fieldErrors;if(B!=null){F="<ul>";for(var C=0,A=B.length;C<A;++C){F+="<li>"+B[C].defaultMessage+"</li>"}F+="</ul>"}this.saveResult.innerHTML="Sorry! Your settings could not be saved due to the following error(s):<br/>"+F},_onSettingsActionClick:function(F,A,D){switch(D){case"moderate":Event.stop(F);var G=new ContactListPopup();G.setChatApp(this.chatApp);G.setGroup(this.group);var B=this.chatApp.profileManager.getProfile(A.userId);G.setProfile(B);break;case"admin-add":ServiceInterface.modifyUserPermissions(this.group.groupId,A.userId,true,true,[4,6],{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"moderator-add":ServiceInterface.modifyUserPermissions(this.group.groupId,A.userId,true,true,[6],{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"admin-remove":ServiceInterface.modifyUserPermissions(this.group.groupId,A.userId,false,true,[4,6],{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"moderator-remove":ServiceInterface.modifyUserPermissions(this.group.groupId,A.userId,false,true,[6],{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"user-ban-add":ServiceInterface.banUser(this.group.groupId,A.userId,{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"user-ban-remove":ServiceInterface.modifyUserPermissions(this.group.groupId,A.userId,false,false,[7],{callback:function(){window.location.reload()},errorHandler:function(){}});break;case"ip-ban-add":var H=$F(this.frame.down(".ip-ban-address"));var C=$F(this.frame.down(".ip-ban-duration-value"));var I=$F(this.frame.down(".ip-ban-duration-unit"));var E=this.frame.down(".ip-ban-result");ServiceInterface.banIp(this.group.groupId,H,C,I,{callback:function(){window.location.reload()},errorHandler:function(){E.innerHTML="Failed to ban IP."}});break;case"ip-ban-remove":ServiceInterface.modifyDeniedIpPermissions(this.group.groupId,A.ipAddress,false,[7],0,{callback:function(){window.location.reload()},errorHandler:function(){}});break}},_onDeleteGroupButtonClick:function(){var A=new ConfirmationPopup();A.setChatApp(this.chatApp);A.setTitle(_("Are you sure?"));A.setMessage(this.group.nameHtmlWbr+" "+_("will be <b>permanently</b> deleted.<div style='color:#ff0000;font-weight:bold;padding-top:5px;'>It will be gone forever!</div>"));A.setOnOkCallback(this._onDeleteConfirmation.bind(this));A.show()},_onDeleteConfirmation:function(){ServiceInterface.deleteGroup(this.group.groupId,{callback:function(){location.replace("/")}.bind(this),errorHandler:function(){}})}};var GroupArchiveWidget=Class.create();GroupArchiveWidget.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A;this.messageTiles=new Hash();this.messagesContainer=this.frame.down(".archive-messages-container");this.onMessageDeleteListener=this._onMessageDelete.bindAsEventListener(this)},setChatApp:function(A){this.chatApp=A},setGroup:function(E){this.group=E;this.group.addMessageDeleteListener(this.onMessageDeleteListener);if(this.messagesContainer!=null){var D=this.messagesContainer.select(".message");for(var B=0;B<D.length;B++){var A=D[B];var C=new MessageTile();C.setChatApp(this.chatApp);C.setGroup(this.group);C.initializeFromElement(A);this.messageTiles.set(C.message.messageId,C)}}},destroy:function(){var B=this.messageTiles.values();for(var A=0;A<B.length;A++){B[A].destroy()}this.messageTiles=null},_onMessageDelete:function(B){if(B.messageId!=0){var A=this.messageTiles.unset(B.messageId);if(A!=null){A.destroy()}}else{var C=this.messagesContainer.select("."+B.userId);C.each(function(E){var D=$w(E.className)[1];this.messageTiles.unset(D).destroy()}.bind(this))}}};var GroupArchiveExportWidget=Class.create();GroupArchiveExportWidget.prototype={initialize:function(A){this.frame=A;this.chatApp=null;this.group=null},setChatApp:function(A){this.chatApp=A},setGroup:function(C){this.group=C;var B=function(){var H=$F(this.frame.down(".archive-export-begin-year"));var I=$F(this.frame.down(".archive-export-begin-month"));var G=$F(this.frame.down(".archive-export-begin-day"));var F=$F(this.frame.down(".archive-export-begin-hour"));var E=$F(this.frame.down(".archive-export-begin-minute"));var D=new Date();D.setFullYear(H);D.setMonth(I);D.setDate(G);D.setHours(F);D.setMinutes(E,0,0);return D.getTime()}.bind(this);var A=function(){var I=$F(this.frame.down(".archive-export-end-year"));var D=$F(this.frame.down(".archive-export-end-month"));var H=$F(this.frame.down(".archive-export-end-day"));var G=$F(this.frame.down(".archive-export-end-hour"));var F=$F(this.frame.down(".archive-export-end-minute"));var E=new Date();E.setFullYear(I);E.setMonth(D);E.setDate(H);E.setHours(G);E.setMinutes(F,0,0);return E.getTime()}.bind(this);Event.observe(this.frame.down(".export-button"),"click",function(){var D=this.chatApp.clientConfig.baseWebUrl+"/"+this.group.url+"/archive-download?beginTime="+B()+"&endTime="+A();window.open(D,"_blank","status=0,toolbar=0,location=1,menubar=1,resizable=1,scrollbars=1,width=600,height=400")}.bind(this));Event.observe(this.frame.down(".export-analytics-button"),"click",function(){var D=this.chatApp.clientConfig.baseWebUrl+"/"+this.group.url+"/analytics-download?beginTime="+B()+"&endTime="+A();window.open(D,"_blank","status=0,toolbar=0,location=1,menubar=1,resizable=1,scrollbars=1,width=600,height=400")}.bind(this))},destroy:function(){this.frame.remove();this.frame=null}};var GroupSettingsAppearanceWidget=Class.create();GroupSettingsAppearanceWidget.prototype={initialize:function(A){this.chatApp=null;this.group=null;this.frame=A},setChatApp:function(A){this.chatApp=A},setGroup:function(A){this.group=A;this.fgColorInput=this.frame.down("#fgcolor-value");this.bgColorInput=this.frame.down("#bgcolor-value");this.textFgColorInput=this.frame.down("#textfgcolor-value");this.textBgColorInput=this.frame.down("#textbgcolor-value");var B=this.chatApp.clientConfig.baseStaticUrl+"/util/colorpicker/img/";new Control.ColorPicker("bgcolor-value",{swatch:"bgcolor-swatch",onUpdate:this._updatePreview.bindAsEventListener(this),IMAGE_BASE:B});new Control.ColorPicker("fgcolor-value",{swatch:"fgcolor-swatch",onUpdate:this._updatePreview.bindAsEventListener(this),IMAGE_BASE:B});new Control.ColorPicker("textbgcolor-value",{swatch:"textbgcolor-swatch",onUpdate:this._updatePreview.bindAsEventListener(this),IMAGE_BASE:B});new Control.ColorPicker("textfgcolor-value",{swatch:"textfgcolor-swatch",onUpdate:this._updatePreview.bindAsEventListener(this),IMAGE_BASE:B});this.showBorderInput=this.frame.down(".customize-embed-showborder-input");Event.observe(this.showBorderInput,"change",this._updatePreview.bindAsEventListener(this));this.soundInput=this.frame.down(".customize-embed-sound-input");Event.observe(this.frame.down(".clear-button"),"click",function(){ServiceInterface.clearRecentMessages(this.group.groupId,{callback:function(){window.location.reload()}.bind(this),errorHandler:function(){this.frame.down(".clear-error").show()}.bind(this)})}.bind(this));Event.observe(this.frame.down(".save-button"),"click",this._onSaveButtonClick.bindAsEventListener(this));this.formSuccess=this.frame.down(".save-success");this.saveResult=this.frame.down(".save-result");this._updatePreview()},_onSaveButtonClick:function(){var A=$F(this.fgColorInput);var J=$F(this.bgColorInput);var M=$F(this.textFgColorInput);var I=$F(this.textBgColorInput);var F=$F(this.showBorderInput)?true:false;var K=$F(this.soundInput)?true:false;var D=$F(this.frame.down(".contact-list-position-input"));var G=$F(this.frame.down(".recent-messages-interval-value"));var C=$F(this.frame.down(".recent-messages-interval-unit"));var L=1;switch(C){case"days":L=86400;break;case"hours":L=3600;break;case"minutes":L=60;break}var E=parseInt(G)*L;var B=$F(this.frame.down(".hide-links-input"))?true:false;var H=$F(this.frame.down(".css-input"));this.formSuccess.hide();this.saveResult.hide();ServiceInterface.submitGroupSettingsAppearanceForm(this.group.groupId,A,J,M,I,F,D,K,E,B,H,{callback:function(){this._onSaveSuccess()}.bind(this),errorHandler:this._onSaveError.bind(this)})},_onSaveSuccess:function(){window.location.reload()},_onSaveError:function(E,D){var F="";var B=D.fieldErrors;if(B!=null){F="<ul>";for(var C=0,A=B.length;C<A;++C){F+="<li>"+B[C].defaultMessage+"</li>"}F+="</ul>"}this.saveResult.innerHTML="Sorry! Your settings could not be saved due to the following error(s):<br/>"+F;this.saveResult.show()},_updatePreview:function(){var L=$F(this.bgColorInput);var G=$F(this.fgColorInput);var F=$F(this.textBgColorInput);var J=$F(this.textFgColorInput);var C=380;var K=280;var I=$F(this.showBorderInput);this.frame.down(".customize-preview-container").setStyle({background:"#"+L});var H=8;var B=2;if(I==null){H=1;B=1}var E=90;var A=70;if(Math.round(C)>Math.round(K)){A=Math.round(K/C*E)}else{E=Math.round(C/K*A)}this.frame.down(".preview-window-box").setStyle({background:"#"+F,width:E+"px",height:A+"px",border:B+"px solid #"+G,borderTop:H+"px solid #"+G});var D=B+"px solid #"+G;if(C<350){D="0"}this.frame.down(".preview-message-window").setStyle({background:"#"+F,color:"#"+J,width:(E-2*B-10)+"px",height:(A-B-H-10)+"px",borderRight:D});this.frame.down(".preview-input-box").setStyle({borderTop:B+"px solid #"+G})}};var goTemplates={};goTemplates["site-confirmation-popup"]=function(B){var A=[];A.push('\n<div class="confirmation-popup-border popup-border">\n\t<div class="popup-shadow"></div>\n\t<div class="popup-title"></div>\n\t<div class="popup-content">\n\t\t<div class="confirmation-message"></div>\n\t\t<div>\n\t\t\t<input class="confirmation-ok-button" style="margin:5px;" type="button" value="OK"/>\n\t\t\t<input class="confirmation-cancel-button" style="margin:5px;" type="button" value="Cancel"/>\n\t\t</div>\n\t</div>\n\t<div class="confirmation-close-button popup-close-button">X</div>\n</div>');return A.join("")};goTemplates["site:dock-flyout-item"]=function(B){var A=[];A.push("\n<a href='");A.push(B.url);A.push("' class='dock-flyout-item ");A.push(B.itemClass);A.push("' style='left:");A.push(B.left);A.push("px;top:");A.push(B.top);A.push("px;'> \n\t<div class='dock-item-text-container'>\n\t\t<div class='valign' style='height:34px;'><div class='valign-in1'><div class='dock-item-text ");A.push(B.textClass);A.push(" valign-in2'>");A.push(B.nameHtmlWbr);A.push("</div></div></div>\n\t</div>\n\t<div class='dock-item-bubble' ");A.push(B.notifyVisibility);A.push("><div>");A.push(B.notifyText);A.push("</div></div>\n</a>");return A.join("")};goTemplates["profile:small-tile"]=function(B){var A=[];A.push('\n<div class="');A.push(B.userId);A.push(' profile-small-tile">\n\t<div class="valign" style="height:38px;"><div class="valign-in1"><div class="valign-in2 profile-icon-image-border">\n\t');A.push(B.iconImageHTML);A.push('\n\t</div></div></div>\n\t<div class="tiny" style="font-weight:bold;">');A.push(B.displayNameHTML);A.push("</div>\n</div>");return A.join("")};goTemplates["profile:contact-list-item"]=function(B){var A=[];A.push('\n<div class="contact-list-status-icon"><img class="status-icon status-icon-');A.push(B.profile.status);A.push('" src="/t.gif" title="');A.push(B.profile.displayStatus);A.push('"/></div>\n<div class="contact-list-profile-name ');A.push(B.contactListNameClass);A.push('">');A.push(B.displayNameHTML);A.push('</div>\n<div class="contact-list-profile-image">');A.push(B.tinyImageHTML);A.push("</div>");return A.join("")};goTemplates["profile:contact-list-popup"]=function(B){var A=[];A.push('\n<div class="popup-border" style="width:190px;">\n\t<div class="popup-shadow"></div>\n\t<div class="popup-title">');A.push(B.profile.displayNameHtml);A.push('</div>\n\t<div class="popup-content">\n\t\t<div style="text-align:left;position:relative;">\n\t\t\t<div style="position:absolute;">');A.push(B.iconImageHTML);A.push('</div>\n\t\t\t<div style="padding:12px 0 12px 45px;font-weight:bold;">');A.push(B.displayNameHTML);A.push('</div>\n\t\t</div>\n\t\t<div class="padding-10"></div>\t\n\t\t<input class="pm-show-button" style="width:160px;display:none;" type="button" value="');A.push(B._("Send Private Message"));A.push('"/>\n\t\t<div class="moderator-control" style="display:none; padding-top:10px">\n\t\t\t<div style="font-weight:bold;">Moderation</div>\n\t\t\t<input class="delete-button" style="width:160px;" type="button" value="');A.push(B._("Delete all messages"));A.push('"/>\n\t\t\t<input class="ban-button" style="width:160px;" type="button" value="');A.push(B._("Block user"));A.push('"/>\n\t\t</div>\n\t\t<div class="status"></div>\n\t</div>\n\t<div class="popup-close-button">X</div>\t\n</div>');return A.join("")};goTemplates["group:private-message-popup"]=function(B){var A=[];A.push('\n<div class="popup-border" style="width:240px;">\n\t<div class="popup-shadow"></div>\n\t<div class="popup-title">');A.push(B.title);A.push('</div>\n\t<div class="popup-content">\n\t\t<div style="text-align:left;position:relative;">\n\t\t\t<div style="position:absolute;">');A.push(B.iconImageHTML);A.push('</div>\n\t\t\t<div style="padding:12px 0 12px 45px;font-weight:bold;">');A.push(B.displayNameHTML);A.push('</div>\n\t\t</div>\n\t\t<div class="pm-message" style="display:none; padding:10px 5px; text-align:left;">');A.push(B.message);A.push('</div>\n\t\t<div class="pm-reply">\n\t\t\t<div class="padding-5" style="text-align:left">\n\t\t\t\t<span class="pm-action-label">');A.push(B.actionLabel);A.push('</span><span class="pm-price-label"> for<br/> <b>5 Credits</b> or <b>FREE</b> with a <b><a href="#" onclick=\'goChatApp.fireGroupUiAction(BluePassOfferPopup.SHOW_POPUP);return false;\'>Blue Pass</a></b></span>:\n\t\t\t</div>\n\t\t\t<div class="padding-2"></div>\n\t\t\t<input class="pm-input" style="width:96%" type="input" maxlength="256"/>\n\t\t\t<div class="padding-10"></div>\n\t\t\t<input class="pm-send-button" type="button" value="Send"/>&nbsp;<input class="pm-cancel-button" type="button" value="Close"/>\n\t\t\t<div class="padding-5"></div>\n\t\t\t<div class="status"></div>\n\t\t</div>\n\t</div>\n\t<div class="popup-close-button">X</div>\t\n</div>');return A.join("")};goTemplates["group:approval-message-tile"]=function(B){var A=[];A.push('\n<div class="approval-message-tile ');A.push(B.message.messageId);A.push('" style="position:relative;margin:4px;padding:2px 80px 6px 2px;color:#525252;">\n\t<div class="message-content">\n\t\t<div class="message-timestamp">');A.push(B.timestamp);A.push('</div>\n\t\t<span class="message-profile-name"></span>: <span class="message-text">');A.push(B.message.textHtml);A.push('</span>\n\t</div>\n\t<div class="message-profile-image"></div>\n\t<div class="message-approve-button" style="position:absolute;cursor:pointer;top:4px;right:42px;width:32px;height:32px;border:1px solid #888;background:green;"></div>\n\t<div class="message-skip-button" style="position:absolute;cursor:pointer;top:4px;right:4px;width:32px;height:32px;border:1px solid #888;background:red;"></div>\n</div>');return A.join("")};goTemplates["group-item:bookmark-tile"]=function(B){var A=[];A.push('\n<div class="group-item ');A.push(B.item.itemId);A.push('">\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n\t<div style="position:relative;">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\n\t\t\t<img class="item-image highlight" title="');A.push(B.item.title);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t\t<div class="group-item-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\t\n\t</div>\n\t<div class="group-item-title">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow" style="font-size:0.85em;">');A.push(B.item.title);A.push("</a>\n\t</div>\n</div>");return A.join("")};goTemplates["group-item:bookmark-tile-small"]=function(B){var A=[];A.push('\n<div class="group-item-small ');A.push(B.item.itemId);A.push('">\n\t<div class="group-item-small-image-container">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\t\t\t\t\n\t\t\t<img class="item-image highlight" style="width:45px;height:35px;" title="');A.push(B.item.title);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t</div>\n\t<div class="group-item-small-title"><a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">');A.push(B.item.title);A.push('</a></div>\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\t\n</div>\n');return A.join("")};goTemplates["group-item:image-tile"]=function(B){var A=[];A.push('\n<div class="group-item ');A.push(B.item.itemId);A.push('">\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n\t<div style="position:relative;">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\n\t\t\t<img class="item-image highlight" title="');A.push(B.item.url.name);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t\t<div class="group-item-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\t\n\t</div>\n\t<div class="group-item-title">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow" style="font-size:0.85em;">');A.push(B.item.url.nameHtmlWbr);A.push("</a>\n\t</div>\n</div>");return A.join("")};goTemplates["group-item:image-tile-small"]=function(B){var A=[];A.push('\n<div class="group-item-small ');A.push(B.item.itemId);A.push('">\n\t<div class="group-item-small-image-container">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\t\t\t\t\n\t\t\t<img class="item-image highlight" style="width:45px;height:35px;" title="');A.push(B.item.url.name);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t</div>\n\t<div class="group-item-small-title"><a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">');A.push(B.item.url.nameHtmlWbr);A.push('</a></div>\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n</div>\n');return A.join("")};goTemplates["group-item:video-tile"]=function(B){var A=[];A.push('\n<div class="group-item ');A.push(B.item.itemId);A.push('">\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n\t<div style="position:relative;">\n\t\t<a href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\n\t\t\t<img class="item-image highlight" title="');A.push(B.item.title);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t\t<a href="');A.push(B.item.url.name);A.push('" class="play-button" style="position:absolute;top:47px;left:44px;" href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\n\t\t\t<img class="button-play" alt="Play" src="/t.gif"/>\n\t\t</a>\n\t\t<div class="group-item-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\n\t</div>\n\t<div class="group-item-title">\n\t\t<a class="group-item-show-button" href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow" style="font-size:0.85em;">');A.push(B.item.title);A.push("</a>\n\t</div>\n</div>");return A.join("")};goTemplates["group-item:video-tile-small"]=function(B){var A=[];A.push('\n<div class="group-item-small ');A.push(B.item.itemId);A.push('">\n\t<div class="group-item-small-image-container">\n\t\t<a class="group-item-show-button" href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\t\t\t\t\n\t\t\t<img class="item-image highlight" style="width:45px;height:35px;cursor:pointer;" title="');A.push(B.item.title);A.push('" src="');A.push(B.item.imageUrl);A.push('"/>\n\t\t</a>\n\t</div>\n\t<div class="group-item-small-title" style="height:1.1em;">\n\t\t<a class="group-item-show-button" style="font-size:0.85em; overflow:hidden;" href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">');A.push(B.item.title);A.push('</a>\n\t</div>\n\t<div style="padding-left:53px;"><a class="group-item-show-button" href="');A.push(B.item.url.name);A.push('" target="_blank" rel="nofollow">\n\t\t<img class="button-play" alt="Play" src="/t.gif"/>\n\t</a></div>\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n</div>\n');return A.join("")};goTemplates["group-item:discussion-tile"]=function(B){var A=[];A.push('\n<div class="group-item ');A.push(B.item.itemId);A.push(' discussion-group-item-tile">\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n\t<div class="group-item-profile profile-small-tile" style="margin:0px; height:52px;"></div>\n\t<div style="padding-left:65px;">\n\t\t<div style="height:1.2em; overflow:hidden; font-weight:bold;">\n\t\t\t<a class="group-item-show-button" href="javascript:void(0);">');A.push(B.item.titleHtmlWbr);A.push('</a>\n\t\t</div>\n\t\t<div class="group-item-description">\n\t\t\t');A.push(B.item.descriptionShortHtml);A.push('\n\t\t</div>\n\t</div>\n\t<div class="group-item-delete-button" style="display:none;top:3px;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\n</div>');return A.join("")};goTemplates["group-item:discussion-tile-small"]=function(B){var A=[];A.push('\n<div class="group-item-small ');A.push(B.item.itemId);A.push('">\n\t<div class="group-item-small-image-container">\n\t\t<div class="valign" style="height:38px; width:38px;"><div class="valign-in1"><div class="valign-in2 profile-icon-image-border" style="border:none;">\n\t\t\t\n\t\t</div></div></div>\n\t</div>\n\t<div class="group-item-small-title" style="padding-left:46px;">\n\t\t<a class="group-item-show-button group-item-group-link" target="_blank" href="/">');A.push(B.item.titleHtmlWbr);A.push('</a>\n\t</div>\n\t<span class="item-jsobj" style="display:none;">myObject=null</span>\n</div>\n');return A.join("")};goTemplates["message:chat-message-tile"]=function(B){var A=[];A.push('\n<div class="message ');A.push(B.message.messageId);A.push(" ");A.push(B.message.userId);A.push(" ");A.push(B.message.type);A.push('">\n\t<div class="message-content">\n\t\t<div class="message-timestamp">');A.push(B.timestamp);A.push('</div>\n\t\t<span class="message-profile-name" ></span>: <span class="message-text">');A.push(B.message.textHtml);A.push('</span>\n\t\t<div class=\'message-group-items\'>\n\t\t\t\n\t\t</div>\n\t</div>\n\t<div class="message-profile-image"></div>\n\t\n\t<div class="message-cross-post-button" style="display:none;"><img class="button-cross-post clickable" title="Cross Post" src="/t.gif"/></div>\n\t<div class="message-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\n</div>');return A.join("")};goTemplates["message:comment-post-tile"]=function(B){var A=[];A.push('\n<div class="message ');A.push(B.message.messageId);A.push(" ");A.push(B.message.userId);A.push(" ");A.push(B.message.type);A.push('">\n\t<div class="message-content">\n\t\t<span class="message-timestamp">');A.push(B.timestamp);A.push('</span><br/>\n\t\t<span class="message-profile-name" ></span>&nbsp;<span class="message-comment-mark">commented on:</span>\n\t\t<div class="message-group-items">\n\t\t\t\n\t\t</div>\n\t\t<span style="font-size:0.9em;font-style:italic;">"<span class="message-text">');A.push(B.message.comment.textHtml);A.push('</span>"</span>\n\t</div>\n\t<div class="message-profile-image"></div>\t\n\t\n\t<div class="message-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\n</div>');return A.join("")};goTemplates["message:new-item-tile"]=function(B){var A=[];A.push('\n<div class="message ');A.push(B.message.messageId);A.push(" ");A.push(B.message.userId);A.push(" ");A.push(B.message.type);A.push('">\n\t<div class="message-content">\n\t\t<span class="message-timestamp">');A.push(B.timestamp);A.push('</span><br/>\n\t\t<span class="message-profile-name" ></span>&nbsp;<span class="message-comment-mark">posted a new discussion:</span>\n\t\t<div class="message-group-items">\n\t\t\t\n\t\t</div>\n\t</div>\n\t<div class="message-profile-image"></div>\t\n\t\n\t<div class="message-delete-button" style="display:none;"><img class="button-delete clickable" title="Delete" src="/t.gif"/></div>\t\n</div>');return A.join("")};goTemplates["embed:youtube"]=function(B){var A=[];A.push("\n<embed src='http://www.youtube.com/v/");A.push(B.externalId);A.push("&hl=en&autoplay=1' type='application/x-shockwave-flash' wmode='transparent' width='425' height='350'/>");return A.join("")};goTemplates["embed:break"]=function(B){var A=[];A.push("\n<embed src='");A.push(B.externalId);A.push("&autoplay=1' type='application/x-shockwave-flash' wmode='transparent' width='464' height='392'/>");return A.join("")};TemplateManager.prototype.templates=goTemplates