<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Mail::SMTP - mail-2.6.1 Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#class-Mail::SMTP-label-Sending+Email+with+SMTP">Sending Email with SMTP</a>
    <li><a href="#class-Mail::SMTP-label-Sending+via+SMTP+server+on+Localhost">Sending via SMTP server on Localhost</a>
    <li><a href="#class-Mail::SMTP-label-Sending+via+MobileMe">Sending via MobileMe</a>
    <li><a href="#class-Mail::SMTP-label-Sending+via+GMail">Sending via GMail</a>
    <li><a href="#class-Mail::SMTP-label-Certificate+verification">Certificate verification</a>
    <li><a href="#class-Mail::SMTP-label-Others+">Others </a>
    <li><a href="#class-Mail::SMTP-label-Delivering+the+email">Delivering the email</a>
  </ul>
</div>


  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="CheckDeliveryParams.html">Mail::CheckDeliveryParams</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-deliver-21">#deliver!</a>
    
    <li ><a href="#method-i-ssl_context">#ssl_context</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Mail::SMTP">
  <h1 id="class-Mail::SMTP" class="class">
    class Mail::SMTP
  </h1>

  <section class="description">
    
<h2 id="class-Mail::SMTP-label-Sending+Email+with+SMTP">Sending Email with <a href="SMTP.html">SMTP</a><span><a href="#class-Mail::SMTP-label-Sending+Email+with+SMTP">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p><a href="../Mail.html">Mail</a> allows you to send emails using <a
href="SMTP.html">SMTP</a>.  This is done by wrapping <a
href="../Net/SMTP.html">Net::SMTP</a> in an easy to use manner.</p>

<h3 id="class-Mail::SMTP-label-Sending+via+SMTP+server+on+Localhost">Sending via <a href="SMTP.html">SMTP</a> server on Localhost<span><a href="#class-Mail::SMTP-label-Sending+via+SMTP+server+on+Localhost">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Sending locally (to a postfix or sendmail server running on localhost)
requires no special setup.  Just to <a
href="../Mail.html#method-c-deliver">Mail.deliver</a> &amp;block or
message.deliver! and it will be sent in this method.</p>

<h3 id="class-Mail::SMTP-label-Sending+via+MobileMe">Sending via MobileMe<span><a href="#class-Mail::SMTP-label-Sending+via+MobileMe">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">defaults</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">delivery_method</span> :<span class="ruby-identifier">smtp</span>, { :<span class="ruby-identifier">address</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;smtp.me.com&quot;</span>,
                           :<span class="ruby-identifier">port</span>                 =<span class="ruby-operator">&gt;</span> <span class="ruby-value">587</span>,
                           :<span class="ruby-identifier">domain</span>               =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'your.host.name'</span>,
                           :<span class="ruby-identifier">user_name</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'&lt;username&gt;'</span>,
                           :<span class="ruby-identifier">password</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'&lt;password&gt;'</span>,
                           :<span class="ruby-identifier">authentication</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'plain'</span>,
                           :<span class="ruby-identifier">enable_starttls_auto</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>  }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="class-Mail::SMTP-label-Sending+via+GMail">Sending via GMail<span><a href="#class-Mail::SMTP-label-Sending+via+GMail">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">defaults</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">delivery_method</span> :<span class="ruby-identifier">smtp</span>, { :<span class="ruby-identifier">address</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;smtp.gmail.com&quot;</span>,
                           :<span class="ruby-identifier">port</span>                 =<span class="ruby-operator">&gt;</span> <span class="ruby-value">587</span>,
                           :<span class="ruby-identifier">domain</span>               =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'your.host.name'</span>,
                           :<span class="ruby-identifier">user_name</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'&lt;username&gt;'</span>,
                           :<span class="ruby-identifier">password</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'&lt;password&gt;'</span>,
                           :<span class="ruby-identifier">authentication</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'plain'</span>,
                           :<span class="ruby-identifier">enable_starttls_auto</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>  }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="class-Mail::SMTP-label-Certificate+verification">Certificate verification<span><a href="#class-Mail::SMTP-label-Certificate+verification">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>When using TLS, some mail servers provide certificates that are self-signed
or whose names do not exactly match the hostname given in the address.
OpenSSL will reject these by default. The best remedy is to use the correct
hostname or update the certificate authorities trusted by your ruby. If
that isnâ€™t possible, you can control this behavior with an
:openssl_verify_mode setting. Its value may be either an OpenSSL verify
mode constant (OpenSSL::SSL::VERIFY_NONE), or a string containing the name
of an OpenSSL verify mode (none, peer, client_once, fail_if_no_peer_cert).</p>

<h3 id="class-Mail::SMTP-label-Others+">Others <span><a href="#class-Mail::SMTP-label-Others+">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Feel free to send me other examples that were tricky</p>

<h3 id="class-Mail::SMTP-label-Delivering+the+email">Delivering the email<span><a href="#class-Mail::SMTP-label-Delivering+the+email">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Once you have the settings right, sending the email is done by:</p>

<pre>Mail.deliver do
  to 'mikel@test.lindsaar.net'
  from 'ada@test.lindsaar.net'
  subject 'testing sendmail'
  body 'testing sendmail'
end</pre>

<p>Or by calling deliver on a <a href="../Mail.html">Mail</a> message</p>

<pre>mail = Mail.new do
  to 'mikel@test.lindsaar.net'
  from 'ada@test.lindsaar.net'
  subject 'testing sendmail'
  body 'testing sendmail'
end

mail.deliver!</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-settings" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">settings</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/mail/network/delivery_methods/smtp.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">values</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">settings</span> = { <span class="ruby-value">:address</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;localhost&quot;</span>,
                    <span class="ruby-value">:port</span>                 =<span class="ruby-operator">&gt;</span> <span class="ruby-value">25</span>,
                    <span class="ruby-value">:domain</span>               =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'localhost.localdomain'</span>,
                    <span class="ruby-value">:user_name</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:password</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:authentication</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:enable_starttls_auto</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>,
                    <span class="ruby-value">:openssl_verify_mode</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:ssl</span>                  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
                    <span class="ruby-value">:tls</span>                  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>
                  }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">values</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-deliver-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deliver!</span><span
            class="method-args">(mail)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Send the message via <a href="SMTP.html">SMTP</a>. The from and to
attributes are optional. If not set, they are retrieve from the <a
href="Message.html">Message</a>.</p>
          
          

          
          <div class="method-source-code" id="deliver-21-source">
            <pre><span class="ruby-comment"># File lib/mail/network/delivery_methods/smtp.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">deliver!</span>(<span class="ruby-identifier">mail</span>)
  <span class="ruby-identifier">smtp_from</span>, <span class="ruby-identifier">smtp_to</span>, <span class="ruby-identifier">message</span> = <span class="ruby-identifier">check_delivery_params</span>(<span class="ruby-identifier">mail</span>)

  <span class="ruby-identifier">smtp</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SMTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-value">:address</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-value">:port</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:tls</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:ssl</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">smtp</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:enable_tls</span>)
      <span class="ruby-identifier">smtp</span>.<span class="ruby-identifier">enable_tls</span>(<span class="ruby-identifier">ssl_context</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:enable_starttls_auto</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">smtp</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:enable_starttls_auto</span>)
      <span class="ruby-identifier">smtp</span>.<span class="ruby-identifier">enable_starttls_auto</span>(<span class="ruby-identifier">ssl_context</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">response</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">smtp</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-value">:domain</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-value">:user_name</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-value">:password</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-value">:authentication</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">smtp_obj</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-identifier">smtp_obj</span>.<span class="ruby-identifier">sendmail</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">smtp_from</span>, <span class="ruby-identifier">smtp_to</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:return_response</span>]
    <span class="ruby-identifier">response</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-ssl_context" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssl_context</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allow SSL context to be configured via settings, for Ruby &gt;= 1.9 Just
returns openssl verify mode for Ruby 1.8.x</p>
          
          

          
          <div class="method-source-code" id="ssl_context-source">
            <pre><span class="ruby-comment"># File lib/mail/network/delivery_methods/smtp.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_context</span>
  <span class="ruby-identifier">openssl_verify_mode</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value">:openssl_verify_mode</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">openssl_verify_mode</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-identifier">openssl_verify_mode</span> = <span class="ruby-node">&quot;OpenSSL::SSL::VERIFY_#{openssl_verify_mode.upcase}&quot;</span>.<span class="ruby-identifier">constantize</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">context</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SMTP</span>.<span class="ruby-identifier">default_ssl_context</span>
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-identifier">openssl_verify_mode</span>
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">ca_path</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value">:ca_path</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:ca_path</span>]
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">ca_file</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value">:ca_file</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>[<span class="ruby-value">:ca_file</span>]
  <span class="ruby-identifier">context</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

